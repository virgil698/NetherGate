# ç©å®¶æ•°æ®è¯»å–

NetherGate æä¾›äº†å¼ºå¤§çš„ç©å®¶æ•°æ®è¯»å– APIï¼Œå…è®¸æ‚¨ç›´æ¥è¯»å–ç©å®¶çš„ NBT æ•°æ®æ–‡ä»¶ï¼Œè·å–è¯¦ç»†çš„æ¸¸æˆä¿¡æ¯ã€‚

---

## ğŸ“‹ **ç›®å½•**

- [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [é‡ç”Ÿç‚¹æ•°æ®ï¼ˆ1.21.9+ï¼‰](#é‡ç”Ÿç‚¹æ•°æ®1219)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸŒŸ **åŠŸèƒ½æ¦‚è¿°**

ç©å®¶æ•°æ®è¯»å– API æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- âœ… è¯»å–ç©å®¶åŸºç¡€ä¿¡æ¯ï¼ˆä½ç½®ã€ç”Ÿå‘½å€¼ã€é¥¥é¥¿åº¦ç­‰ï¼‰
- âœ… è¯»å–ç©å®¶èƒŒåŒ…å’Œè£…å¤‡
- âœ… è¯»å–ç©å®¶çŠ¶æ€æ•ˆæœ
- âœ… è¯»å–ç©å®¶ç»Ÿè®¡æ•°æ®
- âœ… è¯»å–ç©å®¶æˆå°±è¿›åº¦
- âœ… è¯»å–é‡ç”Ÿç‚¹ä¿¡æ¯ï¼ˆMinecraft 1.21.9+ï¼‰

---

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **è¯»å–ç©å®¶æ•°æ®**

```csharp
public class PlayerDataPlugin : IPlugin
{
    private IPluginContext _context = null!;

    public async Task OnEnableAsync(IPluginContext context)
    {
        _context = context;
        
        // é€šè¿‡ UUID è¯»å–ç©å®¶æ•°æ®
        var playerUuid = Guid.Parse("069a79f4-44e9-4726-a5be-fca90e38aaf5");
        var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(playerUuid);
        
        if (playerData != null)
        {
            _context.Logger.Info($"ç©å®¶ä½ç½®: X={playerData.Pos.X}, Y={playerData.Pos.Y}, Z={playerData.Pos.Z}");
            _context.Logger.Info($"ç”Ÿå‘½å€¼: {playerData.Health}");
            _context.Logger.Info($"ç­‰çº§: {playerData.XpLevel}");
        }
    }
}
```

---

## ğŸ“– **æ•°æ®æ¨¡å‹**

### **PlayerData ç±»**

```csharp
public class PlayerData
{
    /// <summary>
    /// ç©å®¶ä½ç½®
    /// </summary>
    public Position Pos { get; init; }
    
    /// <summary>
    /// ç©å®¶æ—‹è½¬è§’åº¦ï¼ˆä¿¯ä»°è§’å’Œåèˆªè§’ï¼‰
    /// </summary>
    public Rotation Rotation { get; init; }
    
    /// <summary>
    /// ç”Ÿå‘½å€¼
    /// </summary>
    public float Health { get; init; }
    
    /// <summary>
    /// é¥¥é¥¿å€¼
    /// </summary>
    public int FoodLevel { get; init; }
    
    /// <summary>
    /// é¥±å’Œåº¦
    /// </summary>
    public float FoodSaturationLevel { get; init; }
    
    /// <summary>
    /// ç»éªŒç­‰çº§
    /// </summary>
    public int XpLevel { get; init; }
    
    /// <summary>
    /// å½“å‰ç»éªŒå€¼
    /// </summary>
    public float XpP { get; init; }
    
    /// <summary>
    /// æ€»ç»éªŒå€¼
    /// </summary>
    public int XpTotal { get; init; }
    
    /// <summary>
    /// æ¸¸æˆæ¨¡å¼ï¼ˆ0=ç”Ÿå­˜, 1=åˆ›é€ , 2=å†’é™©, 3=æ—è§‚ï¼‰
    /// </summary>
    public int PlayerGameType { get; init; }
    
    /// <summary>
    /// ç»´åº¦
    /// </summary>
    public string Dimension { get; init; }
    
    /// <summary>
    /// èƒŒåŒ…ç‰©å“
    /// </summary>
    public List<ItemStack> Inventory { get; init; }
    
    /// <summary>
    /// æœ«å½±ç®±ç‰©å“
    /// </summary>
    public List<ItemStack> EnderItems { get; init; }
    
    /// <summary>
    /// ç©å®¶è£…å¤‡
    /// </summary>
    public PlayerArmor Armor { get; init; }
    
    /// <summary>
    /// çŠ¶æ€æ•ˆæœ
    /// </summary>
    public List<StatusEffect> ActiveEffects { get; init; }
    
    /// <summary>
    /// ç©å®¶ç»Ÿè®¡æ•°æ®
    /// </summary>
    public PlayerStats? Stats { get; init; }
    
    /// <summary>
    /// ç©å®¶æˆå°±è¿›åº¦
    /// </summary>
    public PlayerAdvancements? Advancements { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿç‚¹ä¿¡æ¯ï¼ˆMinecraft 1.21.9+ï¼‰
    /// </summary>
    public RespawnData? RespawnData { get; init; }
}
```

---

## ğŸ’¡ **ä½¿ç”¨ç¤ºä¾‹**

### **ç¤ºä¾‹ 1ï¼šç©å®¶ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤**

```csharp
public class PlayerInfoCommand : ICommand
{
    private readonly IPluginContext _context;

    public string Name => "playerinfo";
    public string Description => "æŸ¥è¯¢ç©å®¶è¯¦ç»†ä¿¡æ¯";
    public string Usage => "#playerinfo <ç©å®¶å>";
    public List<string> Aliases => new() { "pi" };
    public string PluginId => "PlayerInfo";
    public string? Permission => null;

    public PlayerInfoCommand(IPluginContext context)
    {
        _context = context;
    }

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        if (args.Length < 1)
            return CommandResult.Fail($"ç”¨æ³•: {Usage}");

        var playerName = args[0];
        
        // è·å–ç©å®¶æ¡£æ¡ˆï¼ˆUUIDï¼‰
        var profile = await _context.PlayerProfileApi.FetchProfileByNameAsync(playerName);
        if (profile == null)
        {
            return CommandResult.Fail($"Â§cæ‰¾ä¸åˆ°ç©å®¶: {playerName}");
        }
        
        // è¯»å–ç©å®¶æ•°æ®
        var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(profile.Uuid);
        if (playerData == null)
        {
            return CommandResult.Fail($"Â§cæ— æ³•è¯»å–ç©å®¶æ•°æ®");
        }
        
        var gameMode = playerData.PlayerGameType switch
        {
            0 => "ç”Ÿå­˜",
            1 => "åˆ›é€ ",
            2 => "å†’é™©",
            3 => "æ—è§‚",
            _ => "æœªçŸ¥"
        };
        
        var message = $"""
            Â§6â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            Â§f  ç©å®¶ä¿¡æ¯: Â§e{playerName}
            
            Â§7  ç”Ÿå‘½å€¼: Â§c{playerData.Health:F1}Â§7/Â§c20.0
            Â§7  é¥¥é¥¿å€¼: Â§6{playerData.FoodLevel}Â§7/Â§620
            Â§7  ç­‰çº§: Â§a{playerData.XpLevel}
            Â§7  æ¸¸æˆæ¨¡å¼: Â§f{gameMode}
            Â§7  ç»´åº¦: Â§f{playerData.Dimension}
            Â§7  åæ ‡: Â§f{playerData.Pos.X:F1}, {playerData.Pos.Y:F1}, {playerData.Pos.Z:F1}
            Â§6â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            """;
        
        sender.SendMessage(message);
        return CommandResult.Ok();
    }
}
```

### **ç¤ºä¾‹ 2ï¼šèƒŒåŒ…æ£€æŸ¥**

```csharp
public async Task CheckInventory(Guid playerUuid)
{
    var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(playerUuid);
    
    if (playerData != null)
    {
        _context.Logger.Info($"èƒŒåŒ…ä¸­å…±æœ‰ {playerData.Inventory.Count} ä¸ªç‰©å“");
        
        foreach (var item in playerData.Inventory)
        {
            _context.Logger.Info($"  - {item.Id} x{item.Count} (æ§½ä½ {item.Slot})");
            
            // æ£€æŸ¥é™„é­”
            if (item.Enchantments.Count > 0)
            {
                foreach (var ench in item.Enchantments)
                {
                    _context.Logger.Info($"    é™„é­”: {ench.Id} Lv.{ench.Level}");
                }
            }
        }
    }
}
```

### **ç¤ºä¾‹ 3ï¼šè£…å¤‡æŸ¥è¯¢**

```csharp
public async Task CheckArmor(Guid playerUuid)
{
    var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(playerUuid);
    
    if (playerData?.Armor != null)
    {
        _context.Logger.Info("ç©å®¶è£…å¤‡:");
        
        if (playerData.Armor.Head != null)
            _context.Logger.Info($"  å¤´ç›”: {playerData.Armor.Head.Id}");
        
        if (playerData.Armor.Chest != null)
            _context.Logger.Info($"  èƒ¸ç”²: {playerData.Armor.Chest.Id}");
        
        if (playerData.Armor.Legs != null)
            _context.Logger.Info($"  æŠ¤è…¿: {playerData.Armor.Legs.Id}");
        
        if (playerData.Armor.Feet != null)
            _context.Logger.Info($"  é´å­: {playerData.Armor.Feet.Id}");
        
        if (playerData.Armor.MainHand != null)
            _context.Logger.Info($"  ä¸»æ‰‹: {playerData.Armor.MainHand.Id}");
        
        if (playerData.Armor.OffHand != null)
            _context.Logger.Info($"  å‰¯æ‰‹: {playerData.Armor.OffHand.Id}");
    }
}
```

---

## ğŸ”„ **é‡ç”Ÿç‚¹æ•°æ®ï¼ˆ1.21.9+ï¼‰**

ä» Minecraft 1.21.9 å¼€å§‹ï¼ŒNetherGate æ”¯æŒè¯»å–ç©å®¶çš„è¯¦ç»†é‡ç”Ÿç‚¹ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¿¯ä»°è§’ã€åèˆªè§’å’Œé‡ç”Ÿé”šä½ç½®ã€‚

### **RespawnData æ•°æ®æ¨¡å‹**

```csharp
/// <summary>
/// é‡ç”Ÿç‚¹æ•°æ®ï¼ˆMinecraft 1.21.9+ï¼‰
/// </summary>
public class RespawnData
{
    /// <summary>
    /// é‡ç”Ÿç‚¹ X åæ ‡
    /// </summary>
    public int X { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿç‚¹ Y åæ ‡
    /// </summary>
    public int Y { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿç‚¹ Z åæ ‡
    /// </summary>
    public int Z { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿæ—¶çš„ä¿¯ä»°è§’ï¼ˆ1.21.9+ æ–°å¢ï¼‰
    /// </summary>
    public float Pitch { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿæ—¶çš„åèˆªè§’ï¼ˆå¯é€‰ï¼‰
    /// </summary>
    public float? Yaw { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿç‚¹æ‰€åœ¨ç»´åº¦
    /// </summary>
    public string Dimension { get; init; } = "minecraft:overworld";
    
    /// <summary>
    /// æ˜¯å¦å¼ºåˆ¶é‡ç”Ÿåœ¨æ­¤ä½ç½®
    /// </summary>
    public bool Forced { get; init; }
    
    /// <summary>
    /// é‡ç”Ÿé”šä½ç½®ï¼ˆå¦‚æœä½¿ç”¨é‡ç”Ÿé”šï¼‰
    /// </summary>
    public RespawnAnchorPosition? RespawnAnchor { get; init; }
}

/// <summary>
/// é‡ç”Ÿé”šä½ç½®
/// </summary>
public class RespawnAnchorPosition
{
    /// <summary>
    /// X åæ ‡
    /// </summary>
    public int X { get; init; }
    
    /// <summary>
    /// Y åæ ‡
    /// </summary>
    public int Y { get; init; }
    
    /// <summary>
    /// Z åæ ‡
    /// </summary>
    public int Z { get; init; }
}
```

### **é‡ç”Ÿç‚¹æŸ¥è¯¢ç¤ºä¾‹**

```csharp
public class RespawnInfoCommand : ICommand
{
    private readonly IPluginContext _context;

    public string Name => "respawninfo";
    public string Description => "æŸ¥çœ‹é‡ç”Ÿç‚¹ä¿¡æ¯";
    public List<string> Aliases => new() { "ri" };
    public string PluginId => "RespawnPlugin";
    public string? Permission => null;
    public string Usage => "#respawninfo [ç©å®¶]";

    public RespawnInfoCommand(IPluginContext context)
    {
        _context = context;
    }

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var targetName = args.Length > 0 ? args[0] : sender.Name;
        
        // è·å–ç©å®¶ UUID
        var profile = await _context.PlayerProfileApi.FetchProfileByNameAsync(targetName);
        if (profile == null)
        {
            return CommandResult.Fail($"Â§cæ‰¾ä¸åˆ°ç©å®¶: {targetName}");
        }
        
        // è¯»å–ç©å®¶æ•°æ®
        var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(profile.Uuid);
        if (playerData?.RespawnData == null)
        {
            return CommandResult.Fail($"Â§c{targetName} æ²¡æœ‰è®¾ç½®é‡ç”Ÿç‚¹");
        }
        
        var respawn = playerData.RespawnData;
        
        var message = $"""
            Â§6â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            Â§f  {targetName} çš„é‡ç”Ÿç‚¹ä¿¡æ¯
            
            Â§7  ä½ç½®: Â§f{respawn.X}, {respawn.Y}, {respawn.Z}
            Â§7  ç»´åº¦: Â§f{respawn.Dimension}
            Â§7  ä¿¯ä»°è§’: Â§f{respawn.Pitch:F2}Â°
            """;
        
        if (respawn.Yaw.HasValue)
        {
            message += $"\nÂ§7  åèˆªè§’: Â§f{respawn.Yaw.Value:F2}Â°";
        }
        
        message += $"\nÂ§7  å¼ºåˆ¶é‡ç”Ÿ: Â§f{(respawn.Forced ? "æ˜¯" : "å¦")}";
        
        if (respawn.RespawnAnchor != null)
        {
            var anchor = respawn.RespawnAnchor;
            message += $"\nÂ§7  é‡ç”Ÿé”š: Â§f{anchor.X}, {anchor.Y}, {anchor.Z}";
        }
        
        message += "\nÂ§6â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•";
        
        sender.SendMessage(message);
        return CommandResult.Ok();
    }
}
```

### **é‡ç”Ÿç‚¹ä¼ é€æ’ä»¶**

```csharp
public class TeleportToRespawnCommand : ICommand
{
    private readonly IPluginContext _context;

    public string Name => "tprespawn";
    public string Description => "ä¼ é€åˆ°é‡ç”Ÿç‚¹";
    public string Usage => "#tprespawn [ç©å®¶]";
    public List<string> Aliases => new() { "tpr" };
    public string PluginId => "RespawnPlugin";
    public string? Permission => "respawn.teleport";

    public TeleportToRespawnCommand(IPluginContext context)
    {
        _context = context;
    }

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var targetName = args.Length > 0 ? args[0] : sender.Name;
        
        // è·å–ç©å®¶ UUID
        var profile = await _context.PlayerProfileApi.FetchProfileByNameAsync(targetName);
        if (profile == null)
        {
            return CommandResult.Fail($"Â§cæ‰¾ä¸åˆ°ç©å®¶: {targetName}");
        }
        
        // è¯»å–ç©å®¶æ•°æ®
        var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(profile.Uuid);
        if (playerData?.RespawnData == null)
        {
            return CommandResult.Fail($"Â§c{targetName} æ²¡æœ‰è®¾ç½®é‡ç”Ÿç‚¹");
        }
        
        var respawn = playerData.RespawnData;
        
        // æ‰§è¡Œä¼ é€å‘½ä»¤
        var dimension = respawn.Dimension.Replace("minecraft:", "");
        var command = $"execute in {respawn.Dimension} run tp {targetName} {respawn.X} {respawn.Y} {respawn.Z}";
        
        await _context.RconClient!.ExecuteCommandAsync(command);
        
        sender.SendMessage($"Â§aå·²å°† {targetName} ä¼ é€åˆ°é‡ç”Ÿç‚¹");
        return CommandResult.Ok();
    }
}
```

---

## âœ… **æœ€ä½³å®è·µ**

### **1. é”™è¯¯å¤„ç†**

å§‹ç»ˆæ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º `null`ï¼š

```csharp
var playerData = await _context.PlayerDataReader.ReadPlayerDataAsync(uuid);
if (playerData == null)
{
    _context.Logger.Warning($"æ— æ³•è¯»å–ç©å®¶æ•°æ®: {uuid}");
    return;
}
```

### **2. ç¼“å­˜æ•°æ®**

å¦‚æœéœ€è¦é¢‘ç¹è®¿é—®ç©å®¶æ•°æ®ï¼Œè€ƒè™‘ç¼“å­˜ï¼š

```csharp
private Dictionary<Guid, PlayerData> _playerCache = new();
private DateTime _lastCacheTime;

public async Task<PlayerData?> GetCachedPlayerData(Guid uuid)
{
    // ç¼“å­˜ 5 åˆ†é’Ÿ
    if ((DateTime.Now - _lastCacheTime).TotalMinutes > 5)
    {
        _playerCache.Clear();
        _lastCacheTime = DateTime.Now;
    }
    
    if (!_playerCache.ContainsKey(uuid))
    {
        var data = await _context.PlayerDataReader.ReadPlayerDataAsync(uuid);
        if (data != null)
        {
            _playerCache[uuid] = data;
        }
    }
    
    return _playerCache.GetValueOrDefault(uuid);
}
```

### **3. ç‰ˆæœ¬å…¼å®¹æ€§**

æ£€æŸ¥ 1.21.9+ ç‰¹æ€§æ˜¯å¦å¯ç”¨ï¼š

```csharp
if (playerData.RespawnData != null)
{
    // ä½¿ç”¨ 1.21.9+ çš„é‡ç”Ÿç‚¹æ•°æ®
    var pitch = playerData.RespawnData.Pitch;
    _context.Logger.Info($"é‡ç”Ÿä¿¯ä»°è§’: {pitch}");
}
else
{
    _context.Logger.Info("æ­¤æœåŠ¡å™¨ä¸æ”¯æŒè¯¦ç»†é‡ç”Ÿç‚¹æ•°æ®");
}
```

---

## ğŸ“¦ **ç³»ç»Ÿè¦æ±‚**

- âœ… Minecraft Java ç‰ˆ **1.16+**
- âœ… é‡ç”Ÿç‚¹æ‰©å±•æ•°æ®éœ€è¦ **Minecraft 1.21.9+**
- âœ… NetherGate **1.0.0+**

---

## ğŸ› **å·²çŸ¥é™åˆ¶**

1. **ç¦»çº¿ç©å®¶**ï¼šåªèƒ½è¯»å–å·²ç™»å½•è¿‡æœåŠ¡å™¨çš„ç©å®¶æ•°æ®
2. **å®æ—¶æ€§**ï¼šæ•°æ®æ˜¯ä»æ–‡ä»¶è¯»å–çš„ï¼Œå¯èƒ½ä¸å½“å‰æ¸¸æˆçŠ¶æ€æœ‰å»¶è¿Ÿ
3. **æ–‡ä»¶é”å®š**ï¼šç©å®¶åœ¨çº¿æ—¶ï¼Œæ–‡ä»¶å¯èƒ½è¢«æœåŠ¡å™¨é”å®š

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [ç©å®¶æ¡£æ¡ˆAPI](./ç©å®¶æ¡£æ¡ˆAPI.md)
- [NBTæ•°æ®æ“ä½œ](./NBTæ•°æ®æ“ä½œ.md)
- [å‘½ä»¤ç³»ç»Ÿ](./å‘½ä»¤ç³»ç»Ÿ.md)

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** NetherGate å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°ï¼š** 2025-10-09

