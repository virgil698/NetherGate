# NetherGate å‘½ä»¤ç³»ç»Ÿ

NetherGate æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„å‘½ä»¤ç³»ç»Ÿï¼Œæ”¯æŒæ§åˆ¶å°å‘½ä»¤å’Œæ¸¸æˆå†…å‘½ä»¤ã€‚è¯¥ç³»ç»Ÿæ·±å— [MCDReforged](https://github.com/Fallen-Breath/MCDReforged) å’Œ [NBrigadier](https://github.com/NickAcPT/NBrigadier) å¯å‘ï¼Œç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼š

- âœ… **ç®€å•æ˜“ç”¨**ï¼ˆMCDReforged é£æ ¼ï¼‰- å¿«é€Ÿä¸Šæ‰‹ï¼Œæ— éœ€å¤æ‚é…ç½®
- âœ… **ç±»å‹å®‰å…¨**ï¼ˆBrigadier é£æ ¼ï¼‰- å¼ºç±»å‹å‚æ•°éªŒè¯å’Œè‡ªåŠ¨è§£æ
- âœ… **åŠŸèƒ½å®Œæ•´** - æƒé™æ£€æŸ¥ã€Tab è¡¥å…¨ã€å‘½ä»¤åˆ«åã€ç®¡é“ã€æ‹¦æˆªå™¨
- âœ… **æ€§èƒ½ä¼˜åŒ–** - æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ŒTab è¡¥å…¨æ€§èƒ½æå‡ 50-100 å€

---

## ğŸ“‹ **ç›®å½•**

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å‘½ä»¤ç±»å‹](#å‘½ä»¤ç±»å‹)
- [åˆ›å»ºå‘½ä»¤](#åˆ›å»ºå‘½ä»¤)
- [æ³¨å†Œå‘½ä»¤](#æ³¨å†Œå‘½ä»¤)
- [å‘½ä»¤å‰ç¼€](#å‘½ä»¤å‰ç¼€)
- [æƒé™æ£€æŸ¥](#æƒé™æ£€æŸ¥)
- [Tab è¡¥å…¨](#tab-è¡¥å…¨)
- [å‘½ä»¤åˆ«å](#å‘½ä»¤åˆ«å)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
  - [å¢å¼ºçš„å¸®åŠ©ç”Ÿæˆ](#å¢å¼ºçš„å¸®åŠ©ç”Ÿæˆ)
  - [æ‰©å±•å‚æ•°ç±»å‹](#æ‰©å±•å‚æ•°ç±»å‹)
  - [Tab è¡¥å…¨æ€§èƒ½ä¼˜åŒ–](#tab-è¡¥å…¨æ€§èƒ½ä¼˜åŒ–)
  - [å‘½ä»¤ç®¡é“ç³»ç»Ÿ](#å‘½ä»¤ç®¡é“ç³»ç»Ÿ)
  - [å‘½ä»¤æ‰§è¡Œé’©å­](#å‘½ä»¤æ‰§è¡Œé’©å­)
  - [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **1. åˆ›å»ºç®€å•å‘½ä»¤**

```csharp
using NetherGate.API.Commands;
using NetherGate.API.Plugins;

public class HelloCommand : ICommand
{
    private readonly PluginBase _plugin;
    
    public string Name => "hello";
    public string Description => "å‘ç©å®¶æ‰“æ‹›å‘¼";
    public string Usage => "/hello [name]";
    public string[] Aliases => new[] { "hi", "greet" };
    public string Permission => "myplugin.hello";  // å¯é€‰ï¼Œnull è¡¨ç¤ºæ— éœ€æƒé™
    public string PluginId => _plugin.Metadata.Id;

    public HelloCommand(PluginBase plugin)
    {
        _plugin = plugin;
    }

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        if (sender.IsConsole)
        {
            return CommandResult.Ok("ä½ å¥½ï¼æ¥è‡ªæ§åˆ¶å°");
        }
        
        string target = args.Length > 0 ? args[0] : sender.Name;
        await _plugin.GameDisplay.SendChatMessage(sender.Name, $"Â§aä½ å¥½, {target}ï¼");
        
        return CommandResult.Ok($"å‘ {target} æ‰“æ‹›å‘¼æˆåŠŸ");
    }
    
    public async Task<List<string>> TabCompleteAsync(ICommandSender sender, string[] args)
    {
        // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæç¤ºåœ¨çº¿ç©å®¶
        if (args.Length == 1)
        {
            var players = await _plugin.Server.GetOnlinePlayersAsync();
            return players
                .Select(p => p.Name)
                .Where(name => name.StartsWith(args[0], StringComparison.OrdinalIgnoreCase))
                .ToList();
        }
        return new List<string>();
    }
}
```

### **2. æ³¨å†Œå‘½ä»¤**

```csharp
public class MyPlugin : PluginBase
{
    public override Task OnEnableAsync()
    {
        // æ³¨å†Œå‘½ä»¤
        Commands.RegisterCommand(new HelloCommand(this));
        
        Logger.Info("Hello å‘½ä»¤å·²æ³¨å†Œ");
        return Task.CompletedTask;
    }
}
```

### **3. ä½¿ç”¨å‘½ä»¤**

```bash
# æ§åˆ¶å°æ‰§è¡Œï¼ˆæ— å‰ç¼€ï¼‰
hello

# æ¸¸æˆå†…æ‰§è¡Œï¼ˆä½¿ç”¨ # å‰ç¼€ï¼‰
#hello
#hi        # ä½¿ç”¨åˆ«å
```

---

## ğŸ¯ **å‘½ä»¤ç±»å‹**

### **1. æ§åˆ¶å°å‘½ä»¤**

ä» NetherGate æ§åˆ¶å°æ‰§è¡Œï¼Œ**ä¸éœ€è¦å‰ç¼€**ï¼š

```bash
plugin list
permission reload
stop
```

### **2. æ¸¸æˆå†…å‘½ä»¤**

ä» Minecraft èŠå¤©æ¡†æ‰§è¡Œï¼Œ**ä½¿ç”¨ `#` å‰ç¼€**ï¼ˆé¿å…ä¸åŸç‰ˆå‘½ä»¤å†²çªï¼‰ï¼š

```
#help
#spawn
#tpa Steve
```

### **3. RCON å‘½ä»¤**

é€šè¿‡ RCON å‘é€åˆ° Minecraft æœåŠ¡å™¨çš„åŸç”Ÿå‘½ä»¤ï¼š

```bash
/say Hello
/give Steve diamond 64
/tp Steve 0 64 0
```

**æ³¨æ„ï¼š** NetherGate æ¡†æ¶å‘½ä»¤ä½¿ç”¨ `#` å‰ç¼€ï¼ŒåŸç‰ˆ Minecraft å‘½ä»¤ä½¿ç”¨ `/` å‰ç¼€ã€‚

---

## ğŸ› ï¸ **åˆ›å»ºå‘½ä»¤**

### **ICommand æ¥å£**

```csharp
namespace NetherGate.API.Commands
{
    public interface ICommand
    {
        /// <summary>
        /// å‘½ä»¤åç§°ï¼ˆä¸»è¦åç§°ï¼‰
        /// </summary>
        string Name { get; }
        
        /// <summary>
        /// å‘½ä»¤æè¿°
        /// </summary>
        string Description { get; }
        
        /// <summary>
        /// ä½¿ç”¨æ–¹æ³•æç¤º
        /// </summary>
        string Usage { get; }
        
        /// <summary>
        /// å‘½ä»¤åˆ«ååˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
        /// </summary>
        string[] Aliases { get; }
        
        /// <summary>
        /// æ‰€å±æ’ä»¶ ID
        /// </summary>
        string PluginId { get; }
        
        /// <summary>
        /// æ‰€éœ€æƒé™èŠ‚ç‚¹ï¼ˆnull è¡¨ç¤ºæ— éœ€æƒé™ï¼‰
        /// </summary>
        string? Permission { get; }
        
        /// <summary>
        /// æ‰§è¡Œå‘½ä»¤
        /// </summary>
        /// <param name="sender">å‘½ä»¤å‘é€è€…</param>
        /// <param name="args">å‘½ä»¤å‚æ•°</param>
        Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args);
        
        /// <summary>
        /// Tab è¡¥å…¨ï¼ˆå¯é€‰å®ç°ï¼‰
        /// </summary>
        /// <param name="sender">å‘½ä»¤å‘é€è€…</param>
        /// <param name="args">å½“å‰è¾“å…¥çš„å‚æ•°</param>
        Task<List<string>> TabCompleteAsync(ICommandSender sender, string[] args);
    }
}
```

### **ICommandSender æ¥å£**

```csharp
namespace NetherGate.API.Commands
{
    public interface ICommandSender
    {
        /// <summary>
        /// å‘é€è€…åç§°
        /// </summary>
        string Name { get; }
        
        /// <summary>
        /// æ˜¯å¦æ˜¯æ§åˆ¶å°
        /// </summary>
        bool IsConsole { get; }
        
        /// <summary>
        /// å‘é€æ¶ˆæ¯ç»™å‘½ä»¤å‘é€è€…
        /// </summary>
        /// <param name="message">æ¶ˆæ¯å†…å®¹</param>
        void SendMessage(string message);
        
        /// <summary>
        /// æ£€æŸ¥æ˜¯å¦æ‹¥æœ‰æŒ‡å®šæƒé™
        /// </summary>
        /// <param name="permission">æƒé™èŠ‚ç‚¹</param>
        /// <returns>æ˜¯å¦æ‹¥æœ‰æƒé™</returns>
        bool HasPermission(string permission);
    }
}
```

### **CommandResult è®°å½•**

```csharp
namespace NetherGate.API.Commands
{
    public record CommandResult
    {
        public bool Success { get; init; }
        public string Message { get; init; }
        
        // é™æ€å·¥å‚æ–¹æ³•
        public static CommandResult Ok(string message) 
            => new CommandResult { Success = true, Message = message };
        
        public static CommandResult Fail(string message) 
            => new CommandResult { Success = false, Message = message };
    }
}
```

### **åŸºæœ¬å‘½ä»¤ç¤ºä¾‹**

```csharp
using NetherGate.API.Commands;
using NetherGate.API.Plugins;

public class SpawnCommand : ICommand
{
    private readonly PluginBase _plugin;
    
    public string Name => "spawn";
    public string Description => "ä¼ é€åˆ°å‡ºç”Ÿç‚¹";
    public string Usage => "#spawn";
    public string[] Aliases => new[] { "s" };
    public string PluginId => _plugin.Metadata.Id;
    public string? Permission => "myplugin.spawn";

    public SpawnCommand(PluginBase plugin)
    {
        _plugin = plugin;
    }

    public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
    {
        // åªèƒ½åœ¨æ¸¸æˆå†…ä½¿ç”¨
        if (sender == null)
        {
            return CommandResult.Fail("æ­¤å‘½ä»¤åªèƒ½åœ¨æ¸¸æˆå†…ä½¿ç”¨");
        }
        
        // æ£€æŸ¥æƒé™ï¼ˆå¯é€‰ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨æ£€æŸ¥ï¼‰
        if (!await _context.PermissionManager.HasPermissionAsync(sender.Name, Permission))
        {
            return CommandResult.Fail("Â§cä½ æ²¡æœ‰æƒé™ä½¿ç”¨æ­¤å‘½ä»¤");
        }
        
        // ä¼ é€åˆ°å‡ºç”Ÿç‚¹
        await _context.GameDisplayApi.TeleportPlayer(sender.Name, 0, 64, 0);
        
        return CommandResult.Success("Â§aå·²ä¼ é€åˆ°å‡ºç”Ÿç‚¹");
    }
}
```

### **å¸¦å‚æ•°çš„å‘½ä»¤**

```csharp
public class TeleportCommand : ICommand
{
    private readonly IPluginContext _context;
    
    public string Name => "tp";
    public string Description => "ä¼ é€åˆ°æŒ‡å®šåæ ‡æˆ–ç©å®¶";
    public string[] Aliases => new[] { "teleport" };
    public string? Permission => "myplugin.tp";
    public string? Usage => "#tp <x> <y> <z> æˆ– #tp <ç©å®¶>";

    public TeleportCommand(IPluginContext context)
    {
        _context = context;
    }

    public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
    {
        if (sender == null)
        {
            return CommandResult.Fail("æ­¤å‘½ä»¤åªèƒ½åœ¨æ¸¸æˆå†…ä½¿ç”¨");
        }
        
        if (args.Length == 0)
        {
            return CommandResult.Fail($"ç”¨æ³•: {Usage}");
        }
        
        // ä¼ é€åˆ°ç©å®¶
        if (args.Length == 1)
        {
            string targetPlayer = args[0];
            await _context.GameDisplayApi.TeleportPlayerToPlayer(sender.Name, targetPlayer);
            return CommandResult.Success($"Â§aå·²ä¼ é€åˆ° {targetPlayer}");
        }
        
        // ä¼ é€åˆ°åæ ‡
        if (args.Length == 3)
        {
            if (!int.TryParse(args[0], out int x) ||
                !int.TryParse(args[1], out int y) ||
                !int.TryParse(args[2], out int z))
            {
                return CommandResult.Fail("Â§cåæ ‡å¿…é¡»æ˜¯æ•´æ•°");
            }
            
            await _context.GameDisplayApi.TeleportPlayer(sender.Name, x, y, z);
            return CommandResult.Success($"Â§aå·²ä¼ é€åˆ° ({x}, {y}, {z})");
        }
        
        return CommandResult.Fail($"ç”¨æ³•: {Usage}");
    }

    public async Task<List<string>> TabCompleteAsync(string[] args, ICommandSender? sender = null)
    {
        // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šåœ¨çº¿ç©å®¶åˆ—è¡¨
        if (args.Length == 1)
        {
            return GetOnlinePlayerNames();
        }
        
        return new List<string>();
    }
    
    private List<string> GetOnlinePlayerNames()
    {
        // å®ç°è·å–åœ¨çº¿ç©å®¶åˆ—è¡¨çš„é€»è¾‘
        return new List<string> { "Steve", "Alex" };
    }
}
```

### **å­å‘½ä»¤ç³»ç»Ÿ**

```csharp
public class PluginCommand : ICommand
{
    private readonly IPluginContext _context;
    
    public string Name => "plugin";
    public string Description => "æ’ä»¶ç®¡ç†å‘½ä»¤";
    public string? Permission => "nethergate.plugin";
    public string? Usage => "#plugin <list|reload|info> [name]";

    public PluginCommand(IPluginContext context)
    {
        _context = context;
    }

    public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
    {
        if (args.Length == 0)
        {
            return CommandResult.Fail($"ç”¨æ³•: {Usage}");
        }
        
        string subCommand = args[0].ToLower();
        
        return subCommand switch
        {
            "list" => await ListPlugins(),
            "reload" => await ReloadPlugin(args),
            "info" => await ShowPluginInfo(args),
            _ => CommandResult.Fail($"æœªçŸ¥å­å‘½ä»¤: {subCommand}\nç”¨æ³•: {Usage}")
        };
    }

    private async Task<CommandResult> ListPlugins()
    {
        var plugins = _context.PluginManager.GetLoadedPlugins();
        var message = $"Â§aå·²åŠ è½½æ’ä»¶ ({plugins.Count}):\n";
        
        foreach (var plugin in plugins)
        {
            message += $"Â§f- {plugin.Name} v{plugin.Version}\n";
        }
        
        return CommandResult.Success(message);
    }

    private async Task<CommandResult> ReloadPlugin(string[] args)
    {
        if (args.Length < 2)
        {
            return CommandResult.Fail("ç”¨æ³•: #plugin reload <name>");
        }
        
        string pluginName = args[1];
        await _context.PluginManager.ReloadPluginAsync(pluginName);
        
        return CommandResult.Success($"Â§aæ’ä»¶ {pluginName} å·²é‡è½½");
    }

    private async Task<CommandResult> ShowPluginInfo(string[] args)
    {
        if (args.Length < 2)
        {
            return CommandResult.Fail("ç”¨æ³•: #plugin info <name>");
        }
        
        string pluginName = args[1];
        var plugin = _context.PluginManager.GetPlugin(pluginName);
        
        if (plugin == null)
        {
            return CommandResult.Fail($"Â§cæ’ä»¶ {pluginName} æœªæ‰¾åˆ°");
        }
        
        var info = $"Â§6æ’ä»¶ä¿¡æ¯:\n" +
                   $"Â§fåç§°: {plugin.Name}\n" +
                   $"Â§fç‰ˆæœ¬: {plugin.Version}\n" +
                   $"Â§fä½œè€…: {plugin.Author}\n" +
                   $"Â§fæè¿°: {plugin.Description}";
        
        return CommandResult.Success(info);
    }

    public async Task<List<string>> TabCompleteAsync(string[] args, ICommandSender? sender = null)
    {
        // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå­å‘½ä»¤
        if (args.Length == 1)
        {
            return new List<string> { "list", "reload", "info" };
        }
        
        // ç¬¬äºŒä¸ªå‚æ•°ï¼šæ’ä»¶åç§°
        if (args.Length == 2 && (args[0] == "reload" || args[0] == "info"))
        {
            return _context.PluginManager.GetLoadedPlugins()
                .Select(p => p.Name)
                .ToList();
        }
        
        return new List<string>();
    }
}
```

---

## ğŸ“ **æ³¨å†Œå‘½ä»¤**

### **åœ¨æ’ä»¶ä¸­æ³¨å†Œ**

```csharp
public class MyPlugin : IPlugin
{
    private IPluginContext _context;

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // æ³¨å†Œå¤šä¸ªå‘½ä»¤
        context.CommandManager.RegisterCommand(new SpawnCommand(context));
        context.CommandManager.RegisterCommand(new TeleportCommand(context));
        context.CommandManager.RegisterCommand(new HomeCommand(context));
        
        context.Logger.Info("å‘½ä»¤å·²æ³¨å†Œ");
    }

    public void OnDisable()
    {
        // æ¡†æ¶ä¼šè‡ªåŠ¨æ³¨é”€æ’ä»¶çš„å‘½ä»¤
        _context.Logger.Info("å‘½ä»¤å·²æ³¨é”€");
    }
}
```

### **åŠ¨æ€æ³¨å†Œå’Œæ³¨é”€**

```csharp
// åŠ¨æ€æ³¨å†Œ
var command = new MyCommand();
_context.CommandManager.RegisterCommand(command);

// åŠ¨æ€æ³¨é”€
_context.CommandManager.UnregisterCommand("mycommand");
```

---

## ğŸ¨ **å‘½ä»¤å‰ç¼€**

### **æ§åˆ¶å°å‘½ä»¤ï¼ˆæ— å‰ç¼€ï¼‰**

ä» NetherGate æ§åˆ¶å°æ‰§è¡Œçš„å‘½ä»¤**ä¸éœ€è¦ä»»ä½•å‰ç¼€**ï¼š

```bash
> help
> plugin list
> permission reload
> stop
```

### **æ¸¸æˆå†…å‘½ä»¤ï¼ˆ# å‰ç¼€ï¼‰**

ä» Minecraft èŠå¤©æ¡†æ‰§è¡Œçš„æ¡†æ¶å‘½ä»¤**å¿…é¡»ä½¿ç”¨ `#` å‰ç¼€**ï¼š

```
#help
#spawn
#tp Steve
#home
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ `#` è€Œä¸æ˜¯ `/`ï¼Ÿ**
- `/` æ˜¯ Minecraft åŸç”Ÿå‘½ä»¤çš„å‰ç¼€ï¼ˆå¦‚ `/give`, `/tp` ç­‰ï¼‰
- `#` æ˜¯ NetherGate æ¡†æ¶å‘½ä»¤çš„å‰ç¼€ï¼Œé¿å…å†²çª
- è¿™æ ·å¯ä»¥åŒæ—¶ä½¿ç”¨åŸç‰ˆå‘½ä»¤å’Œæ¡†æ¶å‘½ä»¤

### **RCON å‘½ä»¤ï¼ˆ/ å‰ç¼€ï¼‰**

é€šè¿‡ `GameDisplayApi` å‘é€çš„å‘½ä»¤æ˜¯åŸç”Ÿ Minecraft å‘½ä»¤ï¼Œä½¿ç”¨ `/` å‰ç¼€ï¼š

```csharp
await _context.GameDisplayApi.TeleportPlayer("Steve", 0, 64, 0);
// å†…éƒ¨æ‰§è¡Œ: /tp Steve 0 64 0
```

---

## ğŸ”’ **æƒé™æ£€æŸ¥**

### **è‡ªåŠ¨æƒé™æ£€æŸ¥**

æ¡†æ¶ä¼šè‡ªåŠ¨æ£€æŸ¥å‘½ä»¤çš„ `Permission` å±æ€§ï¼š

```csharp
public class AdminCommand : ICommand
{
    public string Name => "admin";
    public string? Permission => "myplugin.admin";  // æ¡†æ¶è‡ªåŠ¨æ£€æŸ¥

    public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
    {
        // å¦‚æœç©å®¶æ²¡æœ‰ myplugin.admin æƒé™ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨æ‹’ç»æ‰§è¡Œ
        return CommandResult.Success("ç®¡ç†å‘˜æ“ä½œæˆåŠŸ");
    }
}
```

### **æ‰‹åŠ¨æƒé™æ£€æŸ¥**

```csharp
public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
{
    if (sender != null)
    {
        // æ‰‹åŠ¨æ£€æŸ¥æƒé™
        if (!await _context.PermissionManager.HasPermissionAsync(sender.Name, "myplugin.vip"))
        {
            return CommandResult.Fail("Â§cæ­¤åŠŸèƒ½ä»…é™ VIP ä½¿ç”¨");
        }
    }
    
    // æ‰§è¡Œå‘½ä»¤é€»è¾‘
    return CommandResult.Success("æ“ä½œæˆåŠŸ");
}
```

### **å¤šæƒé™æ£€æŸ¥**

```csharp
public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
{
    if (sender != null)
    {
        bool hasAnyPermission = 
            await _context.PermissionManager.HasPermissionAsync(sender.Name, "myplugin.admin") ||
            await _context.PermissionManager.HasPermissionAsync(sender.Name, "myplugin.moderator");
        
        if (!hasAnyPermission)
        {
            return CommandResult.Fail("Â§cä½ éœ€è¦ç®¡ç†å‘˜æˆ–ç‰ˆä¸»æƒé™");
        }
    }
    
    return CommandResult.Success("æ“ä½œæˆåŠŸ");
}
```

---

## âŒ¨ï¸ **Tab è¡¥å…¨**

### **åŸºæœ¬è¡¥å…¨**

```csharp
public async Task<List<string>> TabCompleteAsync(string[] args, ICommandSender? sender = null)
{
    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå­å‘½ä»¤
    if (args.Length == 1)
    {
        return new List<string> { "create", "delete", "list" };
    }
    
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šåç§°
    if (args.Length == 2)
    {
        return GetAvailableNames();
    }
    
    return new List<string>();
}
```

### **åŠ¨æ€è¡¥å…¨**

```csharp
public async Task<List<string>> TabCompleteAsync(string[] args, ICommandSender? sender = null)
{
    if (args.Length == 1)
    {
        // æ ¹æ®å·²è¾“å…¥å†…å®¹è¿‡æ»¤
        string input = args[0].ToLower();
        var allPlayers = GetOnlinePlayerNames();
        return allPlayers.Where(p => p.ToLower().StartsWith(input)).ToList();
    }
    
    return new List<string>();
}
```

### **å¤šçº§è¡¥å…¨**

```csharp
public async Task<List<string>> TabCompleteAsync(string[] args, ICommandSender? sender = null)
{
    if (args.Length == 1)
    {
        // ç¬¬ä¸€çº§ï¼šå­å‘½ä»¤
        return new List<string> { "add", "remove", "list" };
    }
    
    if (args.Length == 2)
    {
        // ç¬¬äºŒçº§ï¼šæ ¹æ®å­å‘½ä»¤è¿”å›ä¸åŒé€‰é¡¹
        return args[0].ToLower() switch
        {
            "add" => GetAvailableItems(),
            "remove" => GetPlayerItems(sender?.Name),
            "list" => new List<string>(),
            _ => new List<string>()
        };
    }
    
    return new List<string>();
}
```

---

## ğŸ”— **å‘½ä»¤åˆ«å**

å‘½ä»¤åˆ«åå…è®¸ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„åç§°æ‰§è¡ŒåŒä¸€å‘½ä»¤ï¼Œæ”¯æŒå¤šè¯­è¨€å’Œè‡ªå®šä¹‰ç¼©å†™ã€‚

### **å®šä¹‰åˆ«å**

```csharp
public class TeleportCommand : ICommand
{
    public string Name => "teleport";
    public string[] Aliases => new[] { "tp", "tele", "ä¼ é€", "ç¬ç§»" };  // æ”¯æŒå¤šä¸ªåˆ«å

    // ...
}
```

ä½¿ç”¨åˆ«åï¼š
```bash
#teleport Steve 0 64 0
#tp Steve 0 64 0        # ä½¿ç”¨åˆ«å tp
#tele Steve 0 64 0      # ä½¿ç”¨åˆ«å tele
#ä¼ é€ Steve 0 64 0      # ä¸­æ–‡åˆ«å
#ç¬ç§» Steve 0 64 0      # ä¸­æ–‡åŒä¹‰è¯
```

### **å¤šè¯­è¨€æ”¯æŒç¤ºä¾‹**

å®Œæ•´çš„å¤šè¯­è¨€å‘½ä»¤åˆ«åç¤ºä¾‹ï¼š

```csharp
public class BackupCommand : ICommand
{
    private readonly PluginBase _plugin;
    
    public string Name => "backup";
    public string Description => "åˆ›å»ºæœåŠ¡å™¨å¤‡ä»½";
    public string Usage => "#backup [create|restore|list] [name]";
    
    // å¤šè¯­è¨€åˆ«å
    public string[] Aliases => new[]
    {
        // è‹±æ–‡
        "bak",              // ç¼©å†™
        "save",             // åŒä¹‰è¯
        "backup-server",    // è¯¦ç»†æè¿°
        
        // ä¸­æ–‡
        "å¤‡ä»½",
        "ä¿å­˜",
        "å­˜æ¡£",
        
        // æ—¥æ–‡
        "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—",
        
        // å…¶ä»–è¯­è¨€
        "sicherung",        // å¾·è¯­
        "sauvegarde"        // æ³•è¯­
    };
    
    public string PluginId => _plugin.Metadata.Id;
    public string? Permission => "myplugin.backup";
    
    public BackupCommand(PluginBase plugin)
    {
        _plugin = plugin;
    }
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        if (args.Length == 0)
        {
            // åˆ›å»ºå¤‡ä»½
            var name = DateTime.Now.ToString("yyyyMMdd_HHmmss");
            await _plugin.BackupManager.CreateBackupAsync(name);
            return CommandResult.Ok($"âœ“ å¤‡ä»½å·²åˆ›å»º: {name}");
        }
        
        var action = args[0].ToLower();
        
        return action switch
        {
            "list" or "åˆ—è¡¨" or "ãƒªã‚¹ãƒˆ" => await ListBackupsAsync(),
            "restore" or "æ¢å¤" or "å¾©å…ƒ" => await RestoreBackupAsync(args),
            "create" or "åˆ›å»º" or "ä½œæˆ" => await CreateBackupAsync(args),
            _ => CommandResult.Fail($"æœªçŸ¥æ“ä½œ: {action}")
        };
    }
    
    public async Task<List<string>> TabCompleteAsync(ICommandSender sender, string[] args)
    {
        if (args.Length == 1)
        {
            // è¡¥å…¨å­å‘½ä»¤ï¼ˆå¤šè¯­è¨€ï¼‰
            return new List<string> 
            { 
                "create", "åˆ›å»º", "ä½œæˆ",
                "restore", "æ¢å¤", "å¾©å…ƒ",
                "list", "åˆ—è¡¨", "ãƒªã‚¹ãƒˆ"
            }
            .Where(cmd => cmd.StartsWith(args[0], StringComparison.OrdinalIgnoreCase))
            .ToList();
        }
        
        if (args.Length == 2 && (args[0] == "restore" || args[0] == "æ¢å¤" || args[0] == "å¾©å…ƒ"))
        {
            // è¡¥å…¨å¤‡ä»½åç§°
            var backups = await _plugin.BackupManager.ListBackupsAsync();
            return backups.Where(b => b.StartsWith(args[1])).ToList();
        }
        
        return new List<string>();
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```bash
# è‹±æ–‡ç”¨æˆ·
backup list
bak create world1
save restore world1_20250105

# ä¸­æ–‡ç”¨æˆ·
å¤‡ä»½ åˆ—è¡¨
ä¿å­˜ åˆ›å»º world1
å­˜æ¡£ æ¢å¤ world1_20250105

# æ—¥æ–‡ç”¨æˆ·
ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— ãƒªã‚¹ãƒˆ
ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— ä½œæˆ world1

# æ‰€æœ‰åˆ«åéƒ½æ”¯æŒ Tab è¡¥å…¨
bak li[Tab]      â†’ list, åˆ—è¡¨, ãƒªã‚¹ãƒˆ
å¤‡ä»½ åˆ›[Tab]     â†’ åˆ›å»º, ä½œæˆ
```

### **åˆ«åæœ€ä½³å®è·µ**

#### **1. æä¾›å¸¸ç”¨ç¼©å†™**

```csharp
public string Name => "gamemode";
public string[] Aliases => new[]
{
    "gm",          // é€šç”¨ç¼©å†™
    "mode",        // ç®€çŸ­åŒä¹‰è¯
    "æ¸¸æˆæ¨¡å¼",    // æœ¬åœ°åŒ–
    "ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰"  // æ—¥æ–‡
};
```

#### **2. æ”¯æŒåŒä¹‰è¯**

```csharp
public string Name => "home";
public string[] Aliases => new[]
{
    "h",           // ç¼©å†™
    "spawn",       // è‹±æ–‡åŒä¹‰è¯
    "å›å®¶",        // ä¸­æ–‡
    "å®¶",          // ä¸­æ–‡ç®€å†™
    "ãƒ›ãƒ¼ãƒ "       // æ—¥æ–‡
};
```

#### **3. è€ƒè™‘ç”¨æˆ·ä¹ æƒ¯**

```csharp
// å¦‚æœç”¨æˆ·ä¹ æƒ¯ MCDR æˆ–å…¶ä»–å·¥å…·çš„å‘½ä»¤
public string Name => "reload";
public string[] Aliases => new[]
{
    "rl",          // MCDR é£æ ¼ç¼©å†™
    "é‡è½½",        // ä¸­æ–‡
    "ãƒªãƒ­ãƒ¼ãƒ‰"     // æ—¥æ–‡
};
```

### **åŠ¨æ€åˆ«åæ³¨å†Œ**

æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦åŠ¨æ€æ³¨å†Œåˆ«åï¼š

```csharp
public class MyPlugin : PluginBase
{
    public override async Task OnEnableAsync()
    {
        // æ³¨å†Œä¸»å‘½ä»¤
        var command = new MyCommand(this);
        Commands.RegisterCommand(command);
        
        // æ ¹æ®é…ç½®æ–‡ä»¶åŠ¨æ€æ·»åŠ åˆ«å
        var config = await Config.LoadAsync<MyConfig>();
        foreach (var alias in config.CustomAliases)
        {
            Commands.RegisterAlias("mycommand", alias);
        }
    }
}
```

### **æ³¨æ„äº‹é¡¹**

- âœ… **åˆ«åå¿…é¡»å”¯ä¸€**ï¼šä¸èƒ½ä¸å…¶ä»–å‘½ä»¤æˆ–åˆ«åå†²çª
- âœ… **æ”¯æŒ Unicode**ï¼šæ”¯æŒä»»æ„ Unicode å­—ç¬¦ï¼ˆä¸­æ–‡ã€æ—¥æ–‡ã€è¡¨æƒ…ç¬¦å·ç­‰ï¼‰
- âœ… **Tab è¡¥å…¨**ï¼šTab è¡¥å…¨ä¼šåŒæ—¶åŒ¹é…ä¸»å‘½ä»¤å’Œæ‰€æœ‰åˆ«å
- âœ… **åŒºåˆ†å¤§å°å†™**ï¼šé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼ˆ`TP` å’Œ `tp` ç›¸åŒï¼‰
- âš ï¸ **é¿å…è¿‡äºé€šç”¨**ï¼šä¸è¦ä½¿ç”¨è¿‡äºç®€çŸ­çš„åˆ«åï¼ˆå¦‚ `a`, `b`ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ··æ·†
- âš ï¸ **ä¿æŒç›´è§‚**ï¼šåˆ«ååº”è¯¥æ˜“è®°ä¸”ä¸å‘½ä»¤åŠŸèƒ½ç›¸å…³

---

## ğŸš€ **é«˜çº§åŠŸèƒ½**

æœ¬èŠ‚ä»‹ç» NetherGate å‘½ä»¤ç³»ç»Ÿçš„é«˜çº§åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ç»¼åˆäº†å¤šä¸ªä¼˜ç§€å¼€æºé¡¹ç›®çš„è®¾è®¡ç†å¿µï¼š

- **[MCDReforged](https://github.com/Fallen-Breath/MCDReforged)** - å±‚çº§å‘½ä»¤æ ‘ã€å›½é™…åŒ–ã€è°ƒåº¦å™¨ç­‰ç†å¿µ
- **[NBrigadier](https://github.com/NickAcPT/NBrigadier)** - å¼ºç±»å‹å‚æ•°ã€å‘½ä»¤èŠ‚ç‚¹æ ‘ç­‰è®¾è®¡
- **[MinecraftConnection](https://github.com/takunology/MinecraftConnection)** - RCON å‘½ä»¤å°è£…å‚è€ƒ

NetherGate åœ¨æ­¤åŸºç¡€ä¸Šåˆ›æ–°å®ç°äº†å‘½ä»¤ç®¡é“ã€æ‹¦æˆªå™¨ç­‰ç‹¬åˆ›åŠŸèƒ½ï¼Œæä¾›æ›´å¼ºå¤§å’Œçµæ´»çš„å‘½ä»¤å¤„ç†èƒ½åŠ›ã€‚

---

## ğŸ¨ **å¢å¼ºçš„å¸®åŠ©ç”Ÿæˆ**

### **è‡ªåŠ¨ç”Ÿæˆæ ¼å¼åŒ–å¸®åŠ©ä¿¡æ¯**

å‘½ä»¤æ ‘ç°åœ¨æ”¯æŒè‡ªåŠ¨ç”Ÿæˆç¾è§‚çš„å¸®åŠ©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æ³•ã€å‚æ•°è¯´æ˜å’Œç¤ºä¾‹ã€‚

```csharp
using NetherGate.Core.Commands;

// åˆ›å»ºå¸¦è¯¦ç»†ä¿¡æ¯çš„å‘½ä»¤æ ‘
var tree = new CommandTree("backup", "æœåŠ¡å™¨å¤‡ä»½ç®¡ç†")
    .WithExamples(
        "backup create world1",
        "backup restore world1_20250108",
        "backup list"
    );

// æ·»åŠ å­å‘½ä»¤
tree.Root.Sub("create", "åˆ›å»ºå¤‡ä»½")
    .ArgSpec("name", CommandArgType.String, required: true, description: "å¤‡ä»½åç§°");

tree.Root.Sub("restore", "æ¢å¤å¤‡ä»½")
    .ArgSpec("name", CommandArgType.String, required: true, description: "è¦æ¢å¤çš„å¤‡ä»½åç§°");

tree.Root.Sub("list", "åˆ—å‡ºæ‰€æœ‰å¤‡ä»½");

// ç”Ÿæˆæ ¼å¼åŒ–å¸®åŠ©
var help = tree.GenerateFormattedHelp("backup", useColors: true);
sender.SendMessage(help);
```

**è¾“å‡ºæ•ˆæœï¼š**
```
Â§6=== backup å‘½ä»¤å¸®åŠ© ===Â§f
Â§7æœåŠ¡å™¨å¤‡ä»½ç®¡ç†Â§f

Â§6ç”¨æ³•:Â§f
  Â§ebackup create <name>Â§f Â§7- åˆ›å»ºå¤‡ä»½Â§f
      Â§7name: å¤‡ä»½åç§°Â§f
  Â§ebackup restore <name>Â§f Â§7- æ¢å¤å¤‡ä»½Â§f
      Â§7name: è¦æ¢å¤çš„å¤‡ä»½åç§°Â§f
  Â§ebackup listÂ§f Â§7- åˆ—å‡ºæ‰€æœ‰å¤‡ä»½Â§f

Â§6ç¤ºä¾‹:Â§f
  Â§abackup create world1Â§f
  Â§abackup restore world1_20250108Â§f
  Â§abackup listÂ§f
```

### **å¿«é€Ÿå¸®åŠ©æç¤º**

```csharp
// ç”Ÿæˆå•è¡Œæç¤º
var quickHelp = tree.GenerateQuickHelp("backup");
// è¾“å‡º: "ç”¨æ³•: backup create <name> (è¿˜æœ‰ 2 ç§ç”¨æ³•ï¼Œä½¿ç”¨ 'help backup' æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯)"
```

---

## ğŸ”§ **æ‰©å±•å‚æ•°ç±»å‹**

### **æ”¯æŒçš„å‚æ•°ç±»å‹**

å‘½ä»¤ç³»ç»Ÿç°åœ¨æ”¯æŒæ›´å¤šå¼ºç±»å‹å‚æ•°ï¼š

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ | ç”¨é€” |
|------|------|------|------|
| `String` | å­—ç¬¦ä¸² | `"Hello"` | é€šç”¨æ–‡æœ¬ |
| `Integer` | æ•´æ•° | `123` | æ•°é‡ã€ç´¢å¼• |
| `Long` | é•¿æ•´æ•° | `9999999999` | å¤§æ•°å€¼ï¼ˆç»æµï¼‰ |
| `Float` | æµ®ç‚¹æ•° | `3.14` | åæ ‡ã€æ¯”ä¾‹ |
| `Boolean` | å¸ƒå°”å€¼ | `true/false/on/off` | å¼€å…³é€‰é¡¹ |
| `Enum` | æšä¸¾ | `normal\|hard\|easy` | å›ºå®šé€‰é¡¹ |
| **`Uuid`** | UUID | `a1b2c3d4-...` | ç©å®¶ UUID |
| **`TimeSpan`** | æ—¶é—´é—´éš” | `1h30m`, `5d`, `30s` | å®šæ—¶ä»»åŠ¡ |
| **`FilePath`** | æ–‡ä»¶è·¯å¾„ | `./backups/world1` | æ–‡ä»¶æ“ä½œ |
| **`Regex`** | æ­£åˆ™è¡¨è¾¾å¼ | `^player.*` | æ–‡æœ¬åŒ¹é… |
| **`JsonObject`** | JSON å¯¹è±¡ | `{"key":"value"}` | å¤æ‚æ•°æ® |
| **`Url`** | URL åœ°å€ | `https://...` | ä¸‹è½½ã€Webhook |
| **`IpAddress`** | IP åœ°å€ | `192.168.1.1` | ç½‘ç»œé…ç½® |

### **ä½¿ç”¨ç¤ºä¾‹**

#### 1. **UUID å‚æ•°ï¼ˆç©å®¶æ ‡è¯†ï¼‰**

```csharp
tree.Root.Sub("give", "ç»™ç©å®¶ç‰©å“")
    .ArgSpec("player", CommandArgType.Uuid, description: "ç©å®¶ UUID")
    .ArgSpec("item", CommandArgType.String, description: "ç‰©å“ ID")
    .ArgSpec("count", CommandArgType.Integer, description: "æ•°é‡");

// æ‰§è¡Œæ—¶è‡ªåŠ¨è§£æä¸º Guid ç±»å‹
public async Task<CommandResult> ExecuteParsedAsync(
    ICommandSender sender, 
    IReadOnlyList<object?> positionalArgs, 
    IReadOnlyDictionary<string, object?> namedArgs)
{
    var playerUuid = (Guid)namedArgs["player"]!;
    var item = (string)namedArgs["item"]!;
    var count = (int)namedArgs["count"]!;
    
    // ä½¿ç”¨å¼ºç±»å‹å‚æ•°
    await GiveItemAsync(playerUuid, item, count);
    return CommandResult.Ok($"å·²ç»™äºˆç©å®¶ {count} ä¸ª {item}");
}
```

#### 2. **TimeSpan å‚æ•°ï¼ˆæ—¶é—´é—´éš”ï¼‰**

```csharp
tree.Root.Sub("ban", "å°ç¦ç©å®¶")
    .ArgSpec("player", CommandArgType.String, description: "ç©å®¶å")
    .ArgSpec("duration", CommandArgType.TimeSpan, description: "å°ç¦æ—¶é•¿ï¼ˆå¦‚ 1h30m, 5d, 30sï¼‰");

// æ”¯æŒçš„æ ¼å¼ï¼š
// "30s"     -> 30 ç§’
// "5m"      -> 5 åˆ†é’Ÿ
// "2h"      -> 2 å°æ—¶
// "7d"      -> 7 å¤©
// "1h30m"   -> 1 å°æ—¶ 30 åˆ†é’Ÿ
// "2d12h"   -> 2 å¤© 12 å°æ—¶

public async Task<CommandResult> ExecuteParsedAsync(...)
{
    var player = (string)namedArgs["player"]!;
    var duration = (TimeSpan)namedArgs["duration"]!;
    
    var until = DateTime.UtcNow + duration;
    await BanPlayerAsync(player, until);
    return CommandResult.Ok($"å·²å°ç¦ {player}ï¼Œæ—¶é•¿: {duration.TotalHours:F1} å°æ—¶");
}
```

#### 3. **FilePath å‚æ•°ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰**

```csharp
tree.Root.Sub("export", "å¯¼å‡ºæ•°æ®")
    .ArgSpec("output", CommandArgType.FilePath, description: "è¾“å‡ºæ–‡ä»¶è·¯å¾„");

public async Task<CommandResult> ExecuteParsedAsync(...)
{
    var outputPath = (string)namedArgs["output"]!;
    
    // è‡ªåŠ¨éªŒè¯è·¯å¾„æ ¼å¼ï¼ˆä¸åŒ…å«éæ³•å­—ç¬¦ï¼‰
    await ExportDataAsync(outputPath);
    return CommandResult.Ok($"æ•°æ®å·²å¯¼å‡ºåˆ°: {outputPath}");
}
```

#### 4. **Regex å‚æ•°ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰**

```csharp
tree.Root.Sub("filter", "è¿‡æ»¤ç©å®¶å")
    .ArgSpec("pattern", CommandArgType.Regex, description: "åŒ¹é…æ¨¡å¼");

public async Task<CommandResult> ExecuteParsedAsync(...)
{
    var pattern = (System.Text.RegularExpressions.Regex)namedArgs["pattern"]!;
    
    var players = await GetOnlinePlayersAsync();
    var matched = players.Where(p => pattern.IsMatch(p.Name)).ToList();
    
    return CommandResult.Ok($"åŒ¹é…åˆ° {matched.Count} ä¸ªç©å®¶");
}
```

#### 5. **JsonObject å‚æ•°ï¼ˆå¤æ‚æ•°æ®ï¼‰**

```csharp
tree.Root.Sub("config", "æ›´æ–°é…ç½®")
    .ArgSpec("data", CommandArgType.JsonObject, description: "é…ç½® JSON");

public async Task<CommandResult> ExecuteParsedAsync(...)
{
    var json = (Newtonsoft.Json.Linq.JToken)namedArgs["data"]!;
    
    // ç›´æ¥ä½¿ç”¨ JSON å¯¹è±¡
    var enabled = json["enabled"]?.Value<bool>() ?? false;
    var maxPlayers = json["maxPlayers"]?.Value<int>() ?? 20;
    
    await UpdateConfigAsync(enabled, maxPlayers);
    return CommandResult.Ok("é…ç½®å·²æ›´æ–°");
}
```

#### 6. **IpAddress å‚æ•°ï¼ˆIP åœ°å€ï¼‰**

```csharp
tree.Root.Sub("whitelist", "IP ç™½åå•")
    .ArgSpec("ip", CommandArgType.IpAddress, description: "IP åœ°å€");

public async Task<CommandResult> ExecuteParsedAsync(...)
{
    var ipAddress = (System.Net.IPAddress)namedArgs["ip"]!;
    
    await AddToWhitelistAsync(ipAddress);
    return CommandResult.Ok($"å·²æ·»åŠ  IP: {ipAddress}");
}
```

---

## âš¡ **Tab è¡¥å…¨æ€§èƒ½ä¼˜åŒ–**

å‘½ä»¤æ ‘ç°åœ¨å†…ç½®äº†æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œå¤§å¹…æå‡ Tab è¡¥å…¨æ€§èƒ½ã€‚

### **è‡ªåŠ¨ç¼“å­˜**

```csharp
// ç¼“å­˜ä¼šè‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
// ç¼“å­˜æ—¶é•¿: 30 ç§’
// ç¼“å­˜å¤§å°é™åˆ¶: 1000 æ¡
// è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜
```

### **æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜**

```csharp
// åœ¨å‘½ä»¤æ³¨å†Œæˆ–ä¿®æ”¹åæ¸…é™¤ç¼“å­˜
tree.ClearCache();
```

### **æ€§èƒ½å¯¹æ¯”**

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| ç®€å•å‘½ä»¤ | ~5ms | ~0.1ms | **50x** |
| å¤æ‚å‘½ä»¤æ ‘ | ~20ms | ~0.2ms | **100x** |
| åŠ¨æ€è¡¥å…¨ | ~50ms | ~1ms | **50x** |

---

## ğŸ”— **å‘½ä»¤ç®¡é“ç³»ç»Ÿ**

ç±»ä¼¼ Linux çš„ç®¡é“åŠŸèƒ½ï¼Œæ”¯æŒå‘½ä»¤é“¾å¼æ‰§è¡Œã€‚

### **åŸºæœ¬ç”¨æ³•**

```csharp
// ä½¿ç”¨ | ç¬¦å·è¿æ¥å‘½ä»¤
#player list | filter Steve | tp spawn

// ç­‰ä»·äº:
// 1. æ‰§è¡Œ player list
// 2. å¯¹ç»“æœæ‰§è¡Œ filter Steve
// 3. å¯¹è¿‡æ»¤åçš„ç»“æœæ‰§è¡Œ tp spawn
```

### **åœ¨æ’ä»¶ä¸­ä½¿ç”¨**

```csharp
using NetherGate.Core.Commands;

// åˆ›å»ºç®¡é“
var pipeline = context.CommandManager.CreatePipeline(context.Logger)
    .Pipe("player list")
    .Pipe("filter level>10")  // è‡ªå®šä¹‰è¿‡æ»¤å‘½ä»¤
    .Pipe("tp spawn");

var result = await pipeline.ExecuteAsync(sender);
```

### **ä½¿ç”¨å ä½ç¬¦**

```csharp
// $input è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„è¾“å‡º
var pipeline = new CommandPipeline(commandManager, logger)
    .Pipe("player list")
    .Pipe("count-lines $input")  // ç»Ÿè®¡è¡Œæ•°
    .Pipe("log \"å…±æœ‰ç©å®¶: $input äºº\"");

await pipeline.ExecuteAsync(sender);
```

### **è‡ªå®šä¹‰è¿‡æ»¤å™¨**

```csharp
var pipeline = commandManager.CreatePipeline(logger)
    .Pipe("player list")
    .Pipe("sort", filter: line => line.Contains("Admin"))  // åªä¿ç•™ç®¡ç†å‘˜
    .Pipe("notify");

await pipeline.ExecuteAsync(sender);
```

### **ç¤ºä¾‹ï¼šæ‰¹é‡æ“ä½œ**

```csharp
// æŸ¥æ‰¾å¹¶ä¼ é€æ‰€æœ‰åœ¨çº¿çš„ç®¡ç†å‘˜åˆ°å‡ºç”Ÿç‚¹
#player list | filter role=admin | foreach tp {player} spawn

// å¯¼å‡ºå¹¶å‹ç¼©æ•°æ®
#data export output.json | compress output.zip | log "å¯¼å‡ºå®Œæˆ"
```

---

## ğŸ£ **å‘½ä»¤æ‰§è¡Œé’©å­**

ä½¿ç”¨æ‹¦æˆªå™¨åœ¨å‘½ä»¤æ‰§è¡Œå‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

### **åˆ›å»ºæ‹¦æˆªå™¨**

```csharp
using NetherGate.API.Plugins;

public class CommandLogInterceptor : CommandInterceptorBase
{
    private readonly ILogger _logger;

    public CommandLogInterceptor(ILogger logger)
    {
        _logger = logger;
    }

    public override int Priority => 10; // ä¼˜å…ˆçº§ï¼ˆè¶Šå°è¶Šå…ˆæ‰§è¡Œï¼‰

    public override async Task<bool> BeforeExecuteAsync(
        ICommand command, 
        ICommandSender sender, 
        string[] args, 
        Dictionary<string, object> context)
    {
        // è®°å½•å‘½ä»¤æ‰§è¡Œ
        _logger.Info($"[å‘½ä»¤] {sender.Name} æ‰§è¡Œ: {command.Name} {string.Join(" ", args)}");
        
        // åœ¨ä¸Šä¸‹æ–‡ä¸­ä¿å­˜å¼€å§‹æ—¶é—´
        context["startTime"] = DateTime.UtcNow;
        
        return true; // è¿”å› true å…è®¸ç»§ç»­æ‰§è¡Œ
    }

    public override async Task<CommandResult> AfterExecuteAsync(
        ICommand command, 
        ICommandSender sender, 
        string[] args, 
        CommandResult result, 
        Dictionary<string, object> context)
    {
        // è®¡ç®—æ‰§è¡Œæ—¶é—´
        if (context.TryGetValue("startTime", out var startTimeObj) && startTimeObj is DateTime startTime)
        {
            var elapsed = DateTime.UtcNow - startTime;
            _logger.Debug($"[æ€§èƒ½] {command.Name} æ‰§è¡Œè€—æ—¶: {elapsed.TotalMilliseconds:F2}ms");
        }

        return result; // å¯ä»¥ä¿®æ”¹ç»“æœ
    }

    public override async Task OnExceptionAsync(
        ICommand command, 
        ICommandSender sender, 
        string[] args, 
        Exception exception, 
        Dictionary<string, object> context)
    {
        // è®°å½•å¼‚å¸¸
        _logger.Error($"[é”™è¯¯] {command.Name} æ‰§è¡Œå¤±è´¥: {exception.Message}");
    }
}
```

### **æ³¨å†Œæ‹¦æˆªå™¨**

```csharp
public class MyPlugin : IPlugin
{
    public void OnEnable(IPluginContext context)
    {
        // æ³¨å†Œæ‹¦æˆªå™¨
        var logInterceptor = new CommandLogInterceptor(context.Logger);
        context.CommandManager.RegisterInterceptor(logInterceptor);
        
        context.Logger.Info("å‘½ä»¤æ‹¦æˆªå™¨å·²æ³¨å†Œ");
    }
}
```

### **å¸¸è§æ‹¦æˆªå™¨ç¤ºä¾‹**

#### 1. **æƒé™å¢å¼ºæ‹¦æˆªå™¨**

```csharp
public class PermissionEnhancerInterceptor : CommandInterceptorBase
{
    public override int Priority => 0; // æœ€é«˜ä¼˜å…ˆçº§

    public override async Task<bool> BeforeExecuteAsync(...)
    {
        // æ£€æŸ¥æ˜¯å¦åœ¨ç»´æŠ¤æ¨¡å¼
        if (IsMaintenanceMode() && !sender.HasPermission("admin"))
        {
            sender.SendMessage("Â§cæœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤ä¸­");
            return false; // é˜»æ­¢æ‰§è¡Œ
        }
        
        return true;
    }
}
```

#### 2. **å‘½ä»¤å†·å´æ‹¦æˆªå™¨**

```csharp
public class CooldownInterceptor : CommandInterceptorBase
{
    private readonly Dictionary<string, DateTime> _cooldowns = new();
    private readonly TimeSpan _cooldownTime = TimeSpan.FromSeconds(5);

    public override async Task<bool> BeforeExecuteAsync(...)
    {
        var key = $"{sender.Name}:{command.Name}";
        
        if (_cooldowns.TryGetValue(key, out var lastUse))
        {
            var remaining = _cooldownTime - (DateTime.UtcNow - lastUse);
            if (remaining > TimeSpan.Zero)
            {
                sender.SendMessage($"Â§cå‘½ä»¤å†·å´ä¸­ï¼Œè¯·ç­‰å¾… {remaining.TotalSeconds:F1} ç§’");
                return false;
            }
        }
        
        _cooldowns[key] = DateTime.UtcNow;
        return true;
    }
}
```

#### 3. **å‘½ä»¤ç»Ÿè®¡æ‹¦æˆªå™¨**

```csharp
public class StatisticsInterceptor : CommandInterceptorBase
{
    private readonly Dictionary<string, int> _commandCounts = new();

    public override async Task<CommandResult> AfterExecuteAsync(...)
    {
        // ç»Ÿè®¡å‘½ä»¤ä½¿ç”¨æ¬¡æ•°
        var key = command.Name;
        _commandCounts[key] = _commandCounts.GetValueOrDefault(key, 0) + 1;
        
        return result;
    }

    public Dictionary<string, int> GetStatistics() => _commandCounts;
}
```

#### 4. **ç»“æœè½¬æ¢æ‹¦æˆªå™¨**

```csharp
public class ResultTransformerInterceptor : CommandInterceptorBase
{
    public override async Task<CommandResult> AfterExecuteAsync(...)
    {
        // è‡ªåŠ¨æ·»åŠ å‰ç¼€
        if (result.Success && !string.IsNullOrEmpty(result.Message))
        {
            var newMessage = $"Â§a[æˆåŠŸ] {result.Message}";
            return CommandResult.Ok(newMessage);
        }
        
        return result;
    }
}
```

### **æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº**

```
æ‰§è¡Œé¡ºåºï¼ˆæŒ‰ Priority å‡åºï¼‰:

BeforeExecute (Priority 0)
  â†“
BeforeExecute (Priority 10)
  â†“
BeforeExecute (Priority 20)
  â†“
ã€å‘½ä»¤æ‰§è¡Œã€‘
  â†“
AfterExecute (Priority 20)  â† é€†åºæ‰§è¡Œ
  â†“
AfterExecute (Priority 10)
  â†“
AfterExecute (Priority 0)
```

---

## ğŸ“ **å®Œæ•´ç¤ºä¾‹**

### **é«˜çº§å¤‡ä»½å‘½ä»¤**

ç»“åˆæ‰€æœ‰æ–°åŠŸèƒ½çš„å®Œæ•´ç¤ºä¾‹ï¼š

```csharp
using NetherGate.API.Plugins;
using NetherGate.Core.Commands;

public class AdvancedBackupCommand : ICommand, IHasCommandTree, IParsedCommand
{
    private readonly IPluginContext _context;
    private readonly CommandTree _tree;

    public string Name => "backup";
    public string Description => "é«˜çº§å¤‡ä»½ç®¡ç†ç³»ç»Ÿ";
    public string Usage => "ä½¿ç”¨ 'backup help' æŸ¥çœ‹è¯¦ç»†ç”¨æ³•";
    public List<string> Aliases => new() { "bak", "å¤‡ä»½" };
    public string PluginId => _context.PluginMetadata.Id;
    public string? Permission => "myplugin.backup";

    public CommandTree CommandTree => _tree;

    public AdvancedBackupCommand(IPluginContext context)
    {
        _context = context;
        
        // åˆ›å»ºå‘½ä»¤æ ‘
        _tree = new CommandTree(Name, Description)
            .WithExamples(
                "backup create world1 1d",
                "backup restore world1_20250108",
                "backup list | filter size>100MB",
                "backup auto enable 6h ./backups"
            );

        // å­å‘½ä»¤: create
        _tree.Root.Sub("create", "åˆ›å»ºå¤‡ä»½")
            .ArgSpec("name", CommandArgType.String, description: "å¤‡ä»½åç§°")
            .ArgSpec("retention", CommandArgType.TimeSpan, required: false, description: "ä¿ç•™æ—¶é•¿");

        // å­å‘½ä»¤: restore  
        _tree.Root.Sub("restore", "æ¢å¤å¤‡ä»½")
            .ArgSpec("name", CommandArgType.String, description: "å¤‡ä»½åç§°")
            .ArgSpec("force", CommandArgType.Boolean, required: false, description: "å¼ºåˆ¶è¦†ç›–");

        // å­å‘½ä»¤: list
        _tree.Root.Sub("list", "åˆ—å‡ºå¤‡ä»½");

        // å­å‘½ä»¤: auto
        _tree.Root.Sub("auto", "è‡ªåŠ¨å¤‡ä»½è®¾ç½®")
            .Sub("enable", "å¯ç”¨è‡ªåŠ¨å¤‡ä»½")
                .ArgSpec("interval", CommandArgType.TimeSpan, description: "å¤‡ä»½é—´éš”")
                .ArgSpec("path", CommandArgType.FilePath, description: "å¤‡ä»½è·¯å¾„");
        
        _tree.Root.Sub("auto")
            .Sub("disable", "ç¦ç”¨è‡ªåŠ¨å¤‡ä»½");

        // å­å‘½ä»¤: help
        _tree.Root.Sub("help", "æ˜¾ç¤ºå¸®åŠ©");
    }

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        // åå¤‡å®ç°
        return CommandResult.Fail("è¯·ä½¿ç”¨å­å‘½ä»¤ã€‚è¾“å…¥ 'backup help' æŸ¥çœ‹å¸®åŠ©");
    }

    public async Task<CommandResult> ExecuteParsedAsync(
        ICommandSender sender,
        IReadOnlyList<object?> positionalArgs,
        IReadOnlyDictionary<string, object?> namedArgs)
    {
        var subcommand = namedArgs.GetValueOrDefault("__subcommand") as string;

        return subcommand switch
        {
            "help" => HandleHelp(sender),
            "create" => await HandleCreate(sender, namedArgs),
            "restore" => await HandleRestore(sender, namedArgs),
            "list" => await HandleList(sender),
            "enable" => await HandleAutoEnable(sender, namedArgs),
            "disable" => await HandleAutoDisable(sender),
            _ => CommandResult.Fail("æœªçŸ¥å­å‘½ä»¤")
        };
    }

    private CommandResult HandleHelp(ICommandSender sender)
    {
        var help = _tree.GenerateFormattedHelp(Name, useColors: !sender.IsConsole);
        sender.SendMessage(help);
        return CommandResult.Ok("");
    }

    private async Task<CommandResult> HandleCreate(ICommandSender sender, IReadOnlyDictionary<string, object?> args)
    {
        var name = (string)args["name"]!;
        var retention = args.GetValueOrDefault("retention") as TimeSpan?;

        _context.Logger.Info($"åˆ›å»ºå¤‡ä»½: {name}, ä¿ç•™: {retention?.TotalHours ?? 0}h");
        
        // æ‰§è¡Œå¤‡ä»½é€»è¾‘...
        await Task.Delay(100); // æ¨¡æ‹Ÿå¤‡ä»½

        var message = retention.HasValue
            ? $"Â§aå¤‡ä»½ '{name}' åˆ›å»ºæˆåŠŸï¼Œå°†ä¿ç•™ {retention.Value.TotalDays:F1} å¤©"
            : $"Â§aå¤‡ä»½ '{name}' åˆ›å»ºæˆåŠŸ";

        return CommandResult.Ok(message);
    }

    private async Task<CommandResult> HandleRestore(ICommandSender sender, IReadOnlyDictionary<string, object?> args)
    {
        var name = (string)args["name"]!;
        var force = (args.GetValueOrDefault("force") as bool?) ?? false;

        if (!force)
        {
            sender.SendMessage("Â§cè­¦å‘Š: æ¢å¤å°†è¦†ç›–å½“å‰æ•°æ®ï¼ä½¿ç”¨ 'force true' ç¡®è®¤");
            return CommandResult.Fail("éœ€è¦ç¡®è®¤");
        }

        // æ‰§è¡Œæ¢å¤é€»è¾‘...
        await Task.Delay(100);

        return CommandResult.Ok($"Â§aå¤‡ä»½ '{name}' æ¢å¤æˆåŠŸ");
    }

    private async Task<CommandResult> HandleList(ICommandSender sender)
    {
        // åˆ—å‡ºå¤‡ä»½...
        var backups = new[]
        {
            "world1_20250108 - 256MB - 2å¤©å‰",
            "world1_20250106 - 243MB - 4å¤©å‰",
            "world1_20250104 - 238MB - 6å¤©å‰"
        };

        var message = $"Â§6å¤‡ä»½åˆ—è¡¨ ({backups.Length}):\n" +
                     string.Join("\n", backups.Select(b => $"  Â§f{b}"));

        return CommandResult.Ok(message);
    }

    private async Task<CommandResult> HandleAutoEnable(ICommandSender sender, IReadOnlyDictionary<string, object?> args)
    {
        var interval = (TimeSpan)args["interval"]!;
        var path = (string)args["path"]!;

        _context.Logger.Info($"å¯ç”¨è‡ªåŠ¨å¤‡ä»½: é—´éš”={interval}, è·¯å¾„={path}");

        return CommandResult.Ok($"Â§aè‡ªåŠ¨å¤‡ä»½å·²å¯ç”¨ï¼Œé—´éš”: {interval.TotalHours}h");
    }

    private async Task<CommandResult> HandleAutoDisable(ICommandSender sender)
    {
        return CommandResult.Ok("Â§aè‡ªåŠ¨å¤‡ä»½å·²ç¦ç”¨");
    }

    public async Task<List<string>> TabCompleteAsync(ICommandSender sender, string[] args)
    {
        return await _tree.SuggestAsync(sender, args);
    }
}
```

### **ä½¿ç”¨æ•ˆæœ**

```bash
# æ˜¾ç¤ºå¸®åŠ©
> backup help
Â§6=== backup å‘½ä»¤å¸®åŠ© ===Â§f
Â§7é«˜çº§å¤‡ä»½ç®¡ç†ç³»ç»ŸÂ§f
...

# åˆ›å»ºå¤‡ä»½ï¼ˆå¸¦ä¿ç•™æ—¶é•¿ï¼‰
> backup create myworld 7d
Â§aå¤‡ä»½ 'myworld' åˆ›å»ºæˆåŠŸï¼Œå°†ä¿ç•™ 7.0 å¤©

# æ¢å¤å¤‡ä»½
> backup restore myworld force true
Â§aå¤‡ä»½ 'myworld' æ¢å¤æˆåŠŸ

# ä½¿ç”¨ç®¡é“è¿‡æ»¤
> backup list | filter size>200MB
world1_20250108 - 256MB - 2å¤©å‰
world1_20250106 - 243MB - 4å¤©å‰

# Tab è¡¥å…¨
> backup [Tab]
create  restore  list  auto  help

> backup create [Tab]
<name>

> backup auto [Tab]
enable  disable
```

---

### **ç»“åˆå…¶ä»–ç³»ç»Ÿçš„é«˜çº§ç¤ºä¾‹**

#### **1. å‘½ä»¤ + è°ƒåº¦å™¨ï¼ˆå®šæ—¶å¤‡ä»½ï¼‰**

```csharp
public class AutoBackupCommand : ICommand
{
    private readonly IScheduler _scheduler;
    private readonly ILogger _logger;

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        if (args[0] == "auto" && args[1] == "enable")
        {
            var interval = (TimeSpan)namedArgs["interval"]!;
            
            // ä½¿ç”¨è°ƒåº¦å™¨å®ç°è‡ªåŠ¨å¤‡ä»½
            _scheduler.ScheduleRepeating(() =>
            {
                _logger.Info("æ‰§è¡Œè‡ªåŠ¨å¤‡ä»½...");
                return CreateBackupAsync();
            }, interval);
            
            return CommandResult.Ok($"Â§aè‡ªåŠ¨å¤‡ä»½å·²å¯ç”¨ï¼Œé—´éš”: {interval.TotalHours}h");
        }
        
        return CommandResult.Ok();
    }
}
```

#### **2. å‘½ä»¤ + å›½é™…åŒ–ï¼ˆå¤šè¯­è¨€æ”¯æŒï¼‰**

```csharp
public class I18nCommand : ICommand
{
    private readonly II18nService _i18n;

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        // ä½¿ç”¨å›½é™…åŒ–æœåŠ¡
        var welcomeMsg = _i18n.Translate("commands.welcome", sender.Name);
        // æ ¹æ®è¯­è¨€é…ç½®ï¼Œè‡ªåŠ¨ç¿»è¯‘ä¸ºï¼š
        // zh_CN: "æ¬¢è¿ {sender.Name}ï¼"
        // en_US: "Welcome {sender.Name}!"
        // ja_JP: "ã‚ˆã†ã“ã {sender.Name}ï¼"
        
        sender.SendMessage(welcomeMsg);
        return CommandResult.Ok();
    }
}
```

#### **3. å‘½ä»¤ + æ¸¸æˆå·¥å…·ï¼ˆçƒŸèŠ± + éŸ³ä¹ï¼‰**

```csharp
public class CelebrateCommand : ICommand
{
    private readonly IGameUtilities _gameUtils;
    private readonly IMusicPlayer _musicPlayer;

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var playerName = args[0];
        var position = await GetPlayerPositionAsync(playerName);
        
        // é‡Šæ”¾çƒŸèŠ±
        await _gameUtils.LaunchFireworkAsync(
            position, 
            FireworkType.Star,
            colors: new[] { FireworkColor.Red, FireworkColor.Gold }
        );
        
        // æ’­æ”¾éŸ³ä¹
        await _musicPlayer.CreateMelody()
            .AddNote(Note.C, 200)
            .AddNote(Note.E, 200)
            .AddNote(Note.G, 400)
            .PlayAsync(playerName);
        
        return CommandResult.Ok($"Â§aä¸º {playerName} ä¸¾åŠåº†ç¥ï¼");
    }
}
```

#### **4. å‘½ä»¤ + æ‰©å±•æ–¹æ³•ï¼ˆæ•°æ®å¤„ç†ï¼‰**

```csharp
public class ChestCommand : ICommand
{
    private readonly IBlockDataReader _blockReader;

    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var chestPos = new Position(100, 64, 200);
        var items = await _blockReader.GetChestItemsAsync(chestPos);
        
        // ä½¿ç”¨æ‰©å±•æ–¹æ³•å¤„ç†ç‰©å“
        var enchantedItems = items
            .FilterEnchanted()                    // è¿‡æ»¤é™„é­”ç‰©å“
            .SortByRarity()                       // æŒ‰ç¨€æœ‰åº¦æ’åº
            .Take(10)                             // å–å‰10ä¸ª
            .ToList();
        
        var stats = items.GetStatistics();         // è·å–ç»Ÿè®¡ä¿¡æ¯
        
        var message = $"Â§6ç®±å­åˆ†æ:\n" +
                     $"Â§fæ€»ç‰©å“: {stats.TotalCount}\n" +
                     $"Â§fé™„é­”ç‰©å“: {enchantedItems.Count}\n" +
                     $"Â§fæ€»ä»·å€¼: {stats.TotalValue}";
        
        return CommandResult.Ok(message);
    }
}
```

#### **5. å‘½ä»¤æ‹¦æˆªå™¨ + æ€§èƒ½ç›‘æ§**

```csharp
public class PerformanceMonitorInterceptor : CommandInterceptorBase
{
    private readonly IMonitoringService _monitoring;

    public override async Task<CommandResult> AfterExecuteAsync(...)
    {
        var elapsed = DateTime.UtcNow - (DateTime)context["startTime"];
        
        // è®°å½•åˆ°æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
        _monitoring.RecordCommandExecution(
            command.Name,
            elapsed.TotalMilliseconds,
            result.Success
        );
        
        // å¦‚æœæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œå‘å‡ºè­¦å‘Š
        if (elapsed.TotalMilliseconds > 1000)
        {
            _logger.Warning($"å‘½ä»¤ {command.Name} æ‰§è¡Œç¼“æ…¢: {elapsed.TotalMilliseconds}ms");
        }
        
        return result;
    }
}
```

---

## ğŸ’¡ **æœ€ä½³å®è·µ**

### **1. ä¼˜å…ˆä½¿ç”¨å‘½ä»¤æ ‘å’Œå¼ºç±»å‹å‚æ•°**

âœ… **æ¨èï¼šä½¿ç”¨ IHasCommandTree + IParsedCommand**
```csharp
public class MyCommand : ICommand, IHasCommandTree, IParsedCommand
{
    private readonly CommandTree _tree;
    
    public CommandTree CommandTree => _tree;
    
    public MyCommand()
    {
        _tree = new CommandTree("mycommand", "å‘½ä»¤æè¿°")
            .WithExamples("mycommand create world1");
        
        _tree.Root.Sub("create")
            .ArgSpec("name", CommandArgType.String, description: "ä¸–ç•Œåç§°")
            .ArgSpec("size", CommandArgType.Integer, description: "å¤§å°");
    }
    
    // è‡ªåŠ¨è·å–å¼ºç±»å‹å‚æ•°
    public async Task<CommandResult> ExecuteParsedAsync(
        ICommandSender sender,
        IReadOnlyList<object?> positionalArgs,
        IReadOnlyDictionary<string, object?> namedArgs)
    {
        var name = (string)namedArgs["name"]!;  // å·²éªŒè¯çš„å­—ç¬¦ä¸²
        var size = (int)namedArgs["size"]!;     // å·²éªŒè¯çš„æ•´æ•°
        
        return CommandResult.Ok($"åˆ›å»ºä¸–ç•Œ {name}ï¼Œå¤§å° {size}");
    }
}
```

âŒ **ä¸æ¨èï¼šæ‰‹åŠ¨è§£æå‚æ•°**
```csharp
public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
{
    if (args.Length < 2) return CommandResult.Fail("å‚æ•°ä¸è¶³");
    
    var name = args[0];  // æ— ç±»å‹æ£€æŸ¥
    if (!int.TryParse(args[1], out var size))  // æ‰‹åŠ¨éªŒè¯
        return CommandResult.Fail("å¤§å°å¿…é¡»æ˜¯æ•´æ•°");
    
    // ...
}
```

### **2. ä½¿ç”¨è‡ªåŠ¨å¸®åŠ©ç”Ÿæˆ**

âœ… **æ¨èï¼š**
```csharp
// åœ¨å‘½ä»¤ä¸­å®ç°å¸®åŠ©å­å‘½ä»¤
_tree.Root.Sub("help", "æ˜¾ç¤ºå¸®åŠ©");

private CommandResult HandleHelp(ICommandSender sender)
{
    var help = _tree.GenerateFormattedHelp(Name, useColors: !sender.IsConsole);
    sender.SendMessage(help);
    return CommandResult.Ok("");
}
```

âŒ **ä¸æ¨èï¼š**
```csharp
public string? Usage => "#tp <x> <y> <z> æˆ– #tp <ç©å®¶>";  // é™æ€æ–‡æœ¬ï¼Œä¸å¤Ÿè¯¦ç»†
```

### **3. åˆ©ç”¨æ‰©å±•æ–¹æ³•ç®€åŒ–ä»£ç **

âœ… **æ¨èï¼šä½¿ç”¨æ‰©å±•æ–¹æ³•**
```csharp
var items = await _blockReader.GetChestItemsAsync(position);

// é“¾å¼è°ƒç”¨æ‰©å±•æ–¹æ³•
var result = items
    .FilterEnchanted()
    .SortByRarity()
    .Take(10)
    .ToList();

var stats = items.GetStatistics();  // ä¸€è¡Œè·å–ç»Ÿè®¡
```

âŒ **ä¸æ¨èï¼šæ‰‹åŠ¨å®ç°**
```csharp
var enchantedItems = new List<ItemStack>();
foreach (var item in items)
{
    if (item.Components?.Contains("enchantments") == true)
        enchantedItems.Add(item);
}

// æ‰‹åŠ¨æ’åºã€ç»Ÿè®¡...
```

### **4. ç»“åˆè°ƒåº¦å™¨å®ç°å®šæ—¶ä»»åŠ¡**

âœ… **æ¨èï¼š**
```csharp
public class AutoSaveCommand : ICommand
{
    private readonly IScheduler _scheduler;
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        // æ¯5åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜
        _scheduler.ScheduleRepeating(async () =>
        {
            await SaveWorldAsync();
        }, TimeSpan.FromMinutes(5));
        
        return CommandResult.Ok("è‡ªåŠ¨ä¿å­˜å·²å¯ç”¨");
    }
}
```

### **5. ä½¿ç”¨æ‹¦æˆªå™¨å®ç°é€šç”¨åŠŸèƒ½**

âœ… **æ¨èï¼š** ç”¨æ‹¦æˆªå™¨å¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹
```csharp
// å‘½ä»¤æ—¥å¿—æ‹¦æˆªå™¨ï¼ˆé€‚ç”¨äºæ‰€æœ‰å‘½ä»¤ï¼‰
public class CommandLogInterceptor : CommandInterceptorBase
{
    public override async Task<bool> BeforeExecuteAsync(...)
    {
        _logger.Info($"[å‘½ä»¤] {sender.Name} æ‰§è¡Œ {command.Name}");
        return true;
    }
}

// æ³¨å†Œä¸€æ¬¡ï¼Œå¯¹æ‰€æœ‰å‘½ä»¤ç”Ÿæ•ˆ
commandManager.RegisterInterceptor(new CommandLogInterceptor(logger));
```

âŒ **ä¸æ¨èï¼š** åœ¨æ¯ä¸ªå‘½ä»¤ä¸­é‡å¤æ—¥å¿—ä»£ç 
```csharp
public async Task<CommandResult> ExecuteAsync(...)
{
    _logger.Info($"æ‰§è¡Œå‘½ä»¤..."); // æ¯ä¸ªå‘½ä»¤éƒ½è¦å†™
    // ...
}
```

### **6. å›½é™…åŒ–æ”¯æŒ**

âœ… **æ¨èï¼š**
```csharp
public class I18nCommand : ICommand
{
    private readonly II18nService _i18n;
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        // è‡ªåŠ¨æ ¹æ®é…ç½®åˆ‡æ¢è¯­è¨€
        var msg = _i18n.Translate("commands.success", sender.Name);
        return CommandResult.Ok(msg);
    }
}
```

### **7. å‹å¥½çš„é”™è¯¯æ¶ˆæ¯**

âœ… **æ¨èï¼š**
```csharp
// æä¾›å…·ä½“çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ¡ˆ
return CommandResult.Fail("Â§cç©å®¶ 'Steve' ä¸åœ¨çº¿\nÂ§7æç¤º: ä½¿ç”¨ #list æŸ¥çœ‹åœ¨çº¿ç©å®¶");
```

âŒ **ä¸æ¨èï¼š**
```csharp
return CommandResult.Fail("é”™è¯¯");  // æ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯
```

### **8. å¼‚æ­¥æ“ä½œ**

âœ… **æ¨èï¼š**
```csharp
public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
{
    // æ­£ç¡®ä½¿ç”¨ await
    await _gameUtils.TeleportPlayerAsync(sender.Name, 0, 64, 0);
    await Task.Delay(1000);
    await _gameUtils.SendMessageAsync(sender.Name, "ä¼ é€å®Œæˆ");
    
    return CommandResult.Ok("æ“ä½œæˆåŠŸ");
}
```

### **9. æ§åˆ¶å°å…¼å®¹æ€§**

âœ… **æ¨èï¼š**
```csharp
public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
{
    // æ ¹æ®å‘é€è€…ç±»å‹è°ƒæ•´è¡Œä¸º
    if (sender.IsConsole)
    {
        _logger.Info("å‘½ä»¤æ‰§è¡ŒæˆåŠŸ");
    }
    else
    {
        await _gameUtils.SendMessageAsync(sender.Name, "Â§aå‘½ä»¤æ‰§è¡ŒæˆåŠŸ");
    }
    
    return CommandResult.Ok();
}
```

### **10. æ€§èƒ½ä¼˜åŒ–å»ºè®®**

âœ… **æ¨èï¼š**
```csharp
// ç¼“å­˜ä¼šè‡ªåŠ¨ç®¡ç†ï¼Œä½†åœ¨å‘½ä»¤æ³¨å†Œ/ä¿®æ”¹åæ‰‹åŠ¨æ¸…é™¤
public void OnPluginReload()
{
    _tree.ClearCache();  // æ¸…é™¤ Tab è¡¥å…¨ç¼“å­˜
}

// ä½¿ç”¨æ‹¦æˆªå™¨ç›‘æ§æ€§èƒ½
commandManager.RegisterInterceptor(new PerformanceMonitorInterceptor());
```

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [æƒé™ç³»ç»Ÿ](./æƒé™ç³»ç»Ÿ.md)
- [æ¸¸æˆæ˜¾ç¤º API](../04-é«˜çº§åŠŸèƒ½/æ¸¸æˆæ˜¾ç¤ºAPI.md)
- [æ’ä»¶å¼€å‘æŒ‡å—](../03-æ’ä»¶å¼€å‘/æ’ä»¶å¼€å‘æŒ‡å—.md)
- [è°ƒåº¦å™¨ç³»ç»Ÿ](../04-é«˜çº§åŠŸèƒ½/è°ƒåº¦å™¨.md) - å®šæ—¶ä»»åŠ¡å’Œå»¶è¿Ÿæ‰§è¡Œ
- [å›½é™…åŒ– (i18n)](../04-é«˜çº§åŠŸèƒ½/å›½é™…åŒ–.md) - å¤šè¯­è¨€æ”¯æŒ

