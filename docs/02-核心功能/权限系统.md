# NetherGate æƒé™ç³»ç»Ÿ

NetherGate æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæƒé™ç»„ã€ç»§æ‰¿ã€ä¼˜å…ˆçº§å’Œç”¨æˆ·ç‰¹å®šæƒé™ã€‚

---

## ğŸ“‹ **ç›®å½•**

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [é…ç½®æ–‡ä»¶](#é…ç½®æ–‡ä»¶)
- [API ä½¿ç”¨](#api-ä½¿ç”¨)
- [æƒé™èŠ‚ç‚¹](#æƒé™èŠ‚ç‚¹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **1. åˆ›å»ºæƒé™é…ç½®**

é¦–æ¬¡è¿è¡Œåä¼šè‡ªåŠ¨ç”Ÿæˆ `permissions.yaml`ï¼š

```yaml
# æƒé™ç»„å®šä¹‰
groups:
  # é»˜è®¤ç»„ï¼ˆæ‰€æœ‰ç©å®¶ï¼‰
  default:
    priority: 0
    permissions:
      - "nethergate.help"
      - "nethergate.plugin.list"
    inherit_from: []
    is_default: true
  
  # VIP ç»„
  vip:
    priority: 10
    permissions:
      - "nethergate.plugin.*"
      - "myplugin.vip"
    inherit_from:
      - default
  
  # ç®¡ç†å‘˜ç»„
  admin:
    priority: 50
    permissions:
      - "*"  # æ‰€æœ‰æƒé™
    inherit_from:
      - vip
  
  # è¶…çº§ç®¡ç†å‘˜
  owner:
    priority: 100
    permissions:
      - "*"
    inherit_from: []

# ç©å®¶åˆ†ç»„
players:
  "Steve":
    - admin
  "Alex":
    - vip
```

### **2. åœ¨æ’ä»¶ä¸­æ£€æŸ¥æƒé™**

```csharp
public class MyPlugin : IPlugin
{
    private IPluginContext _context;

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // è®¢é˜…ç©å®¶åŠ å…¥äº‹ä»¶
        _context.EventBus.Subscribe<PlayerJoinedEvent>(OnPlayerJoined);
    }

    private async void OnPlayerJoined(PlayerJoinedEvent e)
    {
        var playerName = e.Player.Name;
        
        // æ£€æŸ¥æƒé™
        if (await _context.PermissionManager.HasPermissionAsync(playerName, "myplugin.vip"))
        {
            _context.Logger.Info($"{playerName} æ‹¥æœ‰ VIP æƒé™");
            // ç»™äºˆ VIP ç¦åˆ©
        }
    }
}
```

---

## ğŸ¯ **æ ¸å¿ƒæ¦‚å¿µ**

### **1. æƒé™èŠ‚ç‚¹**

æƒé™èŠ‚ç‚¹ä½¿ç”¨ç‚¹åˆ†éš”çš„å­—ç¬¦ä¸²ï¼š

```
nethergate.plugin.reload
nethergate.plugin.*
myplugin.command.spawn
myplugin.*
*
```

**é€šé…ç¬¦æ”¯æŒï¼š**
- `*` - åŒ¹é…æ‰€æœ‰æƒé™
- `plugin.*` - åŒ¹é… plugin ä¸‹çš„æ‰€æœ‰æƒé™
- `-permission` - å¦å®šæƒé™ï¼ˆç§»é™¤æƒé™ï¼‰

### **é€šé…ç¬¦è¯¦ç»†è¯´æ˜**

#### **1. å…¨å±€é€šé…ç¬¦ (`*`)**

æˆäºˆæ‰€æœ‰æƒé™ï¼š

```yaml
owner:
  priority: 100
  permissions:
    - "*"  # æ‰€æœ‰æƒé™ï¼ŒåŒ…æ‹¬æ ¸å¿ƒå’Œæ‰€æœ‰æ’ä»¶
```

ç­‰ä»·äºï¼š
```
nethergate.*
myplugin.*
otherplugin.*
... æ‰€æœ‰æƒé™
```

#### **2. å‘½åç©ºé—´é€šé…ç¬¦ (`namespace.*`)**

æˆäºˆç‰¹å®šå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰æƒé™ï¼š

```yaml
admin:
  permissions:
    - "nethergate.*"      # æ‰€æœ‰ NetherGate æ ¸å¿ƒæƒé™
    - "myplugin.*"        # æ‰€æœ‰ myplugin æƒé™
```

**åŒ¹é…è§„åˆ™**ï¼š
```
nethergate.*  â†’  åŒ¹é…:
  - nethergate.help
  - nethergate.plugin.reload
  - nethergate.permission.grant
  
myplugin.*  â†’  åŒ¹é…:
  - myplugin.command.spawn
  - myplugin.teleport
  - myplugin.admin.kick
```

#### **3. å¤šçº§é€šé…ç¬¦**

é€šé…ç¬¦å¯ä»¥åœ¨ä»»æ„çº§åˆ«ä½¿ç”¨ï¼š

```yaml
moderator:
  permissions:
    - "nethergate.plugin.*"       # æ‰€æœ‰æ’ä»¶ç®¡ç†æƒé™
    - "myplugin.command.*"        # æ‰€æœ‰å‘½ä»¤æƒé™
    - "myplugin.teleport.*"       # æ‰€æœ‰ä¼ é€ç›¸å…³æƒé™
```

**åŒ¹é…ç¤ºä¾‹**ï¼š
```
nethergate.plugin.*  â†’  åŒ¹é…:
  - nethergate.plugin.reload
  - nethergate.plugin.enable
  - nethergate.plugin.disable
  - nethergate.plugin.info
  
myplugin.command.*  â†’  åŒ¹é…:
  - myplugin.command.spawn
  - myplugin.command.home
  - myplugin.command.warp
```

#### **4. å¦å®šæƒé™ (`-permission`)**

ç§»é™¤ç‰¹å®šæƒé™ï¼Œå³ä½¿é€šè¿‡ç»§æ‰¿è·å¾—ï¼š

```yaml
admin:
  priority: 50
  permissions:
    - "nethergate.*"              # æ‰€æœ‰æ ¸å¿ƒæƒé™
    - "-nethergate.plugin.disable" # ä½†ä¸èƒ½ç¦ç”¨æ’ä»¶
    
moderator:
  inherit_from: [admin]
  permissions:
    - "myplugin.*"                # æ‰€æœ‰æ’ä»¶æƒé™
    - "-myplugin.admin.delete"    # ä½†ä¸èƒ½åˆ é™¤æ•°æ®
```

**å¦å®šæƒé™ä¼˜å…ˆçº§**ï¼š
```
æ˜ç¡®çš„å¦å®šæƒé™ > æ˜ç¡®çš„æˆæƒæƒé™ > é€šé…ç¬¦æˆæƒ
```

**ç¤ºä¾‹**ï¼š
```yaml
# åœºæ™¯ï¼šç»™äºˆæ‰€æœ‰ä¼ é€æƒé™ï¼Œä½†ç¦æ­¢è·¨ä¸–ç•Œä¼ é€
teleporter:
  permissions:
    - "myplugin.teleport.*"       # æ‰€æœ‰ä¼ é€æƒé™
    - "-myplugin.teleport.cross_world"  # ç¦æ­¢è·¨ä¸–ç•Œä¼ é€
```

#### **5. é€šé…ç¬¦ä½¿ç”¨æœ€ä½³å®è·µ**

**âœ… æ¨èåšæ³•**ï¼š

```yaml
# 1. åˆ†å±‚æˆæƒ
moderator:
  permissions:
    - "nethergate.plugin.*"    # æ’ä»¶ç®¡ç†
    - "nethergate.kick"        # è¸¢äºº
    - "nethergate.mute"        # ç¦è¨€

# 2. æœ€å°æƒé™åŸåˆ™
builder:
  permissions:
    - "myplugin.build.*"       # ä»…å»ºç­‘ç›¸å…³
    - "-myplugin.build.admin"  # æ’é™¤ç®¡ç†åŠŸèƒ½

# 3. ç»†ç²’åº¦æ§åˆ¶
vip:
  permissions:
    - "myplugin.teleport.home"     # å›å®¶
    - "myplugin.teleport.spawn"    # å‡ºç”Ÿç‚¹
    - "-myplugin.teleport.admin"   # ä¸èƒ½ä½¿ç”¨ç®¡ç†ä¼ é€
```

**âŒ ä¸æ¨èåšæ³•**ï¼š

```yaml
# è¿‡äºå®½æ³›çš„æƒé™
guest:
  permissions:
    - "*"  # âŒ ä¸è¦ç»™æ™®é€šç”¨æˆ·æ‰€æœ‰æƒé™

# æ»¥ç”¨å¦å®šæƒé™
user:
  permissions:
    - "myplugin.*"
    - "-myplugin.feature1"
    - "-myplugin.feature2"
    - "-myplugin.feature3"  # âŒ å¦‚æœéœ€è¦ç¦æ­¢å¾ˆå¤šï¼Œåº”è¯¥é‡æ–°è®¾è®¡æƒé™ç»“æ„
```

#### **6. é€šé…ç¬¦åŒ¹é…ç¤ºä¾‹**

å®Œæ•´çš„æƒé™åŒ¹é…ç¤ºä¾‹ï¼š

```yaml
player_permissions:
  "Steve":
    - "nethergate.*"           # æ‰€æœ‰æ ¸å¿ƒæƒé™
    - "backup.create"          # backup æ’ä»¶çš„åˆ›å»ºæƒé™
    - "backup.restore"         # backup æ’ä»¶çš„æ¢å¤æƒé™
    - "-backup.delete"         # ä½†ä¸èƒ½åˆ é™¤å¤‡ä»½
    
  "Alex":
    - "myplugin.command.*"     # æ‰€æœ‰å‘½ä»¤
    - "myplugin.teleport.home" # å›å®¶ä¼ é€
    - "-myplugin.command.admin.*"  # ä½†ä¸èƒ½ä½¿ç”¨ç®¡ç†å‘½ä»¤
```

**æƒé™æ£€æŸ¥ç»“æœ**ï¼š

| ç©å®¶ | æ£€æŸ¥æƒé™ | ç»“æœ | è¯´æ˜ |
|------|---------|------|------|
| Steve | `nethergate.plugin.reload` | âœ… å…è®¸ | åŒ¹é… `nethergate.*` |
| Steve | `backup.create` | âœ… å…è®¸ | æ˜ç¡®æˆæƒ |
| Steve | `backup.delete` | âŒ æ‹’ç» | è¢«å¦å®šæƒé™ç§»é™¤ |
| Alex | `myplugin.command.spawn` | âœ… å…è®¸ | åŒ¹é… `myplugin.command.*` |
| Alex | `myplugin.command.admin.kick` | âŒ æ‹’ç» | è¢«å¦å®šæƒé™ç§»é™¤ |
| Alex | `myplugin.teleport.home` | âœ… å…è®¸ | æ˜ç¡®æˆæƒ |
| Alex | `myplugin.teleport.warp` | âŒ æ‹’ç» | æœªæˆæƒ |

### **2. æƒé™ç»„**

æƒé™ç»„å®šä¹‰äº†ä¸€ç»„æƒé™çš„é›†åˆï¼š

```yaml
groups:
  moderator:
    priority: 30  # ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
    permissions:
      - "nethergate.kick"
      - "nethergate.ban"
      - "myplugin.moderate"
    inherit_from:
      - vip  # ç»§æ‰¿ VIP ç»„çš„æ‰€æœ‰æƒé™
    is_default: false
```

**å±æ€§è¯´æ˜ï¼š**
- `priority` - ä¼˜å…ˆçº§ï¼Œç”¨äºå†²çªè§£å†³ï¼ˆé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ï¼‰
- `permissions` - æƒé™åˆ—è¡¨
- `inherit_from` - ç»§æ‰¿çš„ç»„ï¼ˆæ”¯æŒå¤šç»§æ‰¿ï¼‰
- `is_default` - æ˜¯å¦ä¸ºé»˜è®¤ç»„ï¼ˆæ–°ç©å®¶è‡ªåŠ¨åŠ å…¥ï¼‰

### **3. æƒé™ç»§æ‰¿**

```
owner (100)
  â””â”€ æ‹¥æœ‰æ‰€æœ‰æƒé™

admin (50)
  â””â”€ ç»§æ‰¿è‡ª vip
      â””â”€ ç®¡ç†æƒé™ + VIP æƒé™

vip (10)
  â””â”€ ç»§æ‰¿è‡ª default
      â””â”€ VIP æƒé™ + é»˜è®¤æƒé™

default (0)
  â””â”€ åŸºç¡€æƒé™
```

**ç»§æ‰¿è§„åˆ™ï¼š**
1. å­ç»„ç»§æ‰¿çˆ¶ç»„çš„æ‰€æœ‰æƒé™
2. æ”¯æŒå¤šç»§æ‰¿ï¼ˆä»å¤šä¸ªç»„ç»§æ‰¿ï¼‰
3. é«˜ä¼˜å…ˆçº§æƒé™è¦†ç›–ä½ä¼˜å…ˆçº§
4. å¦å®šæƒé™ï¼ˆ`-permission`ï¼‰å¯ä»¥ç§»é™¤ç»§æ‰¿çš„æƒé™

### **4. ç”¨æˆ·ç‰¹å®šæƒé™**

é™¤äº†ç»„æƒé™ï¼Œè¿˜å¯ä»¥ä¸ºå•ä¸ªç©å®¶è®¾ç½®ç‰¹å®šæƒé™ï¼š

```csharp
// ç»™äºˆç©å®¶ç‰¹å®šæƒé™
await _context.PermissionManager.GrantPermissionAsync("Steve", "special.permission");

// ç§»é™¤ç©å®¶ç‰¹å®šæƒé™
await _context.PermissionManager.RevokePermissionAsync("Steve", "special.permission");
```

**ä¼˜å…ˆçº§ï¼š**
```
ç”¨æˆ·ç‰¹å®šæƒé™ > æœ€é«˜ä¼˜å…ˆçº§ç»„æƒé™ > ç»§æ‰¿çš„ç»„æƒé™ > é»˜è®¤ç»„æƒé™
```

---

## ğŸ“ **é…ç½®æ–‡ä»¶**

### **å®Œæ•´é…ç½®ç¤ºä¾‹**

```yaml
# ============================================
# æƒé™ç»„å®šä¹‰
# ============================================
groups:
  # é»˜è®¤ç»„ï¼ˆæ‰€æœ‰ç©å®¶è‡ªåŠ¨åŠ å…¥ï¼‰
  default:
    priority: 0
    permissions:
      - "nethergate.help"
      - "nethergate.plugin.list"
      - "myplugin.basic"
    inherit_from: []
    is_default: true
  
  # VIP ç©å®¶
  vip:
    priority: 10
    permissions:
      - "nethergate.plugin.info"
      - "myplugin.vip.*"
      - "myplugin.teleport"
    inherit_from:
      - default
  
  # ç®¡ç†åŠ©æ‰‹
  helper:
    priority: 20
    permissions:
      - "nethergate.kick"
      - "myplugin.moderate"
    inherit_from:
      - vip
  
  # ç‰ˆä¸»
  moderator:
    priority: 30
    permissions:
      - "nethergate.ban"
      - "nethergate.whitelist.*"
      - "myplugin.moderate.*"
    inherit_from:
      - helper
  
  # ç®¡ç†å‘˜
  admin:
    priority: 50
    permissions:
      - "nethergate.*"
      - "myplugin.*"
      - "-myplugin.dangerous"  # å¦å®šæƒé™
    inherit_from:
      - moderator
  
  # è¶…çº§ç®¡ç†å‘˜/æœä¸»
  owner:
    priority: 100
    permissions:
      - "*"  # æ‰€æœ‰æƒé™
    inherit_from: []

# ============================================
# ç©å®¶ç»„åˆ†é…
# ============================================
players:
  "Steve":
    - owner
  
  "Alex":
    - admin
  
  "Bob":
    - moderator
    - vip  # ä¸€ä¸ªç©å®¶å¯ä»¥åœ¨å¤šä¸ªç»„
  
  "Charlie":
    - helper
```

### **é…ç½®çƒ­é‡è½½**

ä¿®æ”¹ `permissions.yaml` åï¼Œå¯ä»¥çƒ­é‡è½½ï¼š

```bash
# æ§åˆ¶å°å‘½ä»¤
permission reload

# æˆ–ä½¿ç”¨ API
await _context.PermissionManager.ReloadAsync();
```

---

## ğŸ”§ **API ä½¿ç”¨**

### **IPermissionManager æ¥å£**

```csharp
public interface IPermissionManager
{
    // ========== æƒé™æ£€æŸ¥ ==========
    
    /// <summary>
    /// æ£€æŸ¥ç©å®¶æ˜¯å¦æ‹¥æœ‰æƒé™
    /// </summary>
    Task<bool> HasPermissionAsync(string playerName, string permission);
    
    /// <summary>
    /// è·å–ç©å®¶çš„æƒé™ç­‰çº§
    /// </summary>
    Task<PermissionLevel> GetPermissionLevelAsync(string playerName);
    
    // ========== ç”¨æˆ·æƒé™ç®¡ç† ==========
    
    /// <summary>
    /// ç»™äºˆç©å®¶æƒé™
    /// </summary>
    Task GrantPermissionAsync(string playerName, string permission);
    
    /// <summary>
    /// ç§»é™¤ç©å®¶æƒé™
    /// </summary>
    Task RevokePermissionAsync(string playerName, string permission);
    
    /// <summary>
    /// è·å–ç©å®¶çš„æ‰€æœ‰æƒé™
    /// </summary>
    Task<List<string>> GetUserPermissionsAsync(string playerName);
    
    // ========== ç”¨æˆ·ç»„ç®¡ç† ==========
    
    /// <summary>
    /// å°†ç©å®¶æ·»åŠ åˆ°ç»„
    /// </summary>
    Task AddUserToGroupAsync(string playerName, string groupName);
    
    /// <summary>
    /// ä»ç»„ç§»é™¤ç©å®¶
    /// </summary>
    Task RemoveUserFromGroupAsync(string playerName, string groupName);
    
    /// <summary>
    /// è·å–ç©å®¶æ‰€åœ¨çš„ç»„
    /// </summary>
    Task<List<string>> GetUserGroupsAsync(string playerName);
    
    // ========== æƒé™ç»„ç®¡ç† ==========
    
    /// <summary>
    /// åˆ›å»ºæƒé™ç»„
    /// </summary>
    Task CreateGroupAsync(string groupName, int priority = 0);
    
    /// <summary>
    /// åˆ é™¤æƒé™ç»„
    /// </summary>
    Task DeleteGroupAsync(string groupName);
    
    /// <summary>
    /// ç»™äºˆç»„æƒé™
    /// </summary>
    Task GrantGroupPermissionAsync(string groupName, string permission);
    
    /// <summary>
    /// ç§»é™¤ç»„æƒé™
    /// </summary>
    Task RevokeGroupPermissionAsync(string groupName, string permission);
    
    /// <summary>
    /// è·å–ç»„çš„æ‰€æœ‰æƒé™
    /// </summary>
    Task<List<string>> GetGroupPermissionsAsync(string groupName);
    
    // ========== é…ç½®ç®¡ç† ==========
    
    /// <summary>
    /// é‡æ–°åŠ è½½æƒé™é…ç½®
    /// </summary>
    Task ReloadAsync();
    
    /// <summary>
    /// ä¿å­˜æƒé™é…ç½®
    /// </summary>
    Task SaveAsync();
}
```

### **ä½¿ç”¨ç¤ºä¾‹**

#### **1. æƒé™æ£€æŸ¥**

```csharp
// æ£€æŸ¥å•ä¸ªæƒé™
if (await _context.PermissionManager.HasPermissionAsync("Steve", "myplugin.admin"))
{
    // æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ
}

// æ£€æŸ¥æƒé™ç­‰çº§
var level = await _context.PermissionManager.GetPermissionLevelAsync("Steve");
switch (level)
{
    case PermissionLevel.Owner:
        // æœä¸»æƒé™
        break;
    case PermissionLevel.Admin:
        // ç®¡ç†å‘˜æƒé™
        break;
    case PermissionLevel.Moderator:
        // ç‰ˆä¸»æƒé™
        break;
    case PermissionLevel.User:
        // æ™®é€šç”¨æˆ·
        break;
}
```

#### **2. åŠ¨æ€æƒé™ç®¡ç†**

```csharp
// ä¸´æ—¶ç»™äºˆæƒé™ï¼ˆå¦‚è´­ä¹° VIPï¼‰
await _context.PermissionManager.AddUserToGroupAsync("Steve", "vip");

// ç§»é™¤æƒé™ï¼ˆå¦‚ VIP è¿‡æœŸï¼‰
await _context.PermissionManager.RemoveUserFromGroupAsync("Steve", "vip");

// ç»™äºˆç‰¹å®šæƒé™
await _context.PermissionManager.GrantPermissionAsync("Steve", "special.event.access");

// ç§»é™¤ç‰¹å®šæƒé™
await _context.PermissionManager.RevokePermissionAsync("Steve", "special.event.access");
```

#### **3. ç»„ç®¡ç†**

```csharp
// åˆ›å»ºæ–°ç»„
await _context.PermissionManager.CreateGroupAsync("builder", priority: 15);

// ç»™ç»„æ·»åŠ æƒé™
await _context.PermissionManager.GrantGroupPermissionAsync("builder", "myplugin.build.*");
await _context.PermissionManager.GrantGroupPermissionAsync("builder", "myplugin.worldedit");

// æŸ¥è¯¢ç»„æƒé™
var permissions = await _context.PermissionManager.GetGroupPermissionsAsync("builder");
foreach (var perm in permissions)
{
    _context.Logger.Info($"- {perm}");
}

// åˆ é™¤ç»„
await _context.PermissionManager.DeleteGroupAsync("builder");
```

#### **4. åœ¨å‘½ä»¤ä¸­ä½¿ç”¨**

```csharp
public class AdminCommand : ICommand
{
    private readonly IPluginContext _context;

    public string Name => "admin";
    public string Description => "ç®¡ç†å‘˜å‘½ä»¤";

    public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
    {
        // æ£€æŸ¥æƒé™
        if (sender != null && !await _context.PermissionManager.HasPermissionAsync(
            sender.Name, "myplugin.admin"))
        {
            return CommandResult.Fail("ä½ æ²¡æœ‰æƒé™ä½¿ç”¨æ­¤å‘½ä»¤");
        }

        // æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ
        return CommandResult.Success("ç®¡ç†å‘˜å‘½ä»¤æ‰§è¡ŒæˆåŠŸ");
    }
}
```

---

## ğŸ¯ **æƒé™èŠ‚ç‚¹çº¦å®š**

### **NetherGate æ ¸å¿ƒæƒé™**

```
nethergate.*                    # æ‰€æœ‰æ ¸å¿ƒæƒé™
nethergate.help                 # æŸ¥çœ‹å¸®åŠ©
nethergate.plugin.*             # æ‰€æœ‰æ’ä»¶ç®¡ç†æƒé™
nethergate.plugin.list          # åˆ—å‡ºæ’ä»¶
nethergate.plugin.info          # æŸ¥çœ‹æ’ä»¶ä¿¡æ¯
nethergate.plugin.reload        # é‡è½½æ’ä»¶
nethergate.plugin.enable        # å¯ç”¨æ’ä»¶
nethergate.plugin.disable       # ç¦ç”¨æ’ä»¶
nethergate.permission.*         # æ‰€æœ‰æƒé™ç®¡ç†æƒé™
nethergate.permission.reload    # é‡è½½æƒé™é…ç½®
nethergate.permission.grant     # æˆäºˆæƒé™
nethergate.permission.revoke    # ç§»é™¤æƒé™
```

### **æ’ä»¶æƒé™å‘½åå»ºè®®**

```
<æ’ä»¶å>.*                       # æ’ä»¶æ‰€æœ‰æƒé™
<æ’ä»¶å>.command.*               # æ‰€æœ‰å‘½ä»¤æƒé™
<æ’ä»¶å>.command.<å‘½ä»¤å>        # ç‰¹å®šå‘½ä»¤
<æ’ä»¶å>.feature.*               # æ‰€æœ‰åŠŸèƒ½æƒé™
<æ’ä»¶å>.feature.<åŠŸèƒ½å>        # ç‰¹å®šåŠŸèƒ½
<æ’ä»¶å>.admin                   # ç®¡ç†æƒé™
```

**ç¤ºä¾‹ï¼š**
```
economy.*
economy.command.*
economy.command.balance
economy.command.pay
economy.command.admin
economy.feature.shop
economy.feature.auction
economy.admin
```

---

## ğŸ’¡ **æœ€ä½³å®è·µ**

### **1. æƒé™ç²’åº¦**

âœ… **æ¨èï¼š** ç»†ç²’åº¦æƒé™
```yaml
permissions:
  - "myplugin.command.tp"
  - "myplugin.command.tphere"
  - "myplugin.feature.home"
```

âŒ **ä¸æ¨èï¼š** è¿‡äºç²—ç²’åº¦
```yaml
permissions:
  - "myplugin.*"  # ç»™äºˆæ‰€æœ‰æƒé™
```

### **2. ç»„ç»‡ç»“æ„**

```yaml
# æŒ‰è§’è‰²ç»„ç»‡
groups:
  player:    # ç©å®¶
  vip:       # ä»˜è´¹ç©å®¶
  helper:    # ç®¡ç†åŠ©æ‰‹
  moderator: # ç‰ˆä¸»
  admin:     # ç®¡ç†å‘˜
  owner:     # æœä¸»
```

### **3. ç»§æ‰¿é“¾**

```
owner
 â””â”€ admin
     â””â”€ moderator
         â””â”€ helper
             â””â”€ vip
                 â””â”€ player (default)
```

### **4. å¦å®šæƒé™**

```yaml
admin:
  permissions:
    - "nethergate.*"
    - "-nethergate.server.stop"  # ç¦æ­¢åœæœ
    - "myplugin.*"
    - "-myplugin.dangerous"      # ç¦æ­¢å±é™©æ“ä½œ
```

### **5. ä¸´æ—¶æƒé™**

å¯¹äºä¸´æ—¶æƒé™ï¼Œå»ºè®®åœ¨ä»£ç ä¸­åŠ¨æ€ç®¡ç†è€Œä¸æ˜¯å†™å…¥é…ç½®ï¼š

```csharp
// æ´»åŠ¨æœŸé—´ç»™äºˆç‰¹æ®Šæƒé™
await _context.PermissionManager.GrantPermissionAsync(playerName, "event.halloween");

// æ´»åŠ¨ç»“æŸç§»é™¤
await _context.PermissionManager.RevokePermissionAsync(playerName, "event.halloween");
```

---

## ğŸ” **è°ƒè¯•å’Œæµ‹è¯•**

### **æŸ¥çœ‹ç©å®¶æƒé™**

```bash
# æ§åˆ¶å°å‘½ä»¤
permission check Steve myplugin.admin
# è¾“å‡º: Steve æ‹¥æœ‰æƒé™ myplugin.admin: true

permission user Steve list
# è¾“å‡º: Steve çš„æƒé™:
#   - nethergate.*
#   - myplugin.*
#   ç»„: admin, vip
```

### **è°ƒè¯•æ—¥å¿—**

```csharp
// å¯ç”¨æƒé™è°ƒè¯•æ—¥å¿—
_context.Logger.Debug($"æ£€æŸ¥æƒé™: {playerName} - {permission}");

var hasPermission = await _context.PermissionManager.HasPermissionAsync(playerName, permission);

_context.Logger.Debug($"ç»“æœ: {hasPermission}");
```

---

## ğŸš¨ **å¸¸è§é—®é¢˜**

### **Q: æƒé™ä¸ç”Ÿæ•ˆï¼Ÿ**

**A:** æ£€æŸ¥ï¼š
1. é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®
2. æƒé™èŠ‚ç‚¹æ˜¯å¦æ‹¼å†™æ­£ç¡®
3. ç»„çš„ä¼˜å…ˆçº§æ˜¯å¦åˆç†
4. æ˜¯å¦æœ‰å¦å®šæƒé™è¦†ç›–

### **Q: å¦‚ä½•ç»™æ‰€æœ‰ç©å®¶é»˜è®¤æƒé™ï¼Ÿ**

**A:** åœ¨ default ç»„ä¸­è®¾ç½®ï¼š
```yaml
groups:
  default:
    is_default: true  # æ‰€æœ‰ç©å®¶è‡ªåŠ¨åŠ å…¥
    permissions:
      - "your.default.permissions"
```

### **Q: å¦‚ä½•å®ç°æƒé™è¿‡æœŸï¼Ÿ**

**A:** åœ¨æ’ä»¶ä¸­ä½¿ç”¨å®šæ—¶å™¨ï¼š
```csharp
// å®šæ—¶æ£€æŸ¥ VIP è¿‡æœŸ
_timer = new Timer(async _ => {
    foreach (var player in expiredVips)
    {
        await _context.PermissionManager.RemoveUserFromGroupAsync(player, "vip");
    }
}, null, TimeSpan.Zero, TimeSpan.FromHours(1));
```

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [å‘½ä»¤ç³»ç»Ÿ](./å‘½ä»¤ç³»ç»Ÿ.md) - åœ¨å‘½ä»¤ä¸­ä½¿ç”¨æƒé™
- [æ’ä»¶å¼€å‘æŒ‡å—](../03-æ’ä»¶å¼€å‘/æ’ä»¶å¼€å‘æŒ‡å—.md)
- [API å‚è€ƒ](../03-æ’ä»¶å¼€å‘/APIå‚è€ƒ.md)

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** NetherGate å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°ï¼š** 2025-10-05
