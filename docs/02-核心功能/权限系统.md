# NetherGate æƒé™ç³»ç»Ÿ API

NetherGate æä¾›äº†æƒé™ç³»ç»Ÿçš„æ ¸å¿ƒ API æ¥å£ï¼Œæ”¯æŒæƒé™æ£€æŸ¥ã€ç”¨æˆ·ç»„ç®¡ç†ç­‰åŠŸèƒ½ã€‚

> ğŸ’¡ **æ³¨æ„**ï¼šNetherGate æ ¸å¿ƒåªæä¾›æƒé™ API æ¥å£ï¼Œå…·ä½“çš„æƒé™ç®¡ç†åŠŸèƒ½ï¼ˆå¦‚æƒé™é…ç½®ã€å‘½ä»¤ç®¡ç†ç­‰ï¼‰ç”±ç‹¬ç«‹çš„æƒé™ç®¡ç†æ’ä»¶å®ç°ã€‚

---

## ğŸ“‹ **ç›®å½•**

- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [API æ¥å£](#api-æ¥å£)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [æƒé™èŠ‚ç‚¹çº¦å®š](#æƒé™èŠ‚ç‚¹çº¦å®š)
- [æ’ä»¶é›†æˆ](#æ’ä»¶é›†æˆ)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ¯ **æ ¸å¿ƒæ¦‚å¿µ**

### **æƒé™ç³»ç»Ÿæ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NetherGate.API (æƒé™æ¥å£)         â”‚
â”‚   - IPermissionManager              â”‚
â”‚   - æƒé™æ£€æŸ¥å’ŒæŸ¥è¯¢ API              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æƒé™ç®¡ç†æ’ä»¶ (å•ç‹¬å®ç°)            â”‚
â”‚   - æƒé™é…ç½®æ–‡ä»¶ç®¡ç†                 â”‚
â”‚   - æƒé™å‘½ä»¤                         â”‚
â”‚   - æƒé™ç»„ç³»ç»Ÿ                       â”‚
â”‚   - ç”¨æˆ·æƒé™ç®¡ç†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡æ’ä»¶ (ä½¿ç”¨æƒé™)                â”‚
â”‚   - æ£€æŸ¥ç©å®¶æƒé™                     â”‚
â”‚   - æ§åˆ¶åŠŸèƒ½è®¿é—®                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **åœ¨æ’ä»¶ä¸­ä½¿ç”¨æƒé™ API**

```csharp
using NetherGate.API.Plugins;
using NetherGate.API.Permissions;

public class MyPlugin : IPlugin
{
    private IPluginContext _context;

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // è®¢é˜…ç©å®¶åŠ å…¥äº‹ä»¶
        _context.EventBus.Subscribe<PlayerJoinedEvent>(OnPlayerJoined);
    }

    private async void OnPlayerJoined(PlayerJoinedEvent e)
    {
        var playerName = e.Player.Name;
        
        // æ£€æŸ¥æƒé™
        if (await _context.PermissionManager.HasPermissionAsync(playerName, "myplugin.vip"))
        {
            _context.Logger.Info($"{playerName} æ‹¥æœ‰ VIP æƒé™");
            // ç»™äºˆ VIP ç¦åˆ©
        }
    }
}
```

---

## ğŸ¯ **æ ¸å¿ƒæ¦‚å¿µï¼ˆç”±æƒé™æ’ä»¶å®ç°ï¼‰**

### **1. æƒé™èŠ‚ç‚¹**

æƒé™èŠ‚ç‚¹ä½¿ç”¨ç‚¹åˆ†éš”çš„å­—ç¬¦ä¸²ï¼š

```
nethergate.plugin.reload
nethergate.plugin.*
myplugin.command.spawn
myplugin.*
*
```

**é€šé…ç¬¦æ”¯æŒï¼š**
- `*` - åŒ¹é…æ‰€æœ‰æƒé™
- `plugin.*` - åŒ¹é… plugin ä¸‹çš„æ‰€æœ‰æƒé™
- `-permission` - å¦å®šæƒé™ï¼ˆç§»é™¤æƒé™ï¼‰

### **é€šé…ç¬¦è¯¦ç»†è¯´æ˜**

#### **1. å…¨å±€é€šé…ç¬¦ (`*`)**

æˆäºˆæ‰€æœ‰æƒé™ï¼š

```yaml
owner:
  priority: 100
  permissions:
    - "*"  # æ‰€æœ‰æƒé™ï¼ŒåŒ…æ‹¬æ ¸å¿ƒå’Œæ‰€æœ‰æ’ä»¶
```

ç­‰ä»·äºï¼š
```
nethergate.*
myplugin.*
otherplugin.*
... æ‰€æœ‰æƒé™
```

#### **2. å‘½åç©ºé—´é€šé…ç¬¦ (`namespace.*`)**

æˆäºˆç‰¹å®šå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰æƒé™ï¼š

```yaml
admin:
  permissions:
    - "nethergate.*"      # æ‰€æœ‰ NetherGate æ ¸å¿ƒæƒé™
    - "myplugin.*"        # æ‰€æœ‰ myplugin æƒé™
```

**åŒ¹é…è§„åˆ™**ï¼š
```
nethergate.*  â†’  åŒ¹é…:
  - nethergate.help
  - nethergate.plugin.reload
  - nethergate.permission.grant
  
myplugin.*  â†’  åŒ¹é…:
  - myplugin.command.spawn
  - myplugin.teleport
  - myplugin.admin.kick
```

#### **3. å¤šçº§é€šé…ç¬¦**

é€šé…ç¬¦å¯ä»¥åœ¨ä»»æ„çº§åˆ«ä½¿ç”¨ï¼š

```yaml
moderator:
  permissions:
    - "nethergate.plugin.*"       # æ‰€æœ‰æ’ä»¶ç®¡ç†æƒé™
    - "myplugin.command.*"        # æ‰€æœ‰å‘½ä»¤æƒé™
    - "myplugin.teleport.*"       # æ‰€æœ‰ä¼ é€ç›¸å…³æƒé™
```

**åŒ¹é…ç¤ºä¾‹**ï¼š
```
nethergate.plugin.*  â†’  åŒ¹é…:
  - nethergate.plugin.reload
  - nethergate.plugin.enable
  - nethergate.plugin.disable
  - nethergate.plugin.info
  
myplugin.command.*  â†’  åŒ¹é…:
  - myplugin.command.spawn
  - myplugin.command.home
  - myplugin.command.warp
```

#### **4. å¦å®šæƒé™ (`-permission`)**

ç§»é™¤ç‰¹å®šæƒé™ï¼Œå³ä½¿é€šè¿‡ç»§æ‰¿è·å¾—ï¼š

```yaml
admin:
  priority: 50
  permissions:
    - "nethergate.*"              # æ‰€æœ‰æ ¸å¿ƒæƒé™
    - "-nethergate.plugin.disable" # ä½†ä¸èƒ½ç¦ç”¨æ’ä»¶
    
moderator:
  inherit_from: [admin]
  permissions:
    - "myplugin.*"                # æ‰€æœ‰æ’ä»¶æƒé™
    - "-myplugin.admin.delete"    # ä½†ä¸èƒ½åˆ é™¤æ•°æ®
```

**å¦å®šæƒé™ä¼˜å…ˆçº§**ï¼š
```
æ˜ç¡®çš„å¦å®šæƒé™ > æ˜ç¡®çš„æˆæƒæƒé™ > é€šé…ç¬¦æˆæƒ
```

**ç¤ºä¾‹**ï¼š
```yaml
# åœºæ™¯ï¼šç»™äºˆæ‰€æœ‰ä¼ é€æƒé™ï¼Œä½†ç¦æ­¢è·¨ä¸–ç•Œä¼ é€
teleporter:
  permissions:
    - "myplugin.teleport.*"       # æ‰€æœ‰ä¼ é€æƒé™
    - "-myplugin.teleport.cross_world"  # ç¦æ­¢è·¨ä¸–ç•Œä¼ é€
```

#### **5. é€šé…ç¬¦ä½¿ç”¨æœ€ä½³å®è·µ**

**âœ… æ¨èåšæ³•**ï¼š

```yaml
# 1. åˆ†å±‚æˆæƒ
moderator:
  permissions:
    - "nethergate.plugin.*"    # æ’ä»¶ç®¡ç†
    - "nethergate.kick"        # è¸¢äºº
    - "nethergate.mute"        # ç¦è¨€

# 2. æœ€å°æƒé™åŸåˆ™
builder:
  permissions:
    - "myplugin.build.*"       # ä»…å»ºç­‘ç›¸å…³
    - "-myplugin.build.admin"  # æ’é™¤ç®¡ç†åŠŸèƒ½

# 3. ç»†ç²’åº¦æ§åˆ¶
vip:
  permissions:
    - "myplugin.teleport.home"     # å›å®¶
    - "myplugin.teleport.spawn"    # å‡ºç”Ÿç‚¹
    - "-myplugin.teleport.admin"   # ä¸èƒ½ä½¿ç”¨ç®¡ç†ä¼ é€
```

**âŒ ä¸æ¨èåšæ³•**ï¼š

```yaml
# è¿‡äºå®½æ³›çš„æƒé™
guest:
  permissions:
    - "*"  # âŒ ä¸è¦ç»™æ™®é€šç”¨æˆ·æ‰€æœ‰æƒé™

# æ»¥ç”¨å¦å®šæƒé™
user:
  permissions:
    - "myplugin.*"
    - "-myplugin.feature1"
    - "-myplugin.feature2"
    - "-myplugin.feature3"  # âŒ å¦‚æœéœ€è¦ç¦æ­¢å¾ˆå¤šï¼Œåº”è¯¥é‡æ–°è®¾è®¡æƒé™ç»“æ„
```

#### **6. é€šé…ç¬¦åŒ¹é…ç¤ºä¾‹**

å®Œæ•´çš„æƒé™åŒ¹é…ç¤ºä¾‹ï¼š

```yaml
player_permissions:
  "Steve":
    - "nethergate.*"           # æ‰€æœ‰æ ¸å¿ƒæƒé™
    - "backup.create"          # backup æ’ä»¶çš„åˆ›å»ºæƒé™
    - "backup.restore"         # backup æ’ä»¶çš„æ¢å¤æƒé™
    - "-backup.delete"         # ä½†ä¸èƒ½åˆ é™¤å¤‡ä»½
    
  "Alex":
    - "myplugin.command.*"     # æ‰€æœ‰å‘½ä»¤
    - "myplugin.teleport.home" # å›å®¶ä¼ é€
    - "-myplugin.command.admin.*"  # ä½†ä¸èƒ½ä½¿ç”¨ç®¡ç†å‘½ä»¤
```

**æƒé™æ£€æŸ¥ç»“æœ**ï¼š

| ç©å®¶ | æ£€æŸ¥æƒé™ | ç»“æœ | è¯´æ˜ |
|------|---------|------|------|
| Steve | `nethergate.plugin.reload` | âœ… å…è®¸ | åŒ¹é… `nethergate.*` |
| Steve | `backup.create` | âœ… å…è®¸ | æ˜ç¡®æˆæƒ |
| Steve | `backup.delete` | âŒ æ‹’ç» | è¢«å¦å®šæƒé™ç§»é™¤ |
| Alex | `myplugin.command.spawn` | âœ… å…è®¸ | åŒ¹é… `myplugin.command.*` |
| Alex | `myplugin.command.admin.kick` | âŒ æ‹’ç» | è¢«å¦å®šæƒé™ç§»é™¤ |
| Alex | `myplugin.teleport.home` | âœ… å…è®¸ | æ˜ç¡®æˆæƒ |
| Alex | `myplugin.teleport.warp` | âŒ æ‹’ç» | æœªæˆæƒ |

### **2. æƒé™ç»„**

æƒé™ç»„å®šä¹‰äº†ä¸€ç»„æƒé™çš„é›†åˆï¼š

```yaml
groups:
  moderator:
    priority: 30  # ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
    permissions:
      - "nethergate.kick"
      - "nethergate.ban"
      - "myplugin.moderate"
    inherit_from:
      - vip  # ç»§æ‰¿ VIP ç»„çš„æ‰€æœ‰æƒé™
    is_default: false
```

**å±æ€§è¯´æ˜ï¼š**
- `priority` - ä¼˜å…ˆçº§ï¼Œç”¨äºå†²çªè§£å†³ï¼ˆé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ï¼‰
- `permissions` - æƒé™åˆ—è¡¨
- `inherit_from` - ç»§æ‰¿çš„ç»„ï¼ˆæ”¯æŒå¤šç»§æ‰¿ï¼‰
- `is_default` - æ˜¯å¦ä¸ºé»˜è®¤ç»„ï¼ˆæ–°ç©å®¶è‡ªåŠ¨åŠ å…¥ï¼‰

### **3. æƒé™ç»§æ‰¿**

```
owner (100)
  â””â”€ æ‹¥æœ‰æ‰€æœ‰æƒé™

admin (50)
  â””â”€ ç»§æ‰¿è‡ª vip
      â””â”€ ç®¡ç†æƒé™ + VIP æƒé™

vip (10)
  â””â”€ ç»§æ‰¿è‡ª default
      â””â”€ VIP æƒé™ + é»˜è®¤æƒé™

default (0)
  â””â”€ åŸºç¡€æƒé™
```

**ç»§æ‰¿è§„åˆ™ï¼š**
1. å­ç»„ç»§æ‰¿çˆ¶ç»„çš„æ‰€æœ‰æƒé™
2. æ”¯æŒå¤šç»§æ‰¿ï¼ˆä»å¤šä¸ªç»„ç»§æ‰¿ï¼‰
3. é«˜ä¼˜å…ˆçº§æƒé™è¦†ç›–ä½ä¼˜å…ˆçº§
4. å¦å®šæƒé™ï¼ˆ`-permission`ï¼‰å¯ä»¥ç§»é™¤ç»§æ‰¿çš„æƒé™

### **4. ç”¨æˆ·ç‰¹å®šæƒé™**

é™¤äº†ç»„æƒé™ï¼Œè¿˜å¯ä»¥ä¸ºå•ä¸ªç©å®¶è®¾ç½®ç‰¹å®šæƒé™ï¼š

```csharp
// ç»™äºˆç©å®¶ç‰¹å®šæƒé™
await _context.PermissionManager.GrantPermissionAsync("Steve", "special.permission");

// ç§»é™¤ç©å®¶ç‰¹å®šæƒé™
await _context.PermissionManager.RevokePermissionAsync("Steve", "special.permission");
```

**ä¼˜å…ˆçº§ï¼š**
```
ç”¨æˆ·ç‰¹å®šæƒé™ > æœ€é«˜ä¼˜å…ˆçº§ç»„æƒé™ > ç»§æ‰¿çš„ç»„æƒé™ > é»˜è®¤ç»„æƒé™
```

---

## ğŸ”§ **API æ¥å£**

### **IPermissionManager æ¥å£**

NetherGate æä¾›çš„æ ¸å¿ƒæƒé™ç®¡ç†æ¥å£ï¼š

```csharp
namespace NetherGate.API.Permissions;

public interface IPermissionManager
{
    // ========== æƒé™æ£€æŸ¥ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰==========
    
    /// <summary>
    /// æ£€æŸ¥ç©å®¶æ˜¯å¦æ‹¥æœ‰æƒé™
    /// </summary>
    Task<bool> HasPermissionAsync(string playerName, string permission);
    
    /// <summary>
    /// è·å–ç©å®¶çš„æ‰€æœ‰æƒé™
    /// </summary>
    Task<List<string>> GetUserPermissionsAsync(string playerName);
    
    // ========== ç”¨æˆ·ç»„ç®¡ç†ï¼ˆç”±æƒé™æ’ä»¶å®ç°ï¼‰==========
    
    /// <summary>
    /// å°†ç©å®¶æ·»åŠ åˆ°ç»„
    /// </summary>
    Task AddUserToGroupAsync(string playerName, string groupName);
    
    /// <summary>
    /// ä»ç»„ç§»é™¤ç©å®¶
    /// </summary>
    Task RemoveUserFromGroupAsync(string playerName, string groupName);
    
    /// <summary>
    /// è·å–ç©å®¶æ‰€åœ¨çš„ç»„
    /// </summary>
    Task<List<string>> GetUserGroupsAsync(string playerName);
    
    // ========== æƒé™ç®¡ç†ï¼ˆç”±æƒé™æ’ä»¶å®ç°ï¼‰==========
    
    /// <summary>
    /// ç»™äºˆç©å®¶æƒé™
    /// </summary>
    Task GrantPermissionAsync(string playerName, string permission);
    
    /// <summary>
    /// ç§»é™¤ç©å®¶æƒé™
    /// </summary>
    Task RevokePermissionAsync(string playerName, string permission);
    
    /// <summary>
    /// åˆ›å»ºæƒé™ç»„
    /// </summary>
    Task CreateGroupAsync(string groupName, int priority = 0);
    
    /// <summary>
    /// åˆ é™¤æƒé™ç»„
    /// </summary>
    Task DeleteGroupAsync(string groupName);
    
    /// <summary>
    /// ç»™äºˆç»„æƒé™
    /// </summary>
    Task GrantGroupPermissionAsync(string groupName, string permission);
    
    /// <summary>
    /// ç§»é™¤ç»„æƒé™
    /// </summary>
    Task RevokeGroupPermissionAsync(string groupName, string permission);
    
    /// <summary>
    /// è·å–ç»„çš„æ‰€æœ‰æƒé™
    /// </summary>
    Task<List<string>> GetGroupPermissionsAsync(string groupName);
    
    /// <summary>
    /// é‡æ–°åŠ è½½æƒé™é…ç½®
    /// </summary>
    Task ReloadAsync();
    
    /// <summary>
    /// ä¿å­˜æƒé™é…ç½®
    /// </summary>
    Task SaveAsync();
}
```

---

## ğŸ’¼ **ä½¿ç”¨ç¤ºä¾‹**

### **1. æƒé™æ£€æŸ¥**

```csharp
// æ£€æŸ¥å•ä¸ªæƒé™
if (await _context.PermissionManager.HasPermissionAsync("Steve", "myplugin.admin"))
{
    // æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ
}

// è·å–ç©å®¶çš„æ‰€æœ‰æƒé™
var permissions = await _context.PermissionManager.GetUserPermissionsAsync("Steve");
foreach (var perm in permissions)
{
    _context.Logger.Info($"æƒé™: {perm}");
}
```

### **2. åœ¨å‘½ä»¤ä¸­ä½¿ç”¨**

```csharp
public class AdminCommand : ICommand
{
    private readonly IPluginContext _context;

    public string Name => "admin";
    public string Description => "ç®¡ç†å‘˜å‘½ä»¤";

    public async Task<CommandResult> ExecuteAsync(string[] args, ICommandSender? sender = null)
    {
        // æ£€æŸ¥æƒé™
        if (sender != null && !await _context.PermissionManager.HasPermissionAsync(
            sender.Name, "myplugin.admin"))
        {
            return CommandResult.Fail("ä½ æ²¡æœ‰æƒé™ä½¿ç”¨æ­¤å‘½ä»¤");
        }

        // æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ
        return CommandResult.Success("ç®¡ç†å‘˜å‘½ä»¤æ‰§è¡ŒæˆåŠŸ");
    }
}
```

---

## ğŸ”Œ **æ’ä»¶é›†æˆ**

### **å®ç°æƒé™ç®¡ç†æ’ä»¶**

å¦‚æœä½ éœ€è¦å®ç°ä¸€ä¸ªæƒé™ç®¡ç†æ’ä»¶ï¼Œéœ€è¦æä¾› `IPermissionManager` æ¥å£çš„å®ç°ï¼Œå¹¶æ³¨å†Œåˆ° NetherGateï¼š

```csharp
public class PermissionPlugin : IPlugin
{
    private IPluginContext _context;
    
    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // åˆ›å»ºæƒé™ç®¡ç†å™¨å®ç°
        var permissionManager = new MyPermissionManager();
        
        // æ³¨å†Œåˆ° NetherGateï¼ˆé€šè¿‡æœåŠ¡æ³¨å…¥ï¼‰
        // å…·ä½“æ³¨å†Œæ–¹å¼å–å†³äº NetherGate çš„æœåŠ¡ç®¡ç†æœºåˆ¶
    }
}

// å®ç°æƒé™ç®¡ç†å™¨
public class MyPermissionManager : IPermissionManager
{
    private readonly Dictionary<string, List<string>> _userPermissions = new();
    private readonly Dictionary<string, List<string>> _groupPermissions = new();
    
    public async Task<bool> HasPermissionAsync(string playerName, string permission)
    {
        // 1. æ£€æŸ¥ç”¨æˆ·ç‰¹å®šæƒé™
        if (_userPermissions.TryGetValue(playerName, out var userPerms))
        {
            if (CheckPermission(userPerms, permission))
                return true;
        }
        
        // 2. æ£€æŸ¥ç»„æƒé™
        var groups = await GetUserGroupsAsync(playerName);
        foreach (var group in groups)
        {
            if (_groupPermissions.TryGetValue(group, out var groupPerms))
            {
                if (CheckPermission(groupPerms, permission))
                    return true;
            }
        }
        
        return false;
    }
    
    private bool CheckPermission(List<string> permissions, string required)
    {
        // å®ç°é€šé…ç¬¦åŒ¹é…é€»è¾‘
        // æ”¯æŒ * å’Œ namespace.* æ ¼å¼
        // æ”¯æŒå¦å®šæƒé™ -permission
        
        foreach (var perm in permissions)
        {
            if (perm == "*") return true;
            if (perm == required) return true;
            if (perm.EndsWith(".*") && required.StartsWith(perm[..^1]))
                return true;
        }
        
        return false;
    }
    
    // å®ç°å…¶ä»–æ¥å£æ–¹æ³•...
}
```

### **æƒé™æ•°æ®å­˜å‚¨**

æƒé™ç®¡ç†æ’ä»¶å¯ä»¥é€‰æ‹©ä¸åŒçš„å­˜å‚¨æ–¹å¼ï¼š

#### **1. æ–‡ä»¶å­˜å‚¨ï¼ˆYAML/JSONï¼‰**

```csharp
public class FilePermissionStorage
{
    public async Task SavePermissionsAsync(PermissionData data)
    {
        var yaml = new SerializerBuilder().Build();
        var yamlContent = yaml.Serialize(data);
        await File.WriteAllTextAsync("permissions.yaml", yamlContent);
    }
    
    public async Task<PermissionData> LoadPermissionsAsync()
    {
        var yamlContent = await File.ReadAllTextAsync("permissions.yaml");
        var deserializer = new DeserializerBuilder().Build();
        return deserializer.Deserialize<PermissionData>(yamlContent);
    }
}
```

#### **2. æ•°æ®åº“å­˜å‚¨ï¼ˆSQLite/MySQLï¼‰**

```csharp
public class DatabasePermissionStorage
{
    private readonly DbContext _db;
    
    public async Task<List<string>> GetUserPermissionsAsync(string playerName)
    {
        return await _db.UserPermissions
            .Where(p => p.PlayerName == playerName)
            .Select(p => p.Permission)
            .ToListAsync();
    }
    
    public async Task GrantPermissionAsync(string playerName, string permission)
    {
        _db.UserPermissions.Add(new UserPermission
        {
            PlayerName = playerName,
            Permission = permission
        });
        await _db.SaveChangesAsync();
    }
}
```

---

## ğŸ¯ **æƒé™èŠ‚ç‚¹çº¦å®š**

### **NetherGate æ ¸å¿ƒæƒé™**

```
nethergate.*                    # æ‰€æœ‰æ ¸å¿ƒæƒé™
nethergate.help                 # æŸ¥çœ‹å¸®åŠ©
nethergate.plugin.*             # æ‰€æœ‰æ’ä»¶ç®¡ç†æƒé™
nethergate.plugin.list          # åˆ—å‡ºæ’ä»¶
nethergate.plugin.info          # æŸ¥çœ‹æ’ä»¶ä¿¡æ¯
nethergate.plugin.reload        # é‡è½½æ’ä»¶
nethergate.plugin.enable        # å¯ç”¨æ’ä»¶
nethergate.plugin.disable       # ç¦ç”¨æ’ä»¶
nethergate.permission.*         # æ‰€æœ‰æƒé™ç®¡ç†æƒé™
nethergate.permission.reload    # é‡è½½æƒé™é…ç½®
nethergate.permission.grant     # æˆäºˆæƒé™
nethergate.permission.revoke    # ç§»é™¤æƒé™
```

### **æ’ä»¶æƒé™å‘½åå»ºè®®**

```
<æ’ä»¶å>.*                       # æ’ä»¶æ‰€æœ‰æƒé™
<æ’ä»¶å>.command.*               # æ‰€æœ‰å‘½ä»¤æƒé™
<æ’ä»¶å>.command.<å‘½ä»¤å>        # ç‰¹å®šå‘½ä»¤
<æ’ä»¶å>.feature.*               # æ‰€æœ‰åŠŸèƒ½æƒé™
<æ’ä»¶å>.feature.<åŠŸèƒ½å>        # ç‰¹å®šåŠŸèƒ½
<æ’ä»¶å>.admin                   # ç®¡ç†æƒé™
```

**ç¤ºä¾‹ï¼š**
```
economy.*
economy.command.*
economy.command.balance
economy.command.pay
economy.command.admin
economy.feature.shop
economy.feature.auction
economy.admin
```

---

## ğŸ’¡ **æœ€ä½³å®è·µ**

### **1. æƒé™ç²’åº¦**

âœ… **æ¨èï¼š** ç»†ç²’åº¦æƒé™
```yaml
permissions:
  - "myplugin.command.tp"
  - "myplugin.command.tphere"
  - "myplugin.feature.home"
```

âŒ **ä¸æ¨èï¼š** è¿‡äºç²—ç²’åº¦
```yaml
permissions:
  - "myplugin.*"  # ç»™äºˆæ‰€æœ‰æƒé™
```

### **2. ç»„ç»‡ç»“æ„**

```yaml
# æŒ‰è§’è‰²ç»„ç»‡
groups:
  player:    # ç©å®¶
  vip:       # ä»˜è´¹ç©å®¶
  helper:    # ç®¡ç†åŠ©æ‰‹
  moderator: # ç‰ˆä¸»
  admin:     # ç®¡ç†å‘˜
  owner:     # æœä¸»
```

### **3. ç»§æ‰¿é“¾**

```
owner
 â””â”€ admin
     â””â”€ moderator
         â””â”€ helper
             â””â”€ vip
                 â””â”€ player (default)
```

### **4. å¦å®šæƒé™**

```yaml
admin:
  permissions:
    - "nethergate.*"
    - "-nethergate.server.stop"  # ç¦æ­¢åœæœ
    - "myplugin.*"
    - "-myplugin.dangerous"      # ç¦æ­¢å±é™©æ“ä½œ
```

### **5. ä¸´æ—¶æƒé™**

å¯¹äºä¸´æ—¶æƒé™ï¼Œå»ºè®®åœ¨ä»£ç ä¸­åŠ¨æ€ç®¡ç†è€Œä¸æ˜¯å†™å…¥é…ç½®ï¼š

```csharp
// æ´»åŠ¨æœŸé—´ç»™äºˆç‰¹æ®Šæƒé™
await _context.PermissionManager.GrantPermissionAsync(playerName, "event.halloween");

// æ´»åŠ¨ç»“æŸç§»é™¤
await _context.PermissionManager.RevokePermissionAsync(playerName, "event.halloween");
```

---

## ğŸš¨ **å¸¸è§é—®é¢˜**

### **Q: NetherGate æ ¸å¿ƒæä¾›æƒé™ç®¡ç†å—ï¼Ÿ**

**A:** NetherGate æ ¸å¿ƒåªæä¾›æƒé™ API æ¥å£ (`IPermissionManager`)ï¼Œå…·ä½“çš„æƒé™ç®¡ç†åŠŸèƒ½ï¼ˆé…ç½®æ–‡ä»¶ã€å‘½ä»¤ç­‰ï¼‰éœ€è¦ç”±ç‹¬ç«‹çš„æƒé™ç®¡ç†æ’ä»¶å®ç°ã€‚

### **Q: å¦‚ä½•è·å–æƒé™ç®¡ç†æ’ä»¶ï¼Ÿ**

**A:** ä½ å¯ä»¥ï¼š
1. ä½¿ç”¨ç¤¾åŒºæä¾›çš„æƒé™ç®¡ç†æ’ä»¶
2. å‚è€ƒæœ¬æ–‡æ¡£çš„"æ’ä»¶é›†æˆ"éƒ¨åˆ†ï¼Œè‡ªå·±å®ç°ä¸€ä¸ªæƒé™ç®¡ç†æ’ä»¶

### **Q: æƒé™ç³»ç»Ÿæ”¯æŒå“ªäº›åŠŸèƒ½ï¼Ÿ**

**A:** API æ”¯æŒï¼š
- æƒé™æ£€æŸ¥ï¼ˆæ ¸å¿ƒï¼‰
- ç”¨æˆ·ç»„ç®¡ç†
- æƒé™æˆäºˆ/æ’¤é”€
- æƒé™ç»„ç®¡ç†

å…·ä½“åŠŸèƒ½çš„å®ç°å–å†³äºæƒé™ç®¡ç†æ’ä»¶çš„è®¾è®¡ã€‚

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [å‘½ä»¤ç³»ç»Ÿ](./å‘½ä»¤ç³»ç»Ÿ.md) - åœ¨å‘½ä»¤ä¸­ä½¿ç”¨æƒé™
- [æ’ä»¶å¼€å‘æŒ‡å—](../03-æ’ä»¶å¼€å‘/æ’ä»¶å¼€å‘æŒ‡å—.md) - æ’ä»¶å¼€å‘åŸºç¡€
- [ç¤ºä¾‹æ’ä»¶é›†](../07-ç¤ºä¾‹å’Œæœ€ä½³å®è·µ/ç¤ºä¾‹æ’ä»¶é›†.md) - æƒé™æ’ä»¶ç¤ºä¾‹

---

## ğŸ’¡ **æ¨èçš„æƒé™æ’ä»¶ç¤ºä¾‹**

å®ç°ä¸€ä¸ªå®Œæ•´çš„æƒé™ç®¡ç†æ’ä»¶ï¼Œå»ºè®®åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **é…ç½®ç®¡ç†**
   - YAML/JSON é…ç½®æ–‡ä»¶
   - æƒé™ç»„å®šä¹‰
   - ç”¨æˆ·åˆ†ç»„
   - ç»§æ‰¿å…³ç³»

2. **å‘½ä»¤ç³»ç»Ÿ**
   - `/perm user <player> add/remove <permission>` - ç”¨æˆ·æƒé™ç®¡ç†
   - `/perm group <group> add/remove <permission>` - ç»„æƒé™ç®¡ç†
   - `/perm user <player> group add/remove <group>` - ç”¨æˆ·ç»„ç®¡ç†
   - `/perm reload` - é‡è½½é…ç½®

3. **é€šé…ç¬¦æ”¯æŒ**
   - å…¨å±€é€šé…ç¬¦ `*`
   - å‘½åç©ºé—´é€šé…ç¬¦ `namespace.*`
   - å¦å®šæƒé™ `-permission`

4. **ä¼˜å…ˆçº§ç³»ç»Ÿ**
   - ç»„ä¼˜å…ˆçº§
   - æƒé™ç»§æ‰¿
   - å†²çªè§£å†³

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** NetherGate å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°ï¼š** 2025-01-08  
**è®¸å¯è¯ï¼š** LGPL-3.0
