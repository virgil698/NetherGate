# NetherGate äº‹ä»¶ç›‘å¬ä¼˜å…ˆçº§ç­–ç•¥

## ğŸ“‹ ä¼˜å…ˆçº§åŸåˆ™

NetherGate é‡‡ç”¨**ä¸‰å±‚äº‹ä»¶ç›‘å¬ç­–ç•¥**ï¼ŒæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼š

```
1ï¸âƒ£ SMP åè®®ï¼ˆServer Management Protocolï¼‰ - æœ€é«˜ä¼˜å…ˆçº§
    â†“ å¦‚æœ SMP ä¸æ”¯æŒè¯¥äº‹ä»¶
2ï¸âƒ£ RCON åè®®ï¼ˆRemote Consoleï¼‰ - æ¬¡ä¼˜å…ˆçº§
    â†“ å¦‚æœ RCON ä¸æ”¯æŒè¯¥äº‹ä»¶
3ï¸âƒ£ æ—¥å¿—è§£æï¼ˆLog Parsingï¼‰ - æœ€ä½ä¼˜å…ˆçº§
```

### ä¸ºä»€ä¹ˆé‡‡ç”¨è¿™ä¸ªä¼˜å…ˆçº§ï¼Ÿ

| åè®®/æ–¹å¼ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|---------|
| **SMP** | âœ… ç»“æ„åŒ–æ•°æ®<br>âœ… å®æ—¶æ¨é€<br>âœ… åŒ…å« UUID<br>âœ… å®˜æ–¹æ”¯æŒ | âŒ è¦†ç›–èŒƒå›´æœ‰é™<br>âŒ éœ€è¦ MC 1.21.9+ | ç®¡ç†æ“ä½œã€ç©å®¶åŠ å…¥/ç¦»å¼€ |
| **RCON** | âœ… å‘½ä»¤æ‰§è¡Œ<br>âœ… å¹¿æ³›æ”¯æŒ | âŒ æ— äº‹ä»¶ç›‘å¬<br>âŒ å•å‘é€šä¿¡ | æ‰§è¡Œæ¸¸æˆå‘½ä»¤ |
| **æ—¥å¿—è§£æ** | âœ… è¦†ç›–æ‰€æœ‰äº‹ä»¶<br>âœ… æ— ç‰ˆæœ¬é™åˆ¶ | âŒ ä¸å¯é ï¼ˆæ ¼å¼å˜æ›´ï¼‰<br>âŒ ç¼ºå°‘ç»“æ„åŒ–æ•°æ®<br>âŒ æœ‰å»¶è¿Ÿ | SMP/RCON ä¸æ”¯æŒçš„äº‹ä»¶ |

---

## ğŸŸ¢ ç¬¬ä¸€å±‚ï¼šSMP åè®®ï¼ˆå·²å®ç°ï¼‰

æ ¹æ® [Minecraft Wiki SMP æ–‡æ¡£](https://zh.minecraft.wiki/w/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE?variant=zh-cn)ï¼ŒSMP æ”¯æŒä»¥ä¸‹å®æ—¶é€šçŸ¥ï¼š

### ç©å®¶äº‹ä»¶
- âœ… **ç©å®¶åŠ å…¥** (`players/joined`) â†’ `PlayerJoinedEvent`
  - åŒ…å«ï¼šUUIDã€ç©å®¶åã€IP åœ°å€
- âœ… **ç©å®¶ç¦»å¼€** (`players/left`) â†’ `PlayerLeftEvent`
  - åŒ…å«ï¼šUUIDã€ç©å®¶å

### ç®¡ç†æ“ä½œäº‹ä»¶
- âœ… **ç®¡ç†å‘˜æ·»åŠ ** (`operators/added`) â†’ `OperatorAddedEvent`
- âœ… **ç®¡ç†å‘˜ç§»é™¤** (`operators/removed`) â†’ `OperatorRemovedEvent`
- âœ… **ç™½åå•æ·»åŠ ** (`allowlist/added`) â†’ `AllowlistChangedEvent`
- âœ… **ç™½åå•ç§»é™¤** (`allowlist/removed`) â†’ `AllowlistChangedEvent`
- âœ… **ç©å®¶å°ç¦** (`bans/added`) â†’ `PlayerBannedEvent`
- âœ… **ç©å®¶è§£å°** (`bans/removed`) â†’ `PlayerUnbannedEvent`
- âœ… **IP å°ç¦** (`ip_bans/added`) â†’ `IpBannedEvent`
- âœ… **IP è§£å°** (`ip_bans/removed`) â†’ `IpUnbannedEvent`

### æœåŠ¡å™¨äº‹ä»¶
- âœ… **æ¸¸æˆè§„åˆ™æ›´æ–°** (`gamerules/updated`) â†’ `GameRuleChangedEvent`
- âœ… **æœåŠ¡å™¨çŠ¶æ€å¿ƒè·³** (`server/status`) â†’ `ServerStartedEvent`

**å®ç°æ–‡ä»¶**ï¼š
- `src/NetherGate.Core/Protocol/SmpClient.cs` (719 è¡Œ)
- `src/NetherGate.API/Events/SmpEvents.cs` (235 è¡Œ)

---

## ğŸŸ¡ ç¬¬äºŒå±‚ï¼šRCON åè®®ï¼ˆå·²å®ç°ï¼‰

### æ”¯æŒçš„åŠŸèƒ½
- âœ… **æ‰§è¡Œæ¸¸æˆå‘½ä»¤** (`SendCommandAsync()`)
  - ç¤ºä¾‹ï¼š`/say`, `/give`, `/tp`, `/gamemode`, `/effect` ç­‰

### ä¸æ”¯æŒçš„åŠŸèƒ½
- âŒ **äº‹ä»¶ç›‘å¬**ï¼ˆRCON æ˜¯å•å‘é€šä¿¡åè®®ï¼Œåªèƒ½å‘é€å‘½ä»¤ï¼Œæ— æ³•æ¥æ”¶äº‹ä»¶æ¨é€ï¼‰

**å®ç°æ–‡ä»¶**ï¼š
- `src/NetherGate.Core/Protocol/RconClient.cs` (268 è¡Œ)
- `src/NetherGate.API/Protocol/IRconClient.cs` (42 è¡Œ)

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ’ä»¶éœ€è¦æ‰§è¡Œæ¸¸æˆå†…å‘½ä»¤
- é…åˆæ—¥å¿—è§£æå®ç°å‘½ä»¤å“åº”

---

## ğŸ”´ ç¬¬ä¸‰å±‚ï¼šæ—¥å¿—è§£æï¼ˆå·²å®ç°ï¼‰

ç”¨äºç›‘å¬ SMP å’Œ RCON éƒ½ä¸æ”¯æŒçš„äº‹ä»¶ã€‚

### æ”¯æŒçš„äº‹ä»¶
- âœ… **ç©å®¶èŠå¤©** â†’ `PlayerChatEvent`
  - è§£æï¼š`<PlayerName> message`
- âœ… **ç©å®¶å‘½ä»¤** â†’ `PlayerCommandEvent`
  - è§£æï¼š`PlayerName issued server command: /command`
- âœ… **ç©å®¶æ­»äº¡** â†’ `PlayerDeathEvent`
  - è§£æï¼šå…³é”®è¯åŒ¹é…ï¼ˆwas killed, died, drowned ç­‰ï¼‰
- âœ… **ç©å®¶æˆå°±** â†’ `PlayerAchievementEvent`
  - è§£æï¼š`PlayerName has made the advancement [Achievement]`
- âœ… **é€šç”¨æ—¥å¿—** â†’ `ServerLogEvent`
  - æ‰€æœ‰æœåŠ¡å™¨è¾“å‡º

### æœåŠ¡å™¨è¿›ç¨‹ç›‘æ§
- âœ… **è¿›ç¨‹å¯åŠ¨** â†’ `ServerProcessStartedEvent`
- âœ… **è¿›ç¨‹åœæ­¢** â†’ `ServerProcessStoppedEvent`
- âœ… **è¿›ç¨‹å´©æºƒ** â†’ `ServerProcessCrashedEvent`

**å®ç°æ–‡ä»¶**ï¼š
- `src/NetherGate.Core/Process/LogParser.cs` (182 è¡Œ)
- `src/NetherGate.Core/Process/ServerProcessManager.cs` (406 è¡Œ)
- `src/NetherGate.API/Events/ServerEvents.cs` (101 è¡Œ)

**æ³¨æ„äº‹é¡¹**ï¼š
- æ—¥å¿—æ ¼å¼å¯èƒ½å›  Minecraft ç‰ˆæœ¬ã€è¯­è¨€ã€MOD è€Œå˜åŒ–
- ä¸å¦‚ SMP å¯é ï¼Œå»ºè®®ä»…ç”¨äºè¡¥å……

---

## ğŸ“Š äº‹ä»¶è¦†ç›–çŸ©é˜µ

| äº‹ä»¶ç±»å‹ | SMP | RCON | æ—¥å¿—è§£æ | å½“å‰å®ç° |
|---------|-----|------|---------|---------|
| ç©å®¶åŠ å…¥ | âœ… | âŒ | âœ… | **SMP** |
| ç©å®¶ç¦»å¼€ | âœ… | âŒ | âœ… | **SMP** |
| ç©å®¶èŠå¤© | âŒ | âŒ | âœ… | **æ—¥å¿—è§£æ** |
| ç©å®¶å‘½ä»¤ | âŒ | âŒ | âœ… | **æ—¥å¿—è§£æ** |
| ç©å®¶æ­»äº¡ | âŒ | âŒ | âœ… | **æ—¥å¿—è§£æ** |
| ç©å®¶æˆå°± | âŒ | âŒ | âœ… | **æ—¥å¿—è§£æ** |
| ç®¡ç†å‘˜æ“ä½œ | âœ… | âŒ | âŒ | **SMP** |
| ç™½åå•æ“ä½œ | âœ… | âŒ | âŒ | **SMP** |
| å°ç¦æ“ä½œ | âœ… | âŒ | âŒ | **SMP** |
| æ¸¸æˆè§„åˆ™å˜æ›´ | âœ… | âŒ | âŒ | **SMP** |
| æ‰§è¡Œå‘½ä»¤ | âŒ | âœ… | âŒ | **RCON** |
| æœåŠ¡å™¨è¿›ç¨‹ | âŒ | âŒ | âœ… | **è¿›ç¨‹ç›‘æ§** |

---

## ğŸ¯ ä»£ç å®ç°éªŒè¯

### é¿å…é‡å¤ç›‘å¬

`LogParser.cs` ä¸­å·²æ˜ç¡®æ³¨é‡Šï¼š

```csharp
// æ³¨æ„: ç©å®¶åŠ å…¥/ç¦»å¼€äº‹ä»¶ç”± SMP åè®®æä¾›ï¼ˆæ›´å¯é ã€æ›´åŠæ—¶ï¼‰
// æ­¤å¤„ä»…è§£æ SMP ä¸æ”¯æŒçš„äº‹ä»¶
```

**å·²ç§»é™¤çš„æ—¥å¿—è§£æ**ï¼š
- ~~ç©å®¶åŠ å…¥~~ â†’ æ”¹ç”¨ SMP `players/joined`
- ~~ç©å®¶ç¦»å¼€~~ â†’ æ”¹ç”¨ SMP `players/left`

**ä¿ç•™çš„æ—¥å¿—è§£æ**ï¼ˆSMP ä¸æ”¯æŒï¼‰ï¼š
- âœ… ç©å®¶èŠå¤©
- âœ… ç©å®¶å‘½ä»¤
- âœ… ç©å®¶æ­»äº¡
- âœ… ç©å®¶æˆå°±

---

## ğŸš€ æœªæ¥æ‰©å±•

### å¦‚æœ Mojang å¢åŠ æ–°çš„ SMP é€šçŸ¥

**æ­¥éª¤**ï¼š
1. åœ¨ `SmpClient.cs` ä¸­æ³¨å†Œæ–°é€šçŸ¥å¤„ç†å™¨
2. åœ¨ `SmpEvents.cs` ä¸­å®šä¹‰æ–°äº‹ä»¶ç±»
3. å¦‚æœæ—¥å¿—è§£æä¸­æœ‰é‡å¤ï¼Œç§»é™¤æ—¥å¿—è§£æé€»è¾‘
4. æ›´æ–°æœ¬æ–‡æ¡£

### ç¤ºä¾‹ï¼šå‡è®¾ SMP æœªæ¥æ”¯æŒèŠå¤©äº‹ä»¶

```csharp
// 1. æ³¨å†Œé€šçŸ¥å¤„ç†å™¨
_rpcHandler.RegisterNotificationHandler("players/chat", HandlePlayerChat);

// 2. å®ç°å¤„ç†æ–¹æ³•
private async void HandlePlayerChat(JsonRpcNotification notification)
{
    var data = notification.GetParams<ChatMessage>();
    await _eventBus.PublishAsync(new PlayerChatEvent 
    { 
        PlayerName = data.Player.Name,
        Message = data.Message 
    });
}

// 3. ç§»é™¤ LogParser.cs ä¸­çš„èŠå¤©è§£æ
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [SMP API æ–‡æ¡£](./SMP_API.md) - å®Œæ•´çš„ SMP æ¥å£è¯´æ˜
- [RCON ä½¿ç”¨æŒ‡å—](./RCON.md) - RCON å‘½ä»¤æ‰§è¡Œ
- [æ—¥å¿—è§£æè¯´æ˜](./LOG_PARSING.md) - æ—¥å¿—è§£æè§„åˆ™
- [æ’ä»¶å¼€å‘æŒ‡å—](./PLUGIN_GUIDE.md) - å¦‚ä½•è®¢é˜…äº‹ä»¶

---

## æ€»ç»“

âœ… **NetherGate é‡‡ç”¨æ™ºèƒ½ä¸‰å±‚ç­–ç•¥**ï¼Œä¼˜å…ˆä½¿ç”¨å®˜æ–¹ã€å¯é çš„ SMP åè®®ï¼Œåœ¨å…¶ä¸è¶³æ—¶æ‰é€€åŒ–åˆ°å…¶ä»–æ–¹æ¡ˆã€‚

âœ… **å½“å‰å®ç°å·²å®Œå…¨ç¬¦åˆæ­¤ç­–ç•¥**ï¼Œæ— é‡å¤ç›‘å¬ï¼Œæœ€å¤§åŒ–å¯é æ€§ã€‚

âœ… **æœªæ¥å¯æ‰©å±•**ï¼Œå½“ Mojang å¢å¼º SMP åŠŸèƒ½æ—¶ï¼Œå¯è½»æ¾è¿ç§»ã€‚

