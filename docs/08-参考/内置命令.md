# NetherGate 内置命令参考

本文档详细介绍 NetherGate 框架的所有内置命令。

---

## 📋 目录

- [命令前缀说明](#命令前缀说明)
- [插件管理命令](#插件管理命令)
- [系统命令](#系统命令)
- [权限管理命令](#权限管理命令)
- [Tab 自动补全](#tab-自动补全)

---

## 🔖 命令前缀说明

### **控制台输入**
在 NetherGate 控制台中，**可以不使用前缀**：

```bash
> help                    # ✅ 正确
> plugin list            # ✅ 正确
> status                 # ✅ 正确
```

### **游戏内输入**
在 Minecraft 游戏聊天框中，**必须使用 `#` 前缀**：

```
#help                    # ✅ 正确
#plugin list             # ✅ 正确
#status                  # ✅ 正确

help                     # ❌ 错误 - 会被当作聊天消息
```

### **为什么使用 `#` 前缀？**

1. **避免冲突** - Minecraft 原生命令使用 `/` 前缀
2. **明确区分** - 清楚地区分游戏命令和框架命令
3. **统一标准** - 所有 NetherGate 命令使用相同标识

---

## 🔌 插件管理命令

### **plugin list** - 查看插件列表

**别名**: `pl list`, `pl ls`, `plugins`

**用法**:
```bash
plugin list
```

**描述**: 显示所有已加载的插件及其状态。

**示例输出**:
```
已加载的插件 (3):
  ✓ backup-manager v1.0.0 by ExampleAuthor
  ✗ world-editor v2.1.0 by AnotherDev
  ! buggy-plugin v0.1.0 by TestUser

使用 'plugin info <id>' 查看详情
```

**状态图标**:
- `✓` - 已启用
- `✗` - 已禁用
- `!` - 错误状态

---

### **plugin reload** - 重载插件

**别名**: `pl reload`, `pl rl`

**用法**:
```bash
plugin reload <插件ID>      # 重载单个插件
plugin reload all           # 重载所有插件
```

**描述**: 热重载插件，无需重启服务器。

**重载流程**:
1. 保存插件状态
2. 调用 `OnDisableAsync()`
3. 卸载程序集
4. 重新加载程序集
5. 调用 `OnLoadAsync()` 和 `OnEnableAsync()`
6. 恢复插件状态

**示例**:
```bash
> plugin reload backup-manager
[14:23:45 INFO]: 重载插件: backup-manager
[14:23:45 INFO]: 插件 backup-manager 重载成功

> plugin reload all
[14:24:10 INFO]: 开始重载所有插件...
[14:24:12 INFO]: 插件重载完成: 成功 2 个，失败 0 个
```

**注意事项**:
- ⚠️ 重载过程中，所有事件订阅和命令会被清理
- ⚠️ 配置文件不会自动重新加载（除非插件自行实现）
- ⚠️ 如果重载失败，插件会保持禁用状态

---

### **plugin enable** - 启用插件

**别名**: `pl enable`

**用法**:
```bash
plugin enable <插件ID>
```

**描述**: 启用已禁用的插件。

**示例**:
```bash
> plugin enable backup-manager
[14:25:00 INFO]: 插件 backup-manager 已启用
```

---

### **plugin disable** - 禁用插件

**别名**: `pl disable`

**用法**:
```bash
plugin disable <插件ID>
```

**描述**: 禁用已启用的插件。禁用后：
- 事件处理器停止响应
- 命令将不再可用
- 定时任务将被取消

**示例**:
```bash
> plugin disable backup-manager
[14:26:00 INFO]: 插件 backup-manager 已禁用
```

---

### **plugin info** - 查看插件详情

**别名**: `pl info`

**用法**:
```bash
plugin info <插件ID>
```

**描述**: 显示插件的详细信息。

**示例**:
```bash
> plugin info backup-manager
插件信息:
  ID: backup-manager
  名称: Backup Manager
  版本: 1.0.0
  作者: ExampleAuthor
  描述: 自动备份服务器世界
  状态: 已启用
  
  NuGet依赖:
    - Newtonsoft.Json
    - SharpZipLib
  
  库依赖:
    - fNbt >= 1.0.0
  
  插件依赖:
    - world-api >= 2.0.0
  
  网站: https://github.com/example/backup-manager
```

---

### **plugin load** - 加载新插件

**别名**: `pl load`

**用法**:
```bash
plugin load <插件ID>
```

**描述**: 从 `plugins/` 目录加载新添加的插件。

**状态**: ⚠️ **暂未完全实现**

**当前行为**: 提示用户重启 NetherGate。

---

### **plugin unload** - 卸载插件

**别名**: `pl unload`

**用法**:
```bash
plugin unload <插件ID>
```

**描述**: 完全卸载插件，包括从内存中移除。

**状态**: ⚠️ **暂未完全实现**

**当前替代方案**: 使用 `plugin disable <id>`。

---

## 🖥️ 系统命令

### **help** - 显示帮助信息

**用法**:
```bash
help
```

**描述**: 显示所有可用命令的列表。

**示例输出**:
```
NetherGate 可用命令:
  help            - 显示所有可用命令
  plugin          - 管理插件 (list/reload/enable/disable/info)
  permission      - 管理权限 (group/user/list)
  status          - 显示服务器状态
  stop            - 停止服务器

注意: 游戏内执行命令需要加 # 前缀（例如: #help）
```

---

### **status** - 显示服务器状态

**用法**:
```bash
status
```

**描述**: 显示 Minecraft 服务器的当前状态。

**示例输出**:
```
服务器状态:
  版本: 1.20.1 (Protocol 763)
  在线玩家: 5/20
  TPS: 19.8
  内存使用: 2048MB / 4096MB (50%)
  运行时间: 2 小时 15 分钟
```

---

### **stop** - 停止服务器

**用法**:
```bash
stop
```

**描述**: 安全地停止 Minecraft 服务器和 NetherGate。

**执行流程**:
1. 保存所有插件状态
2. 禁用所有插件
3. 停止 Minecraft 服务器
4. 关闭 NetherGate

**注意**: 
- ⚠️ 需要管理员权限
- ⚠️ 控制台窗口会保持打开以便查看日志

---

## 🔐 权限管理命令

### **permission group** - 管理权限组

**用法**:
```bash
permission group list                           # 列出所有权限组
permission group create <组名> [优先级]          # 创建权限组
permission group delete <组名>                   # 删除权限组
permission group info <组名>                     # 查看权限组信息
permission group add <组名> <权限>               # 添加权限到组
permission group remove <组名> <权限>            # 从组移除权限
permission group inherit <组名> <父组名>         # 设置继承关系
```

**示例**:
```bash
> permission group create admin 100
[INFO]: 权限组 'admin' 创建成功，优先级: 100

> permission group add admin nethergate.plugins.manage
[INFO]: 权限 'nethergate.plugins.manage' 已添加到组 'admin'

> permission group inherit moderator admin
[INFO]: 组 'moderator' 现在继承自 'admin'
```

---

### **permission user** - 管理用户权限

**用法**:
```bash
permission user info <玩家>                     # 查看用户权限
permission user add <玩家> <权限>                # 添加权限给用户
permission user remove <玩家> <权限>             # 移除用户权限
permission user group add <玩家> <组名>          # 添加用户到组
permission user group remove <玩家> <组名>       # 从组移除用户
```

**示例**:
```bash
> permission user info Steve
玩家权限: Steve
  所属组: [admin, vip]
  直接权限:
    - nethergate.command.reload
  继承权限:
    - nethergate.plugins.manage (来自 admin)
    - nethergate.command.* (来自 admin)

> permission user group add Steve admin
[INFO]: 玩家 Steve 已添加到权限组 'admin'
```

---

### **permission list** - 列出所有权限

**用法**:
```bash
permission list
```

**描述**: 显示系统中所有已注册的权限。

**示例输出**:
```
已注册的权限:
  
  核心权限:
    - nethergate.plugins.manage     # 插件管理
    - nethergate.command.reload     # 重载命令
    - nethergate.command.stop       # 停止服务器
  
  插件权限:
    - backup.create                 # 创建备份
    - backup.restore                # 恢复备份
    - worldedit.selection           # 选择区域
```

---

## ⌨️ Tab 自动补全

NetherGate 支持完整的 Tab 自动补全功能。

### **插件命令补全**

```bash
> plugin [Tab]
list    reload    enable    disable    info    load    unload

> plugin reload [Tab]
all    backup-manager    world-editor    ...

> plugin info [Tab]
backup-manager    world-editor    ...
```

### **权限命令补全**

```bash
> permission [Tab]
group    user    list

> permission group [Tab]
list    create    delete    info    add    remove    inherit

> permission user [Tab]
info    add    remove    group
```

### **使用技巧**

- 按 `Tab` 键显示可用选项
- 输入部分内容后按 `Tab` 自动补全
- 减少拼写错误，提高效率

---

## 🎯 使用场景

### **场景 1: 开发时快速测试**

```bash
# 1. 编辑插件代码
# 2. 重新编译
# 3. 复制 DLL 到 plugins/my-plugin/
> plugin reload my-plugin
[INFO]: 插件 my-plugin 重载成功
```

无需重启服务器即可测试新代码。

---

### **场景 2: 临时禁用问题插件**

```bash
> plugin list
  ✓ backup-manager v1.0.0
  ! buggy-plugin v0.1.0    # 有问题

> plugin disable buggy-plugin
[INFO]: 插件 buggy-plugin 已禁用
```

隔离问题插件，服务器继续运行。

---

### **场景 3: 批量重载所有插件**

```bash
# 修改多个插件配置后
> plugin reload all
[INFO]: 开始重载所有插件...
[INFO]: 插件重载完成: 成功 5 个，失败 0 个
```

所有插件重新加载配置。

---

### **场景 4: 权限管理**

```bash
# 创建管理员组
> permission group create admin 100
> permission group add admin nethergate.*

# 添加用户到组
> permission user group add Steve admin

# 查看用户权限
> permission user info Steve
```

---

## 📊 命令权限一览

| 命令 | 权限 | 说明 |
|------|------|------|
| `help` | - | 无需权限 |
| `status` | - | 无需权限 |
| `plugin list` | - | 无需权限 |
| `plugin reload` | `nethergate.plugins.manage` | 插件管理 |
| `plugin enable/disable` | `nethergate.plugins.manage` | 插件管理 |
| `plugin info` | - | 无需权限 |
| `permission *` | `nethergate.permissions.manage` | 权限管理 |
| `stop` | `nethergate.command.stop` | 停止服务器 |

---

## ⚠️ 常见问题

### **Q: 为什么游戏内执行命令无反应？**

**A**: 确保：
1. 使用 `#` 前缀（游戏内必须）
2. SMP 已启用并正常连接
3. 您有相应的权限

---

### **Q: 重载插件失败怎么办？**

**A**: 
1. 查看 `logs/latest.log` 获取详细错误
2. 确认插件依赖都已安装
3. 检查插件与当前版本的兼容性
4. 尝试先 `disable` 再 `enable`

---

### **Q: 如何查看某个命令需要什么权限？**

**A**: 使用 `permission list` 查看所有权限及说明。

---

## 📝 命令别名对照表

| 完整命令 | 别名 |
|---------|------|
| `plugin` | `pl` |
| `plugin list` | `pl list`, `pl ls`, `plugins` |
| `plugin reload` | `pl reload`, `pl rl` |
| `plugin enable` | `pl enable` |
| `plugin disable` | `pl disable` |
| `plugin info` | `pl info` |
| `permission` | `perm` |

---

## 🔗 相关文档

- [命令系统详解](../02-核心功能/命令系统.md)
- [权限系统详解](../02-核心功能/权限系统.md)
- [插件热重载](../04-高级功能/插件热重载.md)
- [配置文件详解](../01-快速开始/配置文件详解.md)

---

## 📌 最佳实践

### **1. 使用 Tab 补全**
避免拼写错误，提高效率。

### **2. 开发时善用热重载**
快速迭代，无需频繁重启。

### **3. 生产环境谨慎操作**
- 在测试环境验证
- 备份重要数据
- 低峰时段操作

### **4. 定期检查插件状态**
```bash
> plugin list
```
确保关键插件正常运行。

---

**最后更新**: 2025-10-05  
**NetherGate 版本**: v0.1.0

