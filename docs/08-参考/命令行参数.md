# NetherGate 命令行参数参考

本文档介绍 NetherGate 的命令行参数和非交互式命令。

---

## 📋 **目录**

- [启动模式](#启动模式)
- [命令行参数](#命令行参数)
- [配置管理命令](#配置管理命令)
- [诊断命令](#诊断命令)
- [自动化脚本](#自动化脚本)

---

## 🚀 **启动模式**

### **交互模式（默认）**

```bash
# 直接启动，进入交互式控制台
NetherGate.exe

# 或明确指定
NetherGate.exe --interactive
```

在交互模式下，NetherGate 会：
1. 加载配置文件
2. 初始化所有系统组件
3. 启动服务器进程（如果启用）
4. 加载插件
5. 提供交互式命令行界面

### **非交互模式**

非交互模式允许你执行单个命令并立即退出，适合脚本和自动化。

```bash
# 执行命令并退出
NetherGate.exe <command> [options]
```

---

## 🛠️ **命令行参数**

### **`--version` / `-v`** - 显示版本信息

```bash
NetherGate.exe --version
NetherGate.exe -v
```

**输出示例**：
```
NetherGate v0.1.0
.NET 9.0.0
https://github.com/BlockBridge/NetherGate
```

---

### **`--help` / `-h`** - 显示帮助信息

```bash
NetherGate.exe --help
NetherGate.exe -h
```

**输出示例**：
```
NetherGate - Minecraft 服务器管理框架

用法:
  NetherGate.exe [options] [command]

选项:
  -v, --version          显示版本信息
  -h, --help             显示帮助信息
  -i, --interactive      交互模式（默认）
  -s, --setup            运行配置向导
  -c, --config <file>    指定配置文件

命令:
  diagnose               运行诊断
  config validate        验证配置文件
  config export [file]   导出配置
  config import <file>   导入配置
  plugin list            列出所有插件
  plugin info <id>       查看插件详情
  check-deps             检查依赖

使用 'NetherGate.exe <command> --help' 查看命令详情
```

---

### **`--setup` / `-s`** - 运行配置向导

```bash
NetherGate.exe --setup
NetherGate.exe -s
```

启动交互式配置向导，引导你完成初始配置。详见 [配置向导](#配置向导)。

---

### **`--config` / `-c`** - 指定配置文件

```bash
NetherGate.exe --config custom-config.yaml
NetherGate.exe -c custom-config.yaml
```

使用自定义配置文件启动 NetherGate。

---

## ⚙️ **配置管理命令**

### **`config validate`** - 验证配置文件

检查配置文件是否有效，并显示配置摘要。

```bash
NetherGate.exe config validate
```

**输出示例（成功）**：
```
✓ 配置文件有效

配置概要:
  服务器进程: 启用 (java 模式)
  工作目录: ./minecraft_server
  SMP 连接: localhost:40745
  RCON: 启用 (localhost:25575)
  日志级别: Info
  插件目录: plugins (自动加载)
```

**输出示例（失败）**：
```
✗ 配置文件无效

错误详情:
  行 15: 意外的字符 '{'
  建议: 检查 YAML 语法，确保正确缩进

提示: 使用 'NetherGate.exe --setup' 重新生成配置
```

---

### **`config export`** - 导出配置

备份当前配置文件。

```bash
# 导出到默认文件
NetherGate.exe config export

# 导出到指定文件
NetherGate.exe config export my-backup.yaml
```

**输出示例**：
```
✓ 配置已导出到: nethergate-config.backup-20251005-142345.yaml
```

---

### **`config import`** - 导入配置

从备份文件恢复配置。

```bash
NetherGate.exe config import <file>
```

**示例**：
```bash
NetherGate.exe config import my-backup.yaml
```

**输出示例**：
```
✓ 配置已导入
⚠️ 请重启 NetherGate 以应用新配置
```

---

## 🔍 **诊断命令**

### **`diagnose`** - 运行诊断

全面检查 NetherGate 的安装和配置状态。

```bash
NetherGate.exe diagnose
```

**输出示例**：
```
NetherGate 诊断报告
═══════════════════════════════════════════════

系统信息:
  ✓ 操作系统: Windows 10.0.26100
  ✓ .NET 版本: 9.0.0
  ✓ 工作目录: E:\BlockBridge\NetherGate

配置文件:
  ✓ 存在: nethergate-config.yaml
  ✓ 有效: 是
  ✓ WebSocket 配置: 存在

目录结构:
  ✓ 插件目录: plugins
  ✓ 配置目录: config
  ✓ 库目录: lib
  ✓ 日志目录: logs
  ✓ 服务器目录: minecraft_server

插件:
  ✓ 发现 2 个插件
    - backup-manager v1.0.0 (已启用)
    - world-editor v2.1.0 (已禁用)

依赖:
  ✓ lib/ 目录中的核心依赖: 3 个
  ⚠️ 插件依赖: 1 个缺失

网络:
  ✓ SMP 端口 40745: 可用
  ✓ RCON 端口 25575: 可用
  ✓ WebSocket 端口 8766: 可用

服务器连接:
  ⚠️ SMP: 未连接 (服务器未启动)
  ⚠️ RCON: 未连接 (服务器未启动)

总体状态: ✓ 健康
建议:
  - 安装缺失的插件依赖
  - 启动服务器以测试连接
```

---

### **`check-deps`** - 检查依赖

检查所有依赖项是否存在。

```bash
NetherGate.exe check-deps
```

**输出示例**：
```
检查依赖...
═══════════════════════════════════════════════

核心依赖 (lib/):
  ✓ Newtonsoft.Json.dll (13.0.3)
  ✓ YamlDotNet.dll (15.1.0)
  ✓ fNbt.dll (0.6.4)

插件依赖:
  backup-manager:
    ✓ SomeLibrary.dll (1.2.3)
  
  world-editor:
    ✗ MissingLibrary.dll (2.0.0) - 缺失
    建议: 将 MissingLibrary.dll 放入 plugins/world-editor/ 目录

总结:
  ✓ 3/3 核心依赖已安装
  ⚠️ 1/2 插件依赖缺失
```

---

### **`plugin list`** - 列出插件（非交互）

在非交互模式下列出所有插件。

```bash
NetherGate.exe plugin list
```

**输出示例**：
```
已安装的插件 (2):
  ✓ backup-manager v1.0.0 - 自动备份插件
      ID: backup-manager
      作者: ExampleAuthor

  ✗ world-editor v2.1.0 - 世界编辑工具
      ID: world-editor
      作者: AnotherDev

共 2 个插件 (1 启用, 1 禁用)
```

---

### **`plugin info`** - 查看插件详情（非交互）

显示指定插件的详细信息。

```bash
NetherGate.exe plugin info <plugin-id>
```

**示例**：
```bash
NetherGate.exe plugin info backup-manager
```

**输出示例**：
```
插件信息: BackupManager
═══════════════════════════════════════════════
ID:          backup-manager
版本:        1.0.0
描述:        自动备份插件，支持定时备份和手动备份
作者:        ExampleAuthor
主页:        https://github.com/example/backup-manager
仓库:        https://github.com/example/backup-manager.git
状态:        已启用

依赖:
  插件依赖:
    - 无

  库依赖:
    ✓ SomeLibrary (1.2.3)

NetherGate 版本要求: >= 0.1.0
Minecraft 版本要求: >= 1.20.0

数据目录: plugins/backup-manager/
配置文件: plugins/backup-manager/config.yaml
```

---

## 🤖 **自动化脚本**

### **示例 1：自动化部署脚本**

```bash
#!/bin/bash
# deploy.sh - 自动化部署脚本

set -e  # 遇到错误立即退出

echo "═══════════════════════════════════════════════"
echo "  NetherGate 自动化部署"
echo "═══════════════════════════════════════════════"
echo

# 1. 验证配置
echo "[1/4] 验证配置文件..."
./NetherGate.exe config validate || {
    echo "❌ 配置验证失败！"
    exit 1
}
echo

# 2. 检查依赖
echo "[2/4] 检查依赖..."
./NetherGate.exe check-deps
echo

# 3. 运行诊断
echo "[3/4] 运行系统诊断..."
./NetherGate.exe diagnose
echo

# 4. 启动 NetherGate
echo "[4/4] 启动 NetherGate..."
./NetherGate.exe
```

---

### **示例 2：配置备份脚本**

```bash
#!/bin/bash
# backup-config.sh - 定期备份配置

BACKUP_DIR="./config-backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

# 创建备份目录
mkdir -p "$BACKUP_DIR"

# 导出配置
echo "正在备份配置..."
./NetherGate.exe config export "$BACKUP_DIR/config_$TIMESTAMP.yaml"

# 清理旧备份（保留最新10个）
cd "$BACKUP_DIR"
ls -t config_*.yaml | tail -n +11 | xargs -r rm

echo "✓ 配置已备份到: $BACKUP_DIR/config_$TIMESTAMP.yaml"
echo "✓ 保留最新 10 个备份"
```

---

### **示例 3：批量检查脚本**

```bash
#!/bin/bash
# check-all.sh - 批量检查多个 NetherGate 实例

SERVERS=(
    "/servers/lobby"
    "/servers/survival"
    "/servers/creative"
)

echo "═══════════════════════════════════════════════"
echo "  批量检查 NetherGate 实例"
echo "═══════════════════════════════════════════════"
echo

for dir in "${SERVERS[@]}"; do
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "检查: $dir"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    
    if [ -d "$dir" ]; then
        cd "$dir"
        ./NetherGate.exe diagnose
        echo
    else
        echo "⚠️ 目录不存在: $dir"
        echo
    fi
done

echo "✓ 批量检查完成"
```

---

### **示例 4：健康检查脚本（监控）**

```bash
#!/bin/bash
# health-check.sh - 健康检查（用于监控系统）

# 运行诊断并捕获退出码
if ./NetherGate.exe diagnose > /dev/null 2>&1; then
    echo "OK - NetherGate 运行正常"
    exit 0
else
    echo "CRITICAL - NetherGate 检测到问题"
    exit 2
fi
```

---

## 📚 **相关文档**

- [配置文件详解](../01-快速开始/配置文件详解.md)
- [内置命令参考](./内置命令.md) - 交互式命令
- [故障排查](../06-故障排查/常见问题.md)

---

**最后更新**: 2025-10-05  
**NetherGate 版本**: v0.1.0

