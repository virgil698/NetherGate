# NetherGate 配置向导

NetherGate 提供交互式配置向导，帮助你快速完成初始配置。

---

## 📋 **目录**

- [启动配置向导](#启动配置向导)
- [配置流程](#配置流程)
- [配置示例](#配置示例)
- [常见问题](#常见问题)

---

## 🚀 **启动配置向导**

### **方式 1：首次运行自动提示**

如果配置文件不存在，NetherGate 会在启动时自动提示运行配置向导：

```
[NetherGate] 正在启动...
[NetherGate] 版本: 0.1.0
[NetherGate] .NET 版本: 9.0.0

[NetherGate] [1/7] 加载配置...

⚠️  未找到配置文件！

NetherGate 需要配置文件才能运行。

选项:
  [1] 运行配置向导（推荐）
  [2] 使用默认配置
  [3] 退出

请选择 [1-3]: 1
```

### **方式 2：手动启动**

```bash
NetherGate.exe --setup
# 或
NetherGate.exe -s
```

---

## 🛠️ **配置流程**

配置向导包含 5 个步骤，每个步骤都会提示默认值（在方括号 `[]` 中），直接按回车即可使用默认值。

### **完整流程示例**

```
╔════════════════════════════════════════════════════════╗
║                                                        ║
║          NetherGate 配置向导                           ║
║                                                        ║
║  此向导将帮助你快速配置 NetherGate                     ║
║  你可以随时手动编辑 nethergate-config.yaml             ║
║                                                        ║
╚════════════════════════════════════════════════════════╝

═══════════════════════════════════════════════
  步骤 1/5: 服务器进程管理
═══════════════════════════════════════════════

NetherGate 可以管理 Minecraft 服务器进程，或连接到外部运行的服务器。

选择服务器启动方式:
  * [1] 使用 Java 直接启动 (推荐)
    [2] 使用脚本启动
    [3] 连接到外部服务器

选择 [1-3] (默认: 1): 1

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Java 启动配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

服务器工作目录: [./minecraft_server] 
Java 可执行文件路径: [java] 
服务器 JAR 文件名: [server.jar] 

内存配置 (MB):
  最小内存: [2048] 2048
  最大内存: [4096] 4096

是否需要自定义 JVM 参数？ [y/N] n

服务器崩溃时自动重启？ [Y/n] y
  重启延迟 (秒): [5] 
  最大重试次数: [3] 

═══════════════════════════════════════════════
  步骤 2/5: SMP 连接配置
═══════════════════════════════════════════════

SMP (Server Management Protocol) 是 NetherGate 的高级管理协议。

SMP 服务器地址: [localhost] 
SMP 端口: [40745] 

⚠️  重要: 确保在 server.properties 中配置了相同的 SMP 设置:
    management-server-enabled=true
    management-server-port=40745

是否启用 TLS 加密？ [y/N] n

自动连接到 SMP？ [Y/n] y
  连接延迟 (毫秒): [3000] 
  等待服务器启动完成？ [Y/n] y

═══════════════════════════════════════════════
  步骤 3/5: RCON 配置
═══════════════════════════════════════════════

RCON 用于向 Minecraft 服务器发送命令。

是否启用 RCON？ [Y/n] y

RCON 服务器地址: [localhost] 
RCON 端口: [25575] 
RCON 密码: [请输入密码] MySecretPassword123

⚠️  重要: 确保在 server.properties 中配置了相同的 RCON 设置:
    enable-rcon=true
    rcon.port=25575
    rcon.password=MySecretPassword123

自动连接到 RCON？ [Y/n] y

═══════════════════════════════════════════════
  步骤 4/5: 日志系统
═══════════════════════════════════════════════

配置 NetherGate 的日志系统。

日志级别:
  [1] Debug - 详细调试信息
  [2] Info - 一般信息 (推荐)
  [3] Warning - 仅警告和错误
  [4] Error - 仅错误

选择日志级别 [1-4] (默认: 2): 2

启用彩色日志输出？ [Y/n] y

是否记录到文件？ [Y/n] y
  日志文件路径: [logs/latest.log] 
  单个日志文件大小限制 (MB): [10] 
  保留的日志文件数量: [5] 

═══════════════════════════════════════════════
  步骤 5/5: 插件系统
═══════════════════════════════════════════════

配置插件系统和依赖管理。

插件目录: [plugins] 

自动加载插件？ [Y/n] y
启用插件热重载？ [Y/n] y

依赖管理:
  是否启用自动依赖管理？ [Y/n] y
  
  自动从 NuGet 下载依赖？ [Y/n] y
  
  版本冲突解决策略:
    [1] 使用最高版本
    [2] 使用最低版本
    [3] 严格匹配（冲突时报错）
  选择策略 [1-3] (默认: 1): 1

═══════════════════════════════════════════════
  配置完成
═══════════════════════════════════════════════

配置摘要:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
服务器进程:
  ✓ 启动方式: java
  ✓ 工作目录: ./minecraft_server
  ✓ Java: java
  ✓ JAR: server.jar
  ✓ 内存: 2048MB - 4096MB
  ✓ 自动重启: 是 (延迟 5 秒, 最多 3 次)

SMP 连接:
  ✓ 地址: localhost:40745
  ✓ TLS: 禁用
  ✓ 自动连接: 是

RCON:
  ✓ 状态: 启用
  ✓ 地址: localhost:25575
  ✓ 自动连接: 是

日志:
  ✓ 级别: Info
  ✓ 彩色输出: 启用
  ✓ 文件日志: 启用 (logs/latest.log)

插件:
  ✓ 目录: plugins
  ✓ 自动加载: 是
  ✓ 热重载: 是
  ✓ 依赖管理: 启用 (自动下载, 使用最高版本)

确认保存配置？ [Y/n] y

✓ 配置已保存到: nethergate-config.yaml

提示:
  • 你可以随时手动编辑 nethergate-config.yaml
  • 运行 'NetherGate.exe config validate' 来验证配置
  • 查看完整配置说明: docs/01-快速开始/配置文件详解.md

现在启动 NetherGate？ [Y/n] y

[NetherGate] 正在启动...
```

---

## 📝 **配置示例**

### **场景 1：标准 Vanilla 服务器**

适用于运行标准 Minecraft 服务器。

```
步骤 1 - 服务器进程:
  启动方式: [1] Java 直接启动
  工作目录: ./minecraft_server
  Java: java
  JAR: server.jar
  内存: 2048MB - 4096MB
  自动重启: 是

步骤 2 - SMP:
  地址: localhost
  端口: 40745
  TLS: 否
  自动连接: 是

步骤 3 - RCON:
  启用: 是
  地址: localhost
  端口: 25575
  密码: [设置强密码]
  自动连接: 是

步骤 4 - 日志:
  级别: Info
  彩色输出: 是
  文件日志: 是

步骤 5 - 插件:
  自动加载: 是
  热重载: 是
  依赖管理: 启用
```

---

### **场景 2：使用现有启动脚本**

适用于已有 Paper/Spigot 启动脚本的服务器。

```
步骤 1 - 服务器进程:
  启动方式: [2] 使用脚本启动
  脚本路径: ./start.sh  (Linux/macOS)
           或 ./start.bat  (Windows)
  工作目录: ./minecraft_server
  自动重启: 是

其他步骤与场景 1 相同
```

---

### **场景 3：连接到外部服务器**

适用于服务器由其他工具（如 systemd、Docker）管理的情况。

```
步骤 1 - 服务器进程:
  启动方式: [3] 连接到外部服务器
  工作目录: /path/to/minecraft/server  (用于文件访问)

步骤 2 - SMP:
  地址: localhost  (或远程地址)
  端口: 40745
  自动连接: 是

步骤 3 - RCON:
  启用: 是
  地址: localhost  (或远程地址)
  端口: 25575
  密码: [服务器的 RCON 密码]
  自动连接: 是

其他步骤与场景 1 相同
```

---

### **场景 4：多服务器环境**

为多个服务器实例创建不同的配置。

```bash
# 为每个服务器创建独立目录
mkdir -p nethergate-lobby
mkdir -p nethergate-survival
mkdir -p nethergate-creative

# 为每个实例运行配置向导
cd nethergate-lobby
NetherGate.exe --setup
# 配置: SMP 端口 40745, RCON 端口 25575

cd ../nethergate-survival
NetherGate.exe --setup
# 配置: SMP 端口 40746, RCON 端口 25576

cd ../nethergate-creative
NetherGate.exe --setup
# 配置: SMP 端口 40747, RCON 端口 25577
```

---

## ❓ **常见问题**

### **Q: 配置向导可以重新运行吗？**

可以。运行 `NetherGate.exe --setup` 会覆盖现有配置，但建议先备份：

```bash
# 备份现有配置
NetherGate.exe config export backup.yaml

# 重新运行配置向导
NetherGate.exe --setup
```

---

### **Q: 如何跳过某些配置步骤？**

配置向导的每个步骤都是必需的，但你可以：
1. 使用默认值（直接按回车）
2. 完成后手动编辑 `nethergate-config.yaml`

---

### **Q: 配置向导生成的配置文件在哪里？**

生成的配置文件为 `nethergate-config.yaml`，位于 NetherGate 可执行文件所在目录。

---

### **Q: 配置向导支持哪些格式？**

配置向导只生成 YAML 格式的配置文件。如果你需要 JSON 格式，可以手动编辑或使用转换工具。

---

### **Q: 如何在无交互环境使用？**

在无交互环境（如 Docker），你可以：

**方式 1：使用配置模板**
```bash
cp nethergate-config.template.yaml nethergate-config.yaml
# 编辑配置文件
vi nethergate-config.yaml
```

**方式 2：使用环境变量**（如果支持）
```bash
export NETHERGATE_SMP_PORT=40745
export NETHERGATE_RCON_PORT=25575
export NETHERGATE_RCON_PASSWORD=MyPassword
./NetherGate.exe
```

---

### **Q: 配置向导会检测现有配置吗？**

是的。如果检测到现有配置文件，配置向导会：
1. 提示是否覆盖
2. 提供备份选项
3. 显示当前配置摘要

---

### **Q: 如何验证生成的配置？**

```bash
# 验证配置文件
NetherGate.exe config validate

# 运行完整诊断
NetherGate.exe diagnose
```

---

## 📚 **相关文档**

- [配置文件详解](./配置文件详解.md) - 完整配置参数说明
- [命令行参数](../08-参考/命令行参数.md) - CLI 命令参考
- [安装和配置](./安装和配置.md) - 安装指南

---

**最后更新**: 2025-10-05  
**NetherGate 版本**: v0.1.0

