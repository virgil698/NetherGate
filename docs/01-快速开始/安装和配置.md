# 安装和配置

本指南将帮助你快速安装和配置 NetherGate，让你的 Minecraft 服务器管理框架在几分钟内运行起来。

---

## 📋 **目录**

- [系统要求](#系统要求)
- [安装 NetherGate](#安装-nethergate)
- [配置文件说明](#配置文件说明)
- [启动模式](#启动模式)
- [首次运行](#首次运行)
- [常见问题](#常见问题)

---

## 💻 **系统要求**

### **最低要求**

- **操作系统：**
  - Windows 10/11 (64-bit)
  - Linux (Ubuntu 20.04+, Debian 11+, CentOS 8+)
  - macOS 11+ (Big Sur or later)

- **.NET Runtime：**
  - .NET 9.0 或更高版本
  - 下载：https://dotnet.microsoft.com/download

- **Java Runtime：**（用于运行 Minecraft 服务器）
  - Java 21 或更高版本（推荐使用 OpenJDK）
  - 下载：https://adoptium.net/

- **内存：**
  - 最低 2GB RAM（NetherGate 框架本身占用约 100-200MB）
  - 推荐 4GB+ RAM（包括 Minecraft 服务器）

### **推荐配置**

- **CPU：** 4核心或以上
- **内存：** 8GB+ RAM
- **磁盘：** 10GB+ 可用空间（用于服务器文件、日志、备份）
- **网络：** 稳定的网络连接（用于 SMP/RCON 通信）

---

## 📦 **安装 NetherGate**

### **方式 1：从 Release 下载（推荐）**

1. **下载最新版本**

   访问 [GitHub Releases](https://github.com/your-org/NetherGate/releases) 下载适合你操作系统的版本：
   
   - `NetherGate-v1.0.0-win-x64.zip` - Windows 64-bit
   - `NetherGate-v1.0.0-linux-x64.tar.gz` - Linux 64-bit
   - `NetherGate-v1.0.0-osx-x64.tar.gz` - macOS Intel
   - `NetherGate-v1.0.0-osx-arm64.tar.gz` - macOS Apple Silicon

2. **解压到目标目录**

   **Windows:**
   ```batch
   # 解压到 C:\NetherGate
   cd C:\
   tar -xf NetherGate-v1.0.0-win-x64.zip
   ```

   **Linux/macOS:**
   ```bash
   # 解压到 /opt/nethergate
   sudo mkdir -p /opt/nethergate
   sudo tar -xzf NetherGate-v1.0.0-linux-x64.tar.gz -C /opt/nethergate
   sudo chown -R $USER:$USER /opt/nethergate
   ```

3. **目录结构**

   ```
   NetherGate/
   ├── NetherGate.Host.exe        # 主程序（Windows）
   ├── NetherGate.Host            # 主程序（Linux/macOS）
   ├── NetherGate.Core.dll
   ├── NetherGate.API.dll
   ├── lib/                       # 依赖库
   ├── config/                    # 配置目录（运行时创建）
   ├── plugins/                   # 插件目录（空）
   ├── logs/                      # 日志目录（空）
   ├── nethergate-config.yaml     # 主配置文件
   └── README.txt
   ```

### **方式 2：从源码构建**

1. **克隆仓库**

   ```bash
   git clone https://github.com/your-org/NetherGate.git
   cd NetherGate
   ```

2. **恢复依赖**

   ```bash
   dotnet restore
   ```

3. **构建项目**

   ```bash
   # 使用构建脚本
   cd scripts
   ./build.sh      # Linux/macOS
   build.bat       # Windows

   # 或手动构建
   dotnet build --configuration Release
   ```

4. **发布**

   ```bash
   cd scripts
   ./publish.sh    # Linux/macOS
   publish.bat     # Windows

   # 输出位置：bin/Release/
   ```

---

## ⚙️ **配置文件说明**

### **nethergate-config.yaml**

首次运行 NetherGate 会自动生成此配置文件。以下是完整的配置说明：

```yaml
# ==========================================
# NetherGate 配置文件
# ==========================================

# 服务器进程配置
server:
  # 启动方法：java, script, external
  launch_method: "java"
  
  # 工作目录（Minecraft 服务器所在目录）
  working_directory: "E:/Minecraft/Server"
  
  # Java 启动参数（launch_method=java 时使用）
  java_path: "java"
  java_args: "-Xmx4G -Xms2G"
  jar_file: "server.jar"
  
  # 脚本路径（launch_method=script 时使用）
  script_path: ""
  
  # 自动重启
  auto_restart: true
  restart_delay_seconds: 10

# RCON 配置
rcon:
  # 是否启用 RCON
  enabled: true
  host: "127.0.0.1"
  port: 25575
  password: "your_rcon_password"
  timeout_seconds: 5

# SMP (Server Management Protocol) 配置
smp:
  # 是否启用 SMP
  enabled: true
  
  # WebSocket 端口（需要与 SMP 插件配置一致）
  websocket_port: 25580
  
  # 认证密钥（需要与 SMP 插件配置一致）
  auth_key: "your_secret_key"
  
  # 重连设置
  reconnect_interval_seconds: 5
  max_reconnect_attempts: 10

# 插件配置
plugins:
  # 插件目录
  directory: "plugins"
  
  # 是否启用插件热重载
  enable_hot_reload: true
  
  # 自动加载插件
  auto_load: true

# 日志配置
logging:
  # 日志级别：Debug, Info, Warning, Error
  level: "Info"
  
  # 是否输出到控制台
  console_enabled: true
  
  # 是否输出到文件
  file_enabled: true
  file_path: "logs/latest.log"
  
  # 日志文件最大大小（MB）
  max_file_size_mb: 10
  
  # 保留的日志文件数量
  max_file_count: 5

# 性能监控配置
performance:
  # 是否启用性能监控
  enabled: true
  
  # 监控间隔（秒）
  monitor_interval_seconds: 60
  
  # 性能告警阈值
  thresholds:
    cpu_percent: 80
    memory_mb: 6144
    tps: 15

# 备份配置
backup:
  # 是否启用自动备份
  enabled: false
  
  # 备份目录
  directory: "backups"
  
  # 备份间隔（小时）
  interval_hours: 6
  
  # 保留的备份数量
  max_backups: 5
  
  # 压缩备份
  compress: true
```

### **配置说明**

#### **server 部分**

| 字段 | 说明 | 默认值 |
|------|------|--------|
| `launch_method` | 启动方法：`java`, `script`, `external` | `java` |
| `working_directory` | Minecraft 服务器工作目录 | - |
| `java_path` | Java 可执行文件路径 | `java` |
| `java_args` | JVM 参数 | `-Xmx4G -Xms2G` |
| `jar_file` | 服务器 JAR 文件名 | `server.jar` |
| `script_path` | 启动脚本路径（仅 `script` 模式） | - |
| `auto_restart` | 是否自动重启 | `true` |
| `restart_delay_seconds` | 重启延迟（秒） | `10` |

#### **rcon 部分**

| 字段 | 说明 | 默认值 |
|------|------|--------|
| `enabled` | 是否启用 RCON | `true` |
| `host` | RCON 主机地址 | `127.0.0.1` |
| `port` | RCON 端口 | `25575` |
| `password` | RCON 密码（需与 `server.properties` 一致） | - |
| `timeout_seconds` | 超时时间（秒） | `5` |

#### **smp 部分**

| 字段 | 说明 | 默认值 |
|------|------|--------|
| `enabled` | 是否启用 SMP | `true` |
| `websocket_port` | WebSocket 端口 | `25580` |
| `auth_key` | 认证密钥（需与 SMP 插件配置一致） | - |
| `reconnect_interval_seconds` | 重连间隔（秒） | `5` |
| `max_reconnect_attempts` | 最大重连次数 | `10` |

---

## 🚀 **启动模式**

NetherGate 支持三种服务器启动模式：

### **1. Java 模式（推荐）**

NetherGate 直接使用 Java 启动服务器 JAR 文件。

**配置：**
```yaml
server:
  launch_method: "java"
  working_directory: "E:/Minecraft/Server"
  java_path: "java"
  java_args: "-Xmx4G -Xms2G"
  jar_file: "server.jar"
```

**优点：**
- ✅ 简单直接
- ✅ 完全控制服务器进程
- ✅ 支持自动重启

**适用场景：** 大多数情况

### **2. Script 模式**

NetherGate 执行一个自定义启动脚本。

**配置：**
```yaml
server:
  launch_method: "script"
  working_directory: "E:/Minecraft/Server"
  script_path: "start.sh"  # 或 start.bat
```

**启动脚本示例 (`start.sh`)：**
```bash
#!/bin/bash
cd /opt/minecraft/server
java -Xmx4G -Xms2G -jar server.jar nogui
```

**优点：**
- ✅ 灵活性高
- ✅ 可以使用自定义启动逻辑

**适用场景：** 需要复杂启动逻辑（如多服务器、前置检查等）

### **3. External 模式**

服务器已经在外部运行，NetherGate 仅连接到已运行的服务器。

**配置：**
```yaml
server:
  launch_method: "external"
  working_directory: "E:/Minecraft/Server"  # 仍需指定工作目录

rcon:
  enabled: true
  host: "127.0.0.1"
  port: 25575
  password: "your_rcon_password"

smp:
  enabled: true
  websocket_port: 25580
  auth_key: "your_secret_key"
```

**优点：**
- ✅ 不干扰现有服务器管理方式
- ✅ 可以在服务器运行时连接/断开

**适用场景：**
- 服务器由其他工具（如 systemd、Docker）管理
- 多个管理工具共存
- 生产环境中的非侵入式监控

---

## 🎬 **首次运行**

### **1. 准备 Minecraft 服务器**

确保你有一个可运行的 Minecraft 服务器：

```
Minecraft-Server/
├── server.jar
├── server.properties
├── eula.txt
├── world/
└── plugins/ (如果是 Bukkit/Spigot/Paper)
```

**配置 `server.properties`：**

```properties
# 启用 RCON
enable-rcon=true
rcon.port=25575
rcon.password=your_rcon_password
```

### **2. 配置 NetherGate**

编辑 `nethergate-config.yaml`：

```yaml
server:
  launch_method: "java"
  working_directory: "E:/Minecraft/Server"  # 修改为你的服务器目录
  java_path: "java"
  java_args: "-Xmx4G -Xms2G"
  jar_file: "server.jar"

rcon:
  enabled: true
  password: "your_rcon_password"  # 与 server.properties 一致

smp:
  enabled: true
  auth_key: "your_secret_key_123"  # 自定义密钥
```

### **3. 安装 SMP 插件（可选但推荐）**

如果你的服务器是 Bukkit/Spigot/Paper，需要安装 SMP 插件以获得完整功能。

1. 下载 SMP 插件：`NetherGate-SMP-Plugin.jar`
2. 放入服务器的 `plugins/` 目录
3. 配置 `plugins/NetherGate-SMP/config.yml`：

   ```yaml
   websocket:
     port: 25580
     auth_key: "your_secret_key_123"  # 与 nethergate-config.yaml 一致
   ```

### **4. 启动 NetherGate**

**Windows:**
```batch
cd C:\NetherGate
NetherGate.Host.exe
```

**Linux/macOS:**
```bash
cd /opt/nethergate
./NetherGate.Host
```

### **5. 验证运行**

```
[2025-10-05 14:30:00 INFO]: NetherGate 正在启动...
[2025-10-05 14:30:01 INFO]: 配置已加载
[2025-10-05 14:30:01 INFO]: 正在加载插件...
[2025-10-05 14:30:02 INFO]: 正在启动 Minecraft 服务器...
[2025-10-05 14:30:10 INFO]: 服务器启动完成，耗时 8.123 秒
[2025-10-05 14:30:10 INFO]: RCON 连接成功
[2025-10-05 14:30:11 INFO]: SMP 连接成功
[2025-10-05 14:30:11 INFO]: NetherGate 已就绪
```

### **6. 测试功能**

```bash
# 在 NetherGate 控制台
help                  # 查看可用命令
plugin list           # 列出已加载的插件
list                  # 列出在线玩家

# 停止服务器
stop
```

---

## ❓ **常见问题**

### **Q: 提示 ".NET 9.0 Runtime not found"？**

**A:** 安装 .NET 9.0 Runtime：
```bash
# 下载并安装
https://dotnet.microsoft.com/download/dotnet/9.0

# 验证
dotnet --version
```

### **Q: RCON 连接失败？**

**A:** 检查：
1. `server.properties` 中 `enable-rcon=true`
2. RCON 密码是否一致
3. 端口是否被占用：`netstat -an | grep 25575`
4. 防火墙是否阻止

### **Q: SMP 连接失败？**

**A:** 检查：
1. SMP 插件是否已安装
2. `auth_key` 是否一致
3. WebSocket 端口是否被占用
4. 查看 Minecraft 服务器日志

### **Q: 服务器无法启动？**

**A:** 检查：
1. `working_directory` 路径是否正确
2. `jar_file` 文件名是否正确
3. Java 是否已安装：`java -version`
4. 内存是否足够

### **Q: 插件加载失败？**

**A:** 检查：
1. 插件是否在 `plugins/` 目录
2. `plugin.json` 是否存在且正确
3. 查看日志中的详细错误信息

### **Q: 如何停止 NetherGate？**

**A:**
```bash
# 在控制台输入
stop

# 或使用 Ctrl+C（会等待服务器正常关闭）
```

---

## 📚 **下一步**

- [第一个插件](./第一个插件.md) - 开发你的第一个插件
- [配置文件详解](../05-配置和部署/配置文件详解.md) - 深入了解配置选项
- [命令系统](../02-核心功能/命令系统.md) - 了解命令系统

---

**文档维护者：** NetherGate 开发团队  
**最后更新：** 2025-10-05