# æ¸¸æˆå·¥å…· API

NetherGate æä¾›äº†å¼ºå¤§çš„æ¸¸æˆå·¥å…· APIï¼Œç®€åŒ–å¸¸è§çš„æ¸¸æˆæ“ä½œã€‚è¯¥åŠŸèƒ½å— [MinecraftConnection](https://github.com/takunology/MinecraftConnection) å¯å‘ã€‚

---

## ğŸ“‹ **ç›®å½•**

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [çƒŸèŠ±ç³»ç»Ÿ](#çƒŸèŠ±ç³»ç»Ÿ)
- [éŸ³ä¹æ’­æ”¾å™¨](#éŸ³ä¹æ’­æ”¾å™¨)
- [æ—¶é—´ä¸å¤©æ°”](#æ—¶é—´ä¸å¤©æ°”)
- [åŒºåŸŸæ“ä½œ](#åŒºåŸŸæ“ä½œ)
- [å‘½ä»¤åºåˆ—](#å‘½ä»¤åºåˆ—)
- [å®æˆ˜ç¤ºä¾‹](#å®æˆ˜ç¤ºä¾‹)

---

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **è·å–æ¸¸æˆå·¥å…·å®ä¾‹**

```csharp
public class MyPlugin : IPlugin
{
    private IGameUtilities _gameUtils;
    
    public void OnEnable(IPluginContext context)
    {
        _gameUtils = context.GameUtilities;
    }
}
```

---

## ğŸ† **çƒŸèŠ±ç³»ç»Ÿ**

### **åŸºæœ¬ç”¨æ³•**

```csharp
// åœ¨æŒ‡å®šä½ç½®å‘å°„çƒŸèŠ±
await _gameUtils.LaunchFireworkAsync(
    position: new Position(100, 70, 200),
    type: FireworkType.Star,
    colors: new[] { FireworkColor.Red, FireworkColor.Gold },
    fadeColors: new[] { FireworkColor.White }
);
```

### **çƒŸèŠ±ç±»å‹**

```csharp
public enum FireworkType
{
    SmallBall,      // å°çƒ
    LargeBall,      // å¤§çƒ
    Star,           // æ˜Ÿå½¢
    Creeper,        // è‹¦åŠ›æ€•å½¢çŠ¶
    Burst           // çˆ†è£‚
}
```

### **çƒŸèŠ±é¢œè‰²**

```csharp
public enum FireworkColor
{
    Black,      // é»‘è‰²
    Red,        // çº¢è‰²
    Green,      // ç»¿è‰²
    Brown,      // æ£•è‰²
    Blue,       // è“è‰²
    Purple,     // ç´«è‰²
    Cyan,       // é’è‰²
    LightGray,  // æµ…ç°
    Gray,       // ç°è‰²
    Pink,       // ç²‰è‰²
    Lime,       // é»„ç»¿
    Yellow,     // é»„è‰²
    LightBlue,  // æµ…è“
    Magenta,    // å“çº¢
    Orange,     // æ©™è‰²
    White       // ç™½è‰²
}
```

### **é«˜çº§çƒŸèŠ±**

```csharp
// åˆ›å»ºè‡ªå®šä¹‰çƒŸèŠ±æ„å»ºå™¨
var firework = _gameUtils.CreateFirework()
    .SetType(FireworkType.Star)
    .AddColor(FireworkColor.Red)
    .AddColor(FireworkColor.Gold)
    .AddFadeColor(FireworkColor.White)
    .SetFlicker(true)          // é—ªçƒ
    .SetTrail(true)            // å°¾è¿¹
    .SetFlightDuration(2)      // é£è¡Œæ—¶é—´
    .BuildAsync();

await _gameUtils.LaunchFireworkAsync(position, firework);
```

### **çƒŸèŠ±åºåˆ—**

```csharp
// è¿ç»­å‘å°„çƒŸèŠ±
public async Task FireworkShowAsync(Position center)
{
    var colors = new[] 
    { 
        FireworkColor.Red, 
        FireworkColor.Green, 
        FireworkColor.Blue 
    };
    
    for (int i = 0; i < 10; i++)
    {
        var offset = new Position(
            center.X + Random.Next(-5, 5),
            center.Y,
            center.Z + Random.Next(-5, 5)
        );
        
        await _gameUtils.LaunchFireworkAsync(
            offset,
            FireworkType.LargeBall,
            new[] { colors[i % colors.Length] }
        );
        
        await Task.Delay(500);  // é—´éš” 0.5 ç§’
    }
}
```

---

## ğŸµ **éŸ³ä¹æ’­æ”¾å™¨**

### **åŸºæœ¬éŸ³ç¬¦**

```csharp
// æ’­æ”¾å•ä¸ªéŸ³ç¬¦
await _musicPlayer.PlayNoteAsync(
    player: "@a",           // ç›®æ ‡ç©å®¶
    note: Note.C,           // C è°ƒ
    duration: 200           // æŒç»­ 200ms
);
```

### **éŸ³ç¬¦æšä¸¾**

```csharp
public enum Note
{
    C, D, E, F, G, A, B,           // è‡ªç„¶éŸ³
    CSharp, DSharp, FSharp,        // å‡åŠéŸ³
    GSharp, ASharp
}
```

### **åˆ›å»ºæ—‹å¾‹**

```csharp
// ä½¿ç”¨æ—‹å¾‹æ„å»ºå™¨
await _musicPlayer.CreateMelody()
    .AddNote(Note.C, 200)
    .AddNote(Note.D, 200)
    .AddNote(Note.E, 200)
    .AddNote(Note.C, 400)
    .AddPause(100)           // æš‚åœ 100ms
    .AddNote(Note.E, 200)
    .AddNote(Note.F, 200)
    .AddNote(Note.G, 600)
    .PlayAsync("@a");
```

### **é¢„è®¾æ—‹å¾‹**

```csharp
// æ’­æ”¾æ¬¢è¿éŸ³ä¹
await _musicPlayer.PlayWelcomeMelodyAsync("Steve");

// æ’­æ”¾å‘Šåˆ«éŸ³ä¹
await _musicPlayer.PlayGoodbyeMelodyAsync("Steve");

// æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
await _musicPlayer.PlaySuccessSoundAsync("@a");

// æ’­æ”¾å¤±è´¥éŸ³æ•ˆ
await _musicPlayer.PlayFailureSoundAsync("@a");

// æ’­æ”¾è­¦å‘ŠéŸ³æ•ˆ
await _musicPlayer.PlayWarningSoundAsync("@a");
```

### **è‡ªå®šä¹‰æ­Œæ›²**

```csharp
public class SongPlayer
{
    public async Task PlayTwinkleStarAsync(string player)
    {
        var melody = _musicPlayer.CreateMelody()
            // ä¸€é—ªä¸€é—ªäº®æ™¶æ™¶
            .AddNote(Note.C, 300).AddNote(Note.C, 300)
            .AddNote(Note.G, 300).AddNote(Note.G, 300)
            .AddNote(Note.A, 300).AddNote(Note.A, 300)
            .AddNote(Note.G, 600)
            .AddPause(100)
            .AddNote(Note.F, 300).AddNote(Note.F, 300)
            .AddNote(Note.E, 300).AddNote(Note.E, 300)
            .AddNote(Note.D, 300).AddNote(Note.D, 300)
            .AddNote(Note.C, 600);
        
        await melody.PlayAsync(player);
    }
}
```

---

## â° **æ—¶é—´ä¸å¤©æ°”**

### **æ—¶é—´æ§åˆ¶**

```csharp
// è®¾ç½®ä¸ºç™½å¤©
await _gameUtils.SetTimeAsync(TimeOfDay.Day);

// è®¾ç½®ä¸ºå¤œæ™š
await _gameUtils.SetTimeAsync(TimeOfDay.Night);

// è®¾ç½®ä¸ºä¸­åˆ
await _gameUtils.SetTimeAsync(TimeOfDay.Noon);

// è®¾ç½®ä¸ºåˆå¤œ
await _gameUtils.SetTimeAsync(TimeOfDay.Midnight);

// è‡ªå®šä¹‰æ—¶é—´ï¼ˆtickï¼Œ0-24000ï¼‰
await _gameUtils.SetTimeAsync(6000);  // ä¸­åˆ
```

### **å¤©æ°”æ§åˆ¶**

```csharp
// æ™´å¤©
await _gameUtils.SetWeatherAsync(Weather.Clear);

// ä¸‹é›¨
await _gameUtils.SetWeatherAsync(Weather.Rain);

// é›·æš´
await _gameUtils.SetWeatherAsync(Weather.Thunder);

// è®¾ç½®å¤©æ°”æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
await _gameUtils.SetWeatherAsync(Weather.Rain, duration: 300);  // ä¸‹é›¨ 5 åˆ†é’Ÿ
```

---

## ğŸ—ï¸ **åŒºåŸŸæ“ä½œ**

### **å¡«å……æ–¹å—**

```csharp
// å¡«å……åŒºåŸŸ
await _gameUtils.FillBlockAsync(
    from: new Position(0, 64, 0),
    to: new Position(10, 74, 10),
    blockId: "minecraft:stone"
);

// æ›¿æ¢æ–¹å—
await _gameUtils.ReplaceBlockAsync(
    from: new Position(0, 64, 0),
    to: new Position(10, 74, 10),
    oldBlockId: "minecraft:dirt",
    newBlockId: "minecraft:grass_block"
);

// æ¸…ç©ºåŒºåŸŸï¼ˆæ›¿æ¢ä¸ºç©ºæ°”ï¼‰
await _gameUtils.ClearAreaAsync(
    from: new Position(0, 64, 0),
    to: new Position(10, 74, 10)
);
```

### **å…‹éš†åŒºåŸŸ**

```csharp
// å…‹éš†åŒºåŸŸ
await _gameUtils.CloneAreaAsync(
    from: new Position(0, 64, 0),
    to: new Position(10, 74, 10),
    destination: new Position(100, 64, 100)
);
```

### **ç”Ÿæˆç»“æ„**

```csharp
// ç”Ÿæˆçƒä½“
await _gameUtils.GenerateSphereAsync(
    center: new Position(100, 70, 200),
    radius: 5,
    blockId: "minecraft:glass"
);

// ç”Ÿæˆç«‹æ–¹ä½“
await _gameUtils.GenerateCubeAsync(
    center: new Position(100, 70, 200),
    size: 10,
    blockId: "minecraft:stone"
);

// ç”Ÿæˆç©ºå¿ƒçƒä½“
await _gameUtils.GenerateHollowSphereAsync(
    center: new Position(100, 70, 200),
    radius: 8,
    blockId: "minecraft:glass"
);
```

---

## ğŸ”„ **å‘½ä»¤åºåˆ—**

å‘½ä»¤åºåˆ—å…è®¸ä½ æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œå¹¶åœ¨å‘½ä»¤ä¹‹é—´æ·»åŠ å»¶è¿Ÿã€‚

### **åŸºæœ¬ç”¨æ³•**

```csharp
// åˆ›å»ºå‘½ä»¤åºåˆ—
await _gameUtils.CreateSequence()
    .Execute(() => _gameDisplay.BroadcastMessage("å€’è®¡æ—¶å¼€å§‹ï¼"))
    .WaitTicks(20)  // ç­‰å¾… 1 ç§’
    .Execute(() => _gameDisplay.BroadcastMessage("3..."))
    .WaitTicks(20)
    .Execute(() => _gameDisplay.BroadcastMessage("2..."))
    .WaitTicks(20)
    .Execute(() => _gameDisplay.BroadcastMessage("1..."))
    .WaitTicks(20)
    .Execute(() => _gameDisplay.BroadcastMessage("GO!"))
    .RunAsync();
```

### **æ”¯æŒå¼‚æ­¥æ“ä½œ**

```csharp
await _gameUtils.CreateSequence()
    .Execute(async () => 
    {
        await _gameDisplay.BroadcastMessageAsync("å‡†å¤‡çˆ†ç‚¸...");
    })
    .WaitSeconds(3)
    .Execute(async () => 
    {
        await _rconClient.ExecuteCommandAsync("summon minecraft:tnt ~ ~ ~");
    })
    .WaitSeconds(1)
    .Execute(async () => 
    {
        await _gameDisplay.BroadcastMessageAsync("BOOM!");
    })
    .RunAsync();
```

### **æ¡ä»¶æ‰§è¡Œ**

```csharp
await _gameUtils.CreateSequence()
    .Execute(() => StartEvent())
    .WaitSeconds(5)
    .ExecuteIf(
        condition: () => IsPlayerOnline("Steve"),
        action: () => NotifyPlayer("Steve")
    )
    .WaitSeconds(5)
    .Execute(() => EndEvent())
    .RunAsync();
```

---

## ğŸ’¼ **å®æˆ˜ç¤ºä¾‹**

### **ç¤ºä¾‹1ï¼šåº†ç¥ç³»ç»Ÿ**

```csharp
public class CelebrationManager
{
    public async Task CelebrateVictoryAsync(string playerName, Position pos)
    {
        // æ’­æ”¾éŸ³ä¹
        await _musicPlayer.CreateMelody()
            .AddNote(Note.C, 100)
            .AddNote(Note.E, 100)
            .AddNote(Note.G, 200)
            .AddNote(Note.C, 400)
            .PlayAsync(playerName);
        
        // å‘å°„çƒŸèŠ±ç§€
        for (int i = 0; i < 5; i++)
        {
            var offset = pos.Offset(
                Random.Next(-3, 3), 
                i * 2, 
                Random.Next(-3, 3)
            );
            
            await _gameUtils.LaunchFireworkAsync(
                offset,
                FireworkType.Star,
                new[] { FireworkColor.Gold, FireworkColor.Yellow }
            );
            
            await Task.Delay(500);
        }
        
        // æ¶ˆæ¯é€šçŸ¥
        await _gameDisplay.SendTitleAsync(
            playerName,
            "Â§6Â§lèƒœåˆ©ï¼",
            "Â§eæ­å–œè·èƒœ",
            fadeIn: 10,
            stay: 70,
            fadeOut: 20
        );
    }
}
```

### **ç¤ºä¾‹2ï¼šè‡ªåŠ¨å»ºç­‘**

```csharp
public class BuildingCommand : ICommand
{
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var pos = await GetPlayerPositionAsync(sender.Name);
        
        // å»ºé€ ä¸€ä¸ªç»ç’ƒåœ†é¡¶
        await _gameUtils.CreateSequence()
            .Execute(async () => 
            {
                await _gameDisplay.SendMessageAsync(sender.Name, "Â§aå¼€å§‹å»ºé€ ...");
            })
            .WaitSeconds(1)
            .Execute(async () => 
            {
                // åº•åº§
                await _gameUtils.FillBlockAsync(
                    pos.Down(1),
                    pos.Down(1).Offset(10, 0, 10),
                    "minecraft:stone"
                );
            })
            .WaitSeconds(2)
            .Execute(async () => 
            {
                // ç»ç’ƒåœ†é¡¶
                await _gameUtils.GenerateHollowSphereAsync(
                    pos.Offset(5, 5, 5),
                    radius: 8,
                    blockId: "minecraft:glass"
                );
            })
            .WaitSeconds(2)
            .Execute(async () => 
            {
                await _gameDisplay.SendMessageAsync(sender.Name, "Â§aå»ºé€ å®Œæˆï¼");
                await _musicPlayer.PlaySuccessSoundAsync(sender.Name);
            })
            .RunAsync();
        
        return CommandResult.Ok("å»ºç­‘ä»»åŠ¡å·²å¯åŠ¨");
    }
}
```

### **ç¤ºä¾‹3ï¼šPvP ç«æŠ€åœº**

```csharp
public class ArenaManager
{
    public async Task StartPvpMatchAsync(List<string> players)
    {
        var arenaCenter = new Position(0, 100, 0);
        
        await _gameUtils.CreateSequence()
            // å€’è®¡æ—¶
            .Execute(() => _gameDisplay.BroadcastMessage("Â§6PvP ç«èµ›å³å°†å¼€å§‹ï¼"))
            .WaitSeconds(3)
            .Execute(() => _musicPlayer.PlayWarningSoundAsync("@a"))
            .WaitSeconds(1)
            .Execute(() => _gameDisplay.BroadcastMessage("Â§c3..."))
            .WaitSeconds(1)
            .Execute(() => _gameDisplay.BroadcastMessage("Â§c2..."))
            .WaitSeconds(1)
            .Execute(() => _gameDisplay.BroadcastMessage("Â§c1..."))
            .WaitSeconds(1)
            
            // å¼€å§‹
            .Execute(async () => 
            {
                await _gameDisplay.BroadcastMessageAsync("Â§aÂ§lå¼€å§‹ï¼");
                await _musicPlayer.PlaySuccessSoundAsync("@a");
                
                // å‘å°„åº†ç¥çƒŸèŠ±
                await _gameUtils.LaunchFireworkAsync(
                    arenaCenter.Up(20),
                    FireworkType.Burst,
                    new[] { FireworkColor.Red, FireworkColor.Gold }
                );
            })
            .RunAsync();
    }
}
```

### **ç¤ºä¾‹4ï¼šå®šæ—¶é‡ç½®çŸ¿åŒº**

```csharp
public class MiningAreaPlugin : IPlugin
{
    private readonly Position _mineStart = new(1000, 50, 1000);
    private readonly Position _mineEnd = new(1100, 100, 1100);
    
    public void OnEnable(IPluginContext context)
    {
        // æ¯ 6 å°æ—¶é‡ç½®çŸ¿åŒº
        context.Scheduler.ScheduleRepeating(async () =>
        {
            await ResetMiningAreaAsync();
        }, TimeSpan.FromHours(6));
    }
    
    private async Task ResetMiningAreaAsync()
    {
        await _gameDisplay.BroadcastMessageAsync("Â§cçŸ¿åŒºå°†åœ¨ 1 åˆ†é’Ÿåé‡ç½®ï¼");
        await _musicPlayer.PlayWarningSoundAsync("@a");
        
        await Task.Delay(TimeSpan.FromSeconds(60));
        
        // é‡æ–°ç”ŸæˆçŸ¿çŸ³
        await _gameUtils.CreateSequence()
            .Execute(async () => 
            {
                // æ¸…ç©ºåŒºåŸŸ
                await _gameUtils.ClearAreaAsync(_mineStart, _mineEnd);
            })
            .WaitSeconds(2)
            .Execute(async () => 
            {
                // å¡«å……çŸ³å¤´
                await _gameUtils.FillBlockAsync(
                    _mineStart, 
                    _mineEnd, 
                    "minecraft:stone"
                );
            })
            .WaitSeconds(2)
            .Execute(async () => 
            {
                // éšæœºç”ŸæˆçŸ¿çŸ³
                await GenerateRandomOresAsync(_mineStart, _mineEnd);
            })
            .WaitSeconds(1)
            .Execute(async () => 
            {
                await _gameDisplay.BroadcastMessageAsync("Â§açŸ¿åŒºé‡ç½®å®Œæˆï¼");
                await _musicPlayer.PlaySuccessSoundAsync("@a");
            })
            .RunAsync();
    }
}
```

---

## ğŸ’¡ **æœ€ä½³å®è·µ**

### **1. å¼‚æ­¥æ“ä½œ**

âœ… **æ¨èï¼š** ä½¿ç”¨ async/await
```csharp
await _gameUtils.LaunchFireworkAsync(...);
await _musicPlayer.PlayNoteAsync(...);
```

### **2. é”™è¯¯å¤„ç†**

âœ… **æ¨èï¼š** æ•è·å¼‚å¸¸
```csharp
try
{
    await _gameUtils.FillBlockAsync(from, to, blockId);
}
catch (Exception ex)
{
    _logger.Error("åŒºåŸŸå¡«å……å¤±è´¥", ex);
}
```

### **3. æ€§èƒ½è€ƒè™‘**

âœ… **æ¨èï¼š** å¤§è§„æ¨¡æ“ä½œåˆ†æ‰¹æ‰§è¡Œ
```csharp
// åˆ†æ‰¹å¡«å……å¤§åŒºåŸŸ
var chunks = DivideIntoChunks(largeArea, chunkSize: 16);
foreach (var chunk in chunks)
{
    await _gameUtils.FillBlockAsync(chunk.Start, chunk.End, blockId);
    await Task.Delay(50);  // é¿å…æœåŠ¡å™¨å¡é¡¿
}
```

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [è°ƒåº¦å™¨ç³»ç»Ÿ](./è°ƒåº¦å™¨ç³»ç»Ÿ.md)
- [æ‰©å±•æ–¹æ³•](./æ‰©å±•æ–¹æ³•.md)
- [æ¸¸æˆæ˜¾ç¤ºAPI](./æ¸¸æˆæ˜¾ç¤ºAPI.md)

---

## ğŸ™ **è‡´è°¢**

æ¸¸æˆå·¥å…· API çš„è®¾è®¡å— [MinecraftConnection](https://github.com/takunology/MinecraftConnection) å¯å‘ã€‚

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** NetherGate å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°ï¼š** 2025-01-08  
**å‚è€ƒé¡¹ç›®ï¼š** [MinecraftConnection](https://github.com/takunology/MinecraftConnection) (MIT)  
**è®¸å¯è¯ï¼š** LGPL-3.0

