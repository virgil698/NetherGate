# 国际化 (i18n)

NetherGate 提供了完整的国际化支持，让你的插件可以轻松支持多语言。该功能受 [MCDReforged](https://github.com/Fallen-Breath/MCDReforged) 国际化系统启发。

---

## 📋 **目录**

- [快速开始](#快速开始)
- [语言文件](#语言文件)
- [API 使用](#api-使用)
- [高级功能](#高级功能)
- [最佳实践](#最佳实践)

---

## 🚀 **快速开始**

### **1. 创建语言文件**

在插件的 `lang` 目录下创建语言文件：

```
MyPlugin/
├── MyPlugin.dll
└── lang/
    ├── zh_CN.json    # 简体中文
    ├── en_US.json    # 英语
    └── ja_JP.json    # 日语
```

### **2. 定义翻译**

**zh_CN.json:**
```json
{
  "commands.welcome": "欢迎 {0}！",
  "commands.goodbye": "再见 {0}！",
  "messages.server_starting": "服务器正在启动...",
  "messages.player_joined": "§a玩家 {0} 加入了服务器",
  "errors.player_not_found": "§c玩家 {0} 不存在"
}
```

**en_US.json:**
```json
{
  "commands.welcome": "Welcome {0}!",
  "commands.goodbye": "Goodbye {0}!",
  "messages.server_starting": "Server is starting...",
  "messages.player_joined": "§aPlayer {0} joined the server",
  "errors.player_not_found": "§cPlayer {0} not found"
}
```

### **3. 使用翻译**

```csharp
public class MyPlugin : IPlugin
{
    private II18nService _i18n;
    
    public void OnEnable(IPluginContext context)
    {
        _i18n = context.I18nService;
        
        // 使用翻译
        var message = _i18n.Translate("commands.welcome", "Steve");
        // zh_CN: "欢迎 Steve！"
        // en_US: "Welcome Steve!"
        
        context.Logger.Info(message);
    }
}
```

---

## 📖 **语言文件**

### **支持的语言代码**

| 语言 | 代码 | 文件名 |
|------|------|--------|
| 简体中文 | zh_CN | `zh_CN.json` |
| 繁体中文 | zh_TW | `zh_TW.json` |
| 英语 (美国) | en_US | `en_US.json` |
| 英语 (英国) | en_GB | `en_GB.json` |
| 日语 | ja_JP | `ja_JP.json` |
| 韩语 | ko_KR | `ko_KR.json` |
| 德语 | de_DE | `de_DE.json` |
| 法语 | fr_FR | `fr_FR.json` |
| 西班牙语 | es_ES | `es_ES.json` |
| 俄语 | ru_RU | `ru_RU.json` |

### **翻译键命名规范**

✅ **推荐的命名方式：**
```json
{
  "commands.help": "帮助信息",
  "commands.reload.success": "重载成功",
  "commands.reload.failed": "重载失败",
  
  "messages.welcome": "欢迎消息",
  "messages.goodbye": "告别消息",
  
  "errors.not_found": "未找到",
  "errors.permission_denied": "权限不足",
  
  "ui.button.confirm": "确认",
  "ui.button.cancel": "取消"
}
```

### **参数占位符**

```json
{
  "simple": "欢迎 {0}！",
  "multiple": "玩家 {0} 给了 {1} 个 {2}",
  "named": "坐标: X={x}, Y={y}, Z={z}"
}
```

```csharp
// 使用索引占位符
_i18n.Translate("simple", "Steve");
// 输出: "欢迎 Steve！"

_i18n.Translate("multiple", "Steve", "10", "钻石");
// 输出: "玩家 Steve 给了 10 个 钻石"
```

---

## 💻 **API 使用**

### **II18nService 接口**

```csharp
public interface II18nService
{
    /// <summary>
    /// 翻译文本
    /// </summary>
    string Translate(string key, params object[] args);
    
    /// <summary>
    /// 尝试翻译（不存在则返回键名）
    /// </summary>
    string TryTranslate(string key, params object[] args);
    
    /// <summary>
    /// 检查翻译是否存在
    /// </summary>
    bool HasTranslation(string key);
    
    /// <summary>
    /// 获取当前语言
    /// </summary>
    string CurrentLanguage { get; }
    
    /// <summary>
    /// 切换语言
    /// </summary>
    void SetLanguage(string language);
}
```

### **基本使用**

```csharp
// 简单翻译
var msg = _i18n.Translate("messages.welcome");

// 带参数
var msg = _i18n.Translate("messages.player_joined", playerName);

// 检查是否存在
if (_i18n.HasTranslation("advanced.feature"))
{
    var msg = _i18n.Translate("advanced.feature");
}

// 切换语言
_i18n.SetLanguage("en_US");
```

---

## 📝 **使用示例**

### **1. 多语言命令**

```csharp
public class WelcomeCommand : ICommand
{
    private readonly II18nService _i18n;
    private readonly IGameDisplayApi _gameDisplay;
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var playerName = args.Length > 0 ? args[0] : sender.Name;
        
        // 自动根据配置的语言翻译
        var message = _i18n.Translate("commands.welcome.message", playerName);
        var tip = _i18n.Translate("commands.welcome.tip");
        
        await _gameDisplay.SendChatMessageAsync(
            sender.Name,
            $"{message}\n{tip}"
        );
        
        return CommandResult.Ok(_i18n.Translate("commands.welcome.sent"));
    }
}
```

**语言文件：**
```json
{
  "commands.welcome.message": "§a欢迎 {0} 加入服务器！",
  "commands.welcome.tip": "§7输入 #help 查看帮助",
  "commands.welcome.sent": "欢迎消息已发送"
}
```

### **2. 动态语言切换**

```csharp
public class LanguageCommand : ICommand
{
    private readonly II18nService _i18n;
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        if (args.Length == 0)
        {
            var current = _i18n.CurrentLanguage;
            return CommandResult.Ok($"当前语言: {current}");
        }
        
        var newLang = args[0];
        _i18n.SetLanguage(newLang);
        
        // 切换后的消息会用新语言显示
        var message = _i18n.Translate("commands.language.changed", newLang);
        return CommandResult.Ok(message);
    }
}
```

### **3. 多语言帮助系统**

```csharp
public class HelpCommand : ICommand
{
    private readonly II18nService _i18n;
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var help = new StringBuilder();
        help.AppendLine(_i18n.Translate("help.title"));
        help.AppendLine();
        
        // 命令列表
        help.AppendLine(_i18n.Translate("help.commands"));
        help.AppendLine($"  #spawn - {_i18n.Translate("help.spawn")}");
        help.AppendLine($"  #home - {_i18n.Translate("help.home")}");
        help.AppendLine($"  #tpa - {_i18n.Translate("help.tpa")}");
        
        sender.SendMessage(help.ToString());
        return CommandResult.Ok();
    }
}
```

**zh_CN.json:**
```json
{
  "help.title": "§6=== 命令帮助 ===",
  "help.commands": "§e可用命令:",
  "help.spawn": "传送到出生点",
  "help.home": "传送到家",
  "help.tpa": "请求传送到玩家"
}
```

**en_US.json:**
```json
{
  "help.title": "§6=== Command Help ===",
  "help.commands": "§eAvailable Commands:",
  "help.spawn": "Teleport to spawn",
  "help.home": "Teleport to home",
  "help.tpa": "Request teleport to player"
}
```

### **4. 错误消息国际化**

```csharp
public class TeleportCommand : ICommand
{
    private readonly II18nService _i18n;
    private readonly ISmpApi _smpApi;
    
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        if (args.Length == 0)
        {
            return CommandResult.Fail(_i18n.Translate("errors.missing_player"));
        }
        
        var targetPlayer = args[0];
        var players = await _smpApi.GetPlayersAsync();
        
        if (!players.Any(p => p.Name == targetPlayer))
        {
            return CommandResult.Fail(
                _i18n.Translate("errors.player_not_found", targetPlayer)
            );
        }
        
        // 执行传送...
        return CommandResult.Ok(
            _i18n.Translate("commands.teleport.success", targetPlayer)
        );
    }
}
```

---

## 🔧 **高级功能**

### **1. 回退机制**

如果当前语言缺少某个键，系统会自动回退到默认语言（通常是 `en_US`）：

```csharp
// 当前语言: ja_JP
// ja_JP.json 中没有 "advanced.feature" 键
// 系统会自动使用 en_US.json 中的值
var msg = _i18n.Translate("advanced.feature");
```

### **2. 嵌套键**

```json
{
  "game": {
    "modes": {
      "survival": "生存模式",
      "creative": "创造模式",
      "adventure": "冒险模式"
    }
  }
}
```

```csharp
var mode = _i18n.Translate("game.modes.survival");
```

### **3. 复数形式处理**

```json
{
  "items.count.zero": "没有物品",
  "items.count.one": "1 个物品",
  "items.count.other": "{0} 个物品"
}
```

```csharp
public string GetItemCountMessage(int count)
{
    var key = count == 0 ? "items.count.zero" :
              count == 1 ? "items.count.one" :
                          "items.count.other";
    
    return _i18n.Translate(key, count);
}
```

---

## 💡 **最佳实践**

### **1. 统一的键命名**

✅ **推荐：** 使用层级结构
```json
{
  "plugin.myfeature.title": "标题",
  "plugin.myfeature.description": "描述",
  "plugin.myfeature.button.confirm": "确认",
  "plugin.myfeature.button.cancel": "取消"
}
```

### **2. 完整的语言覆盖**

✅ **推荐：** 确保所有语言文件都有相同的键
```bash
# 使用工具检查缺失的键
diff zh_CN.json en_US.json
```

### **3. 参数化消息**

✅ **推荐：** 使用参数而不是字符串拼接
```json
{
  "good": "玩家 {0} 获得了 {1} 个 {2}",
  "bad": "玩家获得了物品"
}
```

### **4. 保持翻译文件整洁**

✅ **推荐：** 添加注释（如果格式支持）
```json
{
  "_comment": "命令相关翻译",
  "commands.help": "帮助",
  "commands.reload": "重载",
  
  "_comment": "错误消息",
  "errors.not_found": "未找到",
  "errors.permission_denied": "权限不足"
}
```

---

## 📚 **相关文档**

- [命令系统](../02-核心功能/命令系统.md)
- [插件开发指南](../03-插件开发/插件开发指南.md)

---

## 🙏 **致谢**

国际化系统的设计受 [MCDReforged](https://github.com/Fallen-Breath/MCDReforged) 启发。

---

**文档维护者：** NetherGate 开发团队  
**最后更新：** 2025-01-08  
**参考项目：** [MCDReforged](https://github.com/Fallen-Breath/MCDReforged) (GPL-3.0)

