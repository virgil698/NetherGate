# 文本组件

NetherGate 提供了强大的文本组件系统，让你可以创建富文本消息，支持颜色、格式、点击和悬停事件等高级功能。

---

## 📋 **目录**

- [快速开始](#快速开始)
- [基本样式](#基本样式)
- [交互事件](#交互事件)
- [组合文本](#组合文本)
- [实战示例](#实战示例)
- [最佳实践](#最佳实践)

---

## 🚀 **快速开始**

### **创建简单文本**

```csharp
using NetherGate.API.GameDisplay;

// 创建彩色文本
var text = new TextComponent("欢迎来到服务器！")
    .SetColor(TextColor.Gold)
    .SetBold(true);

await _gameDisplay.SendTextComponentAsync(playerName, text);
```

### **发送到玩家**

```csharp
// 发送到特定玩家
await _gameDisplay.SendTextComponentAsync("Steve", text);

// 广播给所有玩家
await _gameDisplay.BroadcastTextComponentAsync(text);
```

---

## 🎨 **基本样式**

### **颜色**

```csharp
public enum TextColor
{
    Black,       // §0
    DarkBlue,    // §1
    DarkGreen,   // §2
    DarkAqua,    // §3
    DarkRed,     // §4
    DarkPurple,  // §5
    Gold,        // §6
    Gray,        // §7
    DarkGray,    // §8
    Blue,        // §9
    Green,       // §a
    Aqua,        // §b
    Red,         // §c
    LightPurple, // §d
    Yellow,      // §e
    White        // §f
}
```

**使用示例：**
```csharp
var redText = new TextComponent("警告！").SetColor(TextColor.Red);
var goldText = new TextComponent("提示：").SetColor(TextColor.Gold);
```

### **格式**

```csharp
var formatted = new TextComponent("格式化文本")
    .SetBold(true)           // §l 粗体
    .SetItalic(true)         // §o 斜体
    .SetUnderlined(true)     // §n 下划线
    .SetStrikethrough(true)  // §m 删除线
    .SetObfuscated(true);    // §k 混淆（动态随机字符）
```

### **重置格式**

```csharp
var text = new TextComponent("正常文本")
    .SetBold(true)
    .Append(" 继续粗体 ")
    .Append(new TextComponent("普通文本").SetReset(true));
    // 使用 SetReset() 清除所有格式
```

---

## 🖱️ **交互事件**

### **点击事件**

```csharp
public enum ClickAction
{
    RunCommand,      // 执行命令
    SuggestCommand,  // 建议命令（填充到聊天框）
    OpenUrl,         // 打开URL
    CopyToClipboard  // 复制到剪贴板
}
```

**使用示例：**

```csharp
// 点击执行命令
var clickText = new TextComponent("[点击领取奖励]")
    .SetColor(TextColor.Green)
    .SetClickEvent(new ClickEvent(
        ClickAction.RunCommand,
        "/give @s diamond 64"
    ));

// 点击打开网站
var urlText = new TextComponent("访问官网")
    .SetColor(TextColor.Blue)
    .SetUnderlined(true)
    .SetClickEvent(new ClickEvent(
        ClickAction.OpenUrl,
        "https://example.com"
    ));

// 点击建议命令
var suggestText = new TextComponent("[传送]")
    .SetColor(TextColor.Yellow)
    .SetClickEvent(new ClickEvent(
        ClickAction.SuggestCommand,
        "/tp @s "
    ));
```

### **悬停事件**

```csharp
public enum HoverAction
{
    ShowText,   // 显示文本
    ShowItem,   // 显示物品
    ShowEntity  // 显示实体
}
```

**使用示例：**

```csharp
// 悬停显示说明
var hoverText = new TextComponent("神秘箱子")
    .SetColor(TextColor.Gold)
    .SetHoverEvent(new HoverEvent(
        HoverAction.ShowText,
        "点击打开箱子\n可能包含：\n- 钻石 x64\n- 金锭 x32"
    ));

// 悬停显示物品
var itemText = new TextComponent("[钻石剑]")
    .SetColor(TextColor.Aqua)
    .SetHoverEvent(new HoverEvent(
        HoverAction.ShowItem,
        "{id:\"minecraft:diamond_sword\",Count:1}"
    ));
```

### **组合点击和悬停**

```csharp
var interactive = new TextComponent("[商店]")
    .SetColor(TextColor.Gold)
    .SetBold(true)
    .SetClickEvent(new ClickEvent(
        ClickAction.RunCommand,
        "/shop open"
    ))
    .SetHoverEvent(new HoverEvent(
        HoverAction.ShowText,
        "§6点击打开商店\n§7购买各种道具"
    ));
```

---

## 🔗 **组合文本**

### **追加文本**

```csharp
var message = new TextComponent("欢迎 ")
    .SetColor(TextColor.Yellow)
    .Append(new TextComponent("Steve").SetColor(TextColor.Gold).SetBold(true))
    .Append(new TextComponent(" 加入服务器！").SetColor(TextColor.Yellow));
// 结果: "欢迎 Steve 加入服务器！" (Steve 是粗体金色)
```

### **添加额外文本**

```csharp
var complex = new TextComponent("系统")
    .SetColor(TextColor.DarkGray)
    .AddExtra(new TextComponent(" > ").SetColor(TextColor.Gray))
    .AddExtra(new TextComponent("消息内容").SetColor(TextColor.White));
```

### **换行**

```csharp
var multiLine = new TextComponent("第一行")
    .Append("\n")
    .Append(new TextComponent("第二行"))
    .Append("\n")
    .Append(new TextComponent("第三行"));
```

---

## 💼 **实战示例**

### **示例1：交互式菜单**

```csharp
public class MenuCommand : ICommand
{
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var menu = new TextComponent("=== 主菜单 ===\n")
            .SetColor(TextColor.Gold)
            .SetBold(true)
            .Append(new TextComponent("\n"))
            
            // 传送选项
            .Append(new TextComponent("⚡ ")
                .SetColor(TextColor.Yellow))
            .Append(new TextComponent("[传送]")
                .SetColor(TextColor.Green)
                .SetClickEvent(new ClickEvent(
                    ClickAction.RunCommand,
                    "/teleport menu"
                ))
                .SetHoverEvent(new HoverEvent(
                    HoverAction.ShowText,
                    "§a打开传送菜单"
                )))
            .Append(new TextComponent(" | "))
            
            // 商店选项
            .Append(new TextComponent("🛒 ")
                .SetColor(TextColor.Yellow))
            .Append(new TextComponent("[商店]")
                .SetColor(TextColor.Green)
                .SetClickEvent(new ClickEvent(
                    ClickAction.RunCommand,
                    "/shop"
                ))
                .SetHoverEvent(new HoverEvent(
                    HoverAction.ShowText,
                    "§a打开商店"
                )))
            .Append(new TextComponent(" | "))
            
            // 帮助选项
            .Append(new TextComponent("❓ ")
                .SetColor(TextColor.Yellow))
            .Append(new TextComponent("[帮助]")
                .SetColor(TextColor.Green)
                .SetClickEvent(new ClickEvent(
                    ClickAction.RunCommand,
                    "/help"
                ))
                .SetHoverEvent(new HoverEvent(
                    HoverAction.ShowText,
                    "§a查看帮助文档"
                )));
        
        await _gameDisplay.SendTextComponentAsync(sender.Name, menu);
        return CommandResult.Ok();
    }
}
```

### **示例2：玩家信息卡片**

```csharp
public async Task ShowPlayerCardAsync(string targetPlayer, string viewer)
{
    var stats = await GetPlayerStatsAsync(targetPlayer);
    
    var card = new TextComponent($"=== {targetPlayer} 的信息 ===\n")
        .SetColor(TextColor.Gold)
        .SetBold(true)
        .Append(new TextComponent("\n"))
        
        // 等级
        .Append(new TextComponent("⭐ 等级: ")
            .SetColor(TextColor.Yellow))
        .Append(new TextComponent($"{stats.Level}\n")
            .SetColor(TextColor.White))
        
        // 游戏时间
        .Append(new TextComponent("⏰ 游戏时间: ")
            .SetColor(TextColor.Yellow))
        .Append(new TextComponent($"{stats.PlayTime} 小时\n")
            .SetColor(TextColor.White))
        
        // 操作按钮
        .Append(new TextComponent("\n"))
        .Append(new TextComponent("[添加好友]")
            .SetColor(TextColor.Green)
            .SetClickEvent(new ClickEvent(
                ClickAction.RunCommand,
                $"/friend add {targetPlayer}"
            ))
            .SetHoverEvent(new HoverEvent(
                HoverAction.ShowText,
                $"§a添加 {targetPlayer} 为好友"
            )))
        .Append(new TextComponent(" "))
        .Append(new TextComponent("[传送请求]")
            .SetColor(TextColor.Aqua)
            .SetClickEvent(new ClickEvent(
                ClickAction.RunCommand,
                $"/tpa {targetPlayer}"
            ))
            .SetHoverEvent(new HoverEvent(
                HoverAction.ShowText,
                $"§b请求传送到 {targetPlayer}"
            )));
    
    await _gameDisplay.SendTextComponentAsync(viewer, card);
}
```

### **示例3：任务系统**

```csharp
public async Task ShowQuestListAsync(string playerName)
{
    var quests = await GetPlayerQuestsAsync(playerName);
    
    var questList = new TextComponent("=== 可用任务 ===\n")
        .SetColor(TextColor.Gold)
        .SetBold(true);
    
    foreach (var quest in quests)
    {
        var status = quest.IsCompleted 
            ? new TextComponent("✓ ").SetColor(TextColor.Green)
            : new TextComponent("○ ").SetColor(TextColor.Gray);
        
        var questLine = status
            .Append(new TextComponent(quest.Name)
                .SetColor(quest.IsCompleted ? TextColor.Gray : TextColor.Yellow)
                .SetStrikethrough(quest.IsCompleted)
                .SetClickEvent(new ClickEvent(
                    ClickAction.RunCommand,
                    $"/quest info {quest.Id}"
                ))
                .SetHoverEvent(new HoverEvent(
                    HoverAction.ShowText,
                    $"§e{quest.Description}\n\n" +
                    $"§7奖励: §6{quest.Reward}\n" +
                    $"§7进度: §a{quest.Progress}§7/§a{quest.Required}\n\n" +
                    $"§8点击查看详情"
                )))
            .Append(new TextComponent("\n"));
        
        questList.Append(questLine);
    }
    
    await _gameDisplay.SendTextComponentAsync(playerName, questList);
}
```

### **示例4：聊天过滤器**

```csharp
public class ChatFormatterPlugin : IPlugin
{
    public void OnEnable(IPluginContext context)
    {
        context.EventBus.Subscribe<PlayerChatEvent>(async e =>
        {
            // 取消原始消息
            e.Cancel = true;
            
            // 创建格式化消息
            var formatted = new TextComponent("[")
                .SetColor(TextColor.Gray)
                .Append(new TextComponent(GetPlayerRank(e.PlayerName))
                    .SetColor(GetRankColor(e.PlayerName))
                    .SetBold(true))
                .Append(new TextComponent("] ")
                    .SetColor(TextColor.Gray))
                .Append(new TextComponent(e.PlayerName)
                    .SetColor(TextColor.White)
                    .SetClickEvent(new ClickEvent(
                        ClickAction.SuggestCommand,
                        $"/msg {e.PlayerName} "
                    ))
                    .SetHoverEvent(new HoverEvent(
                        HoverAction.ShowText,
                        $"§7点击私聊 §f{e.PlayerName}"
                    )))
                .Append(new TextComponent(": ")
                    .SetColor(TextColor.Gray))
                .Append(new TextComponent(e.Message)
                    .SetColor(TextColor.White));
            
            // 广播格式化消息
            await context.GameDisplay.BroadcastTextComponentAsync(formatted);
        });
    }
}
```

### **示例5：公告系统**

```csharp
public class AnnouncementCommand : ICommand
{
    public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
    {
        var message = string.Join(" ", args);
        
        var announcement = new TextComponent("━━━━━━━━━━━━━━━━━━━━━━━\n")
            .SetColor(TextColor.Gold)
            .SetBold(true)
            .Append(new TextComponent("📢 ")
                .SetColor(TextColor.Yellow))
            .Append(new TextComponent("服务器公告")
                .SetColor(TextColor.Gold)
                .SetBold(true))
            .Append(new TextComponent("\n\n"))
            .Append(new TextComponent(message)
                .SetColor(TextColor.White))
            .Append(new TextComponent("\n\n"))
            .Append(new TextComponent("━━━━━━━━━━━━━━━━━━━━━━━")
                .SetColor(TextColor.Gold)
                .SetBold(true));
        
        await _gameDisplay.BroadcastTextComponentAsync(announcement);
        
        // 播放提示音
        await _musicPlayer.PlayWarningSoundAsync("@a");
        
        return CommandResult.Ok("公告已发布");
    }
}
```

---

## 💡 **最佳实践**

### **1. 保持可读性**

✅ **推荐：** 使用链式调用和缩进
```csharp
var text = new TextComponent("标题")
    .SetColor(TextColor.Gold)
    .SetBold(true)
    .Append(new TextComponent("\n"))
    .Append(new TextComponent("内容")
        .SetColor(TextColor.White));
```

### **2. 复用组件**

✅ **推荐：** 创建可复用的组件
```csharp
private TextComponent CreateButton(string label, string command, string tooltip)
{
    return new TextComponent($"[{label}]")
        .SetColor(TextColor.Green)
        .SetClickEvent(new ClickEvent(ClickAction.RunCommand, command))
        .SetHoverEvent(new HoverEvent(HoverAction.ShowText, tooltip));
}

// 使用
var menu = new TextComponent("菜单: ")
    .Append(CreateButton("传送", "/tp", "打开传送菜单"))
    .Append(" ")
    .Append(CreateButton("商店", "/shop", "打开商店"));
```

### **3. 国际化支持**

✅ **推荐：** 结合 i18n
```csharp
var text = new TextComponent(_i18n.Translate("menu.title"))
    .SetColor(TextColor.Gold)
    .Append(new TextComponent(_i18n.Translate("menu.subtitle"))
        .SetColor(TextColor.Gray));
```

### **4. 颜色一致性**

✅ **推荐：** 定义颜色常量
```csharp
private static class Colors
{
    public static readonly TextColor Title = TextColor.Gold;
    public static readonly TextColor Content = TextColor.White;
    public static readonly TextColor Button = TextColor.Green;
    public static readonly TextColor Warning = TextColor.Red;
}

var text = new TextComponent("标题").SetColor(Colors.Title);
```

---

## 📚 **相关文档**

- [游戏显示API](./游戏显示API.md)
- [国际化 (i18n)](./国际化.md)
- [命令系统](../02-核心功能/命令系统.md)

---

**文档维护者：** NetherGate 开发团队  
**最后更新：** 2025-01-08  
**许可证：** LGPL-3.0

