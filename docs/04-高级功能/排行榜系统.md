# æ’è¡Œæ¦œç³»ç»Ÿ

NetherGate æä¾›äº†çµæ´»çš„æ’è¡Œæ¦œç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾åˆ›å»ºå’Œç®¡ç†å„ç§ç±»å‹çš„æ’è¡Œæ¦œã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šç§æ’è¡Œæ¦œç±»å‹** - æ”¯æŒæœ€é«˜åˆ†ã€æœ€ä½åˆ†ã€ç´¯è®¡åˆ†æ•°
- âœ… **å®æ—¶æ›´æ–°** - åˆ†æ•°å’Œæ’åå®æ—¶è®¡ç®—å’Œæ›´æ–°
- âœ… **äº‹ä»¶é€šçŸ¥** - åˆ†æ•°æ›´æ–°å’Œæ’åå˜åŒ–äº‹ä»¶
- âœ… **æŒä¹…åŒ–å­˜å‚¨** - è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½æ’è¡Œæ¦œæ•°æ®
- âœ… **çµæ´»çš„æ•°æ®ç»“æ„** - æ”¯æŒè‡ªå®šä¹‰å…ƒæ•°æ®

## æ’è¡Œæ¦œç±»å‹

### HighestScoreï¼ˆæœ€é«˜åˆ†ï¼‰
åˆ†æ•°è¶Šé«˜ï¼Œæ’åè¶Šé å‰ã€‚é€‚åˆå‡»æ€æ•°ã€ç»éªŒå€¼ç­‰ã€‚

### LowestScoreï¼ˆæœ€ä½åˆ†ï¼‰
åˆ†æ•°è¶Šä½ï¼Œæ’åè¶Šé å‰ã€‚é€‚åˆé€Ÿé€šæ—¶é—´ã€æ­»äº¡æ¬¡æ•°ç­‰ã€‚

### Accumulativeï¼ˆç´¯è®¡åˆ†æ•°ï¼‰
ç´¯è®¡æ‰€æœ‰åˆ†æ•°ï¼Œé€‚åˆç»éªŒå€¼ã€åœ¨çº¿æ—¶é•¿ç­‰ã€‚

## åŸºæœ¬ç”¨æ³•

### åˆ›å»ºæ’è¡Œæ¦œ

```csharp
// åˆ›å»ºæœ€é«˜åˆ†æ’è¡Œæ¦œ
await context.LeaderboardSystem.CreateLeaderboardAsync(
    "kills",                    // æ’è¡Œæ¦œåç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
    LeaderboardType.HighestScore,  // ç±»å‹
    "å‡»æ€æ’è¡Œæ¦œ"                 // æ˜¾ç¤ºåç§°ï¼ˆå¯é€‰ï¼‰
);

// åˆ›å»ºé€Ÿé€šæ’è¡Œæ¦œï¼ˆæ—¶é—´è¶ŠçŸ­è¶Šå¥½ï¼‰
await context.LeaderboardSystem.CreateLeaderboardAsync(
    "speedrun_dragon",
    LeaderboardType.LowestScore,
    "æœ«å½±é¾™é€Ÿé€š"
);
```

### æ›´æ–°åˆ†æ•°

```csharp
// è®¾ç½®ç©å®¶åˆ†æ•°
await context.LeaderboardSystem.UpdateScoreAsync(
    "kills",                    // æ’è¡Œæ¦œåç§°
    playerUuid,                 // ç©å®¶ UUID
    100,                        // åˆ†æ•°
    "Player123"                 // ç©å®¶åç§°ï¼ˆå¯é€‰ï¼‰
);

// å¢åŠ åˆ†æ•°ï¼ˆé€‚ç”¨äºç´¯è®¡ç±»å‹ï¼‰
await context.LeaderboardSystem.IncrementScoreAsync(
    "kills",
    playerUuid,
    10,                         // å¢åŠ çš„åˆ†æ•°
    "Player123"
);
```

### æŸ¥è¯¢æ’è¡Œæ¦œ

```csharp
// è·å–å‰ 10 å
var topPlayers = await context.LeaderboardSystem.GetTopPlayersAsync("kills", 10);

foreach (var entry in topPlayers)
{
    context.Logger.Info($"#{entry.Rank} {entry.PlayerName}: {entry.Score}");
}

// è·å–ç©å®¶æ’å
var rank = await context.LeaderboardSystem.GetPlayerRankAsync("kills", playerUuid);
context.Logger.Info($"ä½ çš„æ’å: #{rank}");

// è·å–ç©å®¶åˆ†æ•°
var score = await context.LeaderboardSystem.GetPlayerScoreAsync("kills", playerUuid);
context.Logger.Info($"ä½ çš„åˆ†æ•°: {score}");
```

### é‡ç½®æ’è¡Œæ¦œ

```csharp
// é‡ç½®æ’è¡Œæ¦œï¼ˆæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼‰
await context.LeaderboardSystem.ResetLeaderboardAsync("kills");
```

### åˆ é™¤æ’è¡Œæ¦œ

```csharp
// åˆ é™¤æ’è¡Œæ¦œ
await context.LeaderboardSystem.DeleteLeaderboardAsync("kills");
```

## äº‹ä»¶ç³»ç»Ÿ

### ç›‘å¬åˆ†æ•°æ›´æ–°

```csharp
public void OnEnable(IPluginContext context)
{
    context.LeaderboardSystem.ScoreUpdated += OnScoreUpdated;
}

private async void OnScoreUpdated(object? sender, ScoreUpdatedEventArgs e)
{
    context.Logger.Info($"{e.PlayerName} çš„åˆ†æ•°ä» {e.OldScore} æ›´æ–°åˆ° {e.NewScore}");
    
    // é€šçŸ¥ç©å®¶
    await context.GameDisplay.SendActionBarAsync(
        e.PlayerName,
        $"Â§aåˆ†æ•°: {e.NewScore} (+{e.NewScore - e.OldScore})"
    );
}
```

### ç›‘å¬æ’åå˜åŒ–

```csharp
public void OnEnable(IPluginContext context)
{
    context.LeaderboardSystem.RankChanged += OnRankChanged;
}

private async void OnRankChanged(object? sender, RankChangedEventArgs e)
{
    if (e.NewRank < e.OldRank)
    {
        // æ’åä¸Šå‡
        await context.GameDisplay.SendTitleAsync(
            e.PlayerName,
            "Â§6Â§læ’åä¸Šå‡ï¼",
            $"Â§e#{e.OldRank} â†’ #{e.NewRank}"
        );
    }
}
```

## å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ 1: å‡»æ€æ’è¡Œæ¦œ

```csharp
public class KillLeaderboardPlugin : IPlugin
{
    private IPluginContext _context;

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // åˆ›å»ºå‡»æ€æ’è¡Œæ¦œ
        await context.LeaderboardSystem.CreateLeaderboardAsync(
            "kills",
            LeaderboardType.HighestScore,
            "å‡»æ€æ’è¡Œ"
        );
        
        // è®¢é˜…ç©å®¶å‡»æ€äº‹ä»¶
        context.EventBus.Subscribe<PlayerKilledMobEvent>(OnPlayerKilledMob);
        
        // ç›‘å¬æ’åå˜åŒ–
        context.LeaderboardSystem.RankChanged += OnRankChanged;
    }

    private async void OnPlayerKilledMob(PlayerKilledMobEvent e)
    {
        // å¢åŠ å‡»æ€æ•°
        await _context.LeaderboardSystem.IncrementScoreAsync(
            "kills",
            e.PlayerUuid,
            1,
            e.PlayerName
        );
    }

    private async void OnRankChanged(object? sender, RankChangedEventArgs e)
    {
        if (e.NewRank <= 3 && e.NewRank < e.OldRank)
        {
            // è¿›å…¥å‰ä¸‰å
            await _context.GameDisplay.SendChatMessageAsync(
                "@a",
                $"Â§6{e.PlayerName} è¿›å…¥å‡»æ€æ¦œå‰ä¸‰åï¼ (#{e.NewRank})"
            );
        }
    }

    public void OnDisable()
    {
        // æ¸…ç†
    }
}
```

### ç¤ºä¾‹ 2: é€Ÿé€šæ’è¡Œæ¦œ

```csharp
public class SpeedrunLeaderboardPlugin : IPlugin
{
    private IPluginContext _context;
    private readonly Dictionary<string, DateTime> _runStarts = new();

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // åˆ›å»ºé€Ÿé€šæ’è¡Œæ¦œ
        await context.LeaderboardSystem.CreateLeaderboardAsync(
            "speedrun_dragon",
            LeaderboardType.LowestScore,  // æ—¶é—´è¶ŠçŸ­è¶Šå¥½
            "æœ«å½±é¾™é€Ÿé€š"
        );
        
        // è®¢é˜…æˆå°±äº‹ä»¶
        context.AdvancementTracker.AdvancementCompleted += OnAdvancementCompleted;
    }

    private async void OnAdvancementCompleted(object? sender, AdvancementCompletedEventArgs e)
    {
        // æ£€æŸ¥æ˜¯å¦å‡»è´¥äº†æœ«å½±é¾™
        if (e.AdvancementId == "minecraft:end/kill_dragon")
        {
            if (_runStarts.TryGetValue(e.PlayerUuid, out var startTime))
            {
                var duration = (DateTime.UtcNow - startTime).TotalSeconds;
                
                // æ›´æ–°æ’è¡Œæ¦œ
                await _context.LeaderboardSystem.UpdateScoreAsync(
                    "speedrun_dragon",
                    e.PlayerUuid,
                    duration,
                    e.PlayerName
                );
                
                // è·å–æ’å
                var rank = await _context.LeaderboardSystem.GetPlayerRankAsync(
                    "speedrun_dragon",
                    e.PlayerUuid
                );
                
                await _context.GameDisplay.SendTitleAsync(
                    e.PlayerName,
                    "Â§6Â§lé€Ÿé€šå®Œæˆï¼",
                    $"Â§eç”¨æ—¶: {TimeSpan.FromSeconds(duration):hh\\:mm\\:ss} (#{rank})"
                );
            }
        }
    }
}
```

### ç¤ºä¾‹ 3: å¤šç»´åº¦æ’è¡Œæ¦œ

```csharp
public class ComprehensiveLeaderboardPlugin : IPlugin
{
    private IPluginContext _context;

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // åˆ›å»ºå¤šä¸ªæ’è¡Œæ¦œ
        await CreateLeaderboards();
        
        // è®¢é˜…ç»Ÿè®¡æ›´æ–°äº‹ä»¶
        context.StatisticsTracker.StatisticsUpdated += OnStatisticsUpdated;
    }

    private async Task CreateLeaderboards()
    {
        var leaderboards = new[]
        {
            ("playtime", LeaderboardType.HighestScore, "åœ¨çº¿æ—¶é•¿"),
            ("mining", LeaderboardType.HighestScore, "æŒ–çŸ¿æ’è¡Œ"),
            ("deaths", LeaderboardType.LowestScore, "æ­»äº¡æ¬¡æ•°"),
            ("travel", LeaderboardType.HighestScore, "æ—…è¡Œè·ç¦»")
        };

        foreach (var (name, type, displayName) in leaderboards)
        {
            await _context.LeaderboardSystem.CreateLeaderboardAsync(name, type, displayName);
        }
    }

    private async void OnStatisticsUpdated(object? sender, StatisticsUpdatedEventArgs e)
    {
        var stats = await _context.StatisticsTracker.GetPlayerStatisticsAsync(e.PlayerUuid);
        
        if (stats != null)
        {
            // æ›´æ–°åœ¨çº¿æ—¶é•¿æ’è¡Œæ¦œ
            await _context.LeaderboardSystem.UpdateScoreAsync(
                "playtime",
                e.PlayerUuid,
                stats.PlayTime,
                e.PlayerName
            );
            
            // æ›´æ–°æŒ–çŸ¿æ’è¡Œæ¦œ
            var totalMined = stats.MinedBlocks.Values.Sum();
            await _context.LeaderboardSystem.UpdateScoreAsync(
                "mining",
                e.PlayerUuid,
                totalMined,
                e.PlayerName
            );
            
            // æ›´æ–°æ­»äº¡æ’è¡Œæ¦œ
            await _context.LeaderboardSystem.UpdateScoreAsync(
                "deaths",
                e.PlayerUuid,
                stats.TotalDeaths,
                e.PlayerName
            );
            
            // æ›´æ–°æ—…è¡Œè·ç¦»æ’è¡Œæ¦œ
            var totalTravel = stats.TravelDistances.Values.Sum();
            await _context.LeaderboardSystem.UpdateScoreAsync(
                "travel",
                e.PlayerUuid,
                totalTravel,
                e.PlayerName
            );
        }
    }
}
```

### ç¤ºä¾‹ 4: æ’è¡Œæ¦œæ˜¾ç¤ºé¢æ¿

```csharp
public class LeaderboardDisplayPlugin : IPlugin
{
    private IPluginContext _context;

    public void OnEnable(IPluginContext context)
    {
        _context = context;
        
        // æ³¨å†Œå‘½ä»¤
        context.CommandManager.RegisterCommand(new ShowLeaderboardCommand(context));
    }

    private class ShowLeaderboardCommand : ICommand
    {
        private readonly IPluginContext _context;

        public ShowLeaderboardCommand(IPluginContext context)
        {
            _context = context;
        }

        public string Name => "leaderboard";
        public string Description => "æŸ¥çœ‹æ’è¡Œæ¦œ";
        public string Usage => "/leaderboard <åç§°>";
        public List<string> Aliases => new() { "lb", "top" };
        public string PluginId => "LeaderboardDisplay";
        public string? Permission => null;

        public async Task<CommandResult> ExecuteAsync(ICommandSender sender, string[] args)
        {
            if (args.Length == 0)
            {
                return CommandResult.Fail("ç”¨æ³•: /leaderboard <åç§°>");
            }

            var leaderboardName = args[0];
            var topPlayers = await _context.LeaderboardSystem.GetTopPlayersAsync(
                leaderboardName, 
                10
            );

            if (topPlayers.Count == 0)
            {
                return CommandResult.Fail($"æ’è¡Œæ¦œ '{leaderboardName}' ä¸å­˜åœ¨æˆ–ä¸ºç©º");
            }

            sender.SendMessage($"Â§6Â§l=== {leaderboardName} æ’è¡Œæ¦œ ===");
            foreach (var entry in topPlayers)
            {
                var medal = entry.Rank switch
                {
                    1 => "ğŸ¥‡",
                    2 => "ğŸ¥ˆ",
                    3 => "ğŸ¥‰",
                    _ => $"#{entry.Rank}"
                };
                
                sender.SendMessage($"{medal} Â§e{entry.PlayerName}Â§f: Â§a{entry.Score:F2}");
            }

            return CommandResult.Ok();
        }
    }
}
```

## WebSocket å®æ—¶æ¨é€

ç»“åˆ WebSocket æ•°æ®å¹¿æ’­å™¨ï¼Œå¯ä»¥å®æ—¶æ¨é€æ’è¡Œæ¦œåˆ°ç½‘é¡µï¼š

```csharp
public void OnEnable(IPluginContext context)
{
    // è®¢é˜…æ’åå˜åŒ–äº‹ä»¶
    context.LeaderboardSystem.RankChanged += async (sender, e) =>
    {
        // è·å–æœ€æ–°æ’è¡Œæ¦œ
        var topPlayers = await context.LeaderboardSystem.GetTopPlayersAsync(
            e.LeaderboardName, 
            10
        );
        
        // é€šè¿‡ WebSocket æ¨é€
        await context.DataBroadcaster.BroadcastAsync("leaderboard", new
        {
            leaderboard = e.LeaderboardName,
            players = topPlayers
        });
    };
}
```

## æ•°æ®æŒä¹…åŒ–

æ’è¡Œæ¦œæ•°æ®è‡ªåŠ¨ä¿å­˜åˆ° `data/leaderboards/<name>.json`ï¼š

```json
{
  "Name": "kills",
  "DisplayName": "å‡»æ€æ’è¡Œ",
  "Type": "HighestScore",
  "Entries": [
    {
      "Rank": 1,
      "PlayerUuid": "...",
      "PlayerName": "Player1",
      "Score": 1000,
      "LastUpdated": "2025-10-08T10:00:00Z"
    }
  ],
  "CreatedAt": "2025-10-01T00:00:00Z",
  "LastUpdated": "2025-10-08T10:00:00Z"
}
```

## æœ€ä½³å®è·µ

1. **åˆç†å‘½å** - ä½¿ç”¨æœ‰æ„ä¹‰çš„æ’è¡Œæ¦œåç§°
2. **é€‰æ‹©æ­£ç¡®çš„ç±»å‹** - æ ¹æ®ä¸šåŠ¡é€»è¾‘é€‰æ‹©åˆé€‚çš„æ’è¡Œæ¦œç±»å‹
3. **åŠæ—¶æ›´æ–°** - åœ¨ç›¸å…³äº‹ä»¶å‘ç”Ÿæ—¶ç«‹å³æ›´æ–°åˆ†æ•°
4. **é¿å…é¢‘ç¹é‡ç½®** - è€ƒè™‘ä½¿ç”¨å‘¨æœŸæ€§é‡ç½®æˆ–å½’æ¡£
5. **ä½¿ç”¨äº‹ä»¶** - ç›‘å¬äº‹ä»¶è€Œä¸æ˜¯è½®è¯¢æŸ¥è¯¢

## ç›¸å…³ API

- [æˆå°±å’Œç»Ÿè®¡è¿½è¸ª](æˆå°±å’Œç»Ÿè®¡è¿½è¸ª.md)
- [WebSocket æ•°æ®æ¨é€](WebSocketæ•°æ®æ¨é€.md)
- [äº‹ä»¶ç³»ç»Ÿ](../02-æ ¸å¿ƒåŠŸèƒ½/äº‹ä»¶ç³»ç»Ÿ.md)

