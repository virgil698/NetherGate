# æ„å»ºå’Œæ‰“åŒ…

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æ„å»ºã€æ‰“åŒ…å’Œå‘å¸ƒ NetherGate å’Œæ’ä»¶é¡¹ç›®ã€‚

---

## ğŸ“‹ **ç›®å½•**

- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [NetherGate æ ¸å¿ƒæ„å»º](#nethergate-æ ¸å¿ƒæ„å»º)
- [æ’ä»¶æ„å»º](#æ’ä»¶æ„å»º)
- [å‘å¸ƒå’Œéƒ¨ç½²](#å‘å¸ƒå’Œéƒ¨ç½²)
- [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ”§ **ç¯å¢ƒè¦æ±‚**

### **å¿…éœ€å·¥å…·**

- **.NET 9.0 SDK** æˆ–æ›´é«˜ç‰ˆæœ¬
  - ä¸‹è½½ï¼šhttps://dotnet.microsoft.com/download
  - éªŒè¯å®‰è£…ï¼š`dotnet --version`

- **Git**ï¼ˆå¯é€‰ï¼Œç”¨äºå…‹éš†æºä»£ç ï¼‰
  - ä¸‹è½½ï¼šhttps://git-scm.com/

### **å¯é€‰å·¥å…·**

- **Visual Studio 2022** æˆ– **Rider** ï¼ˆIDEï¼‰
- **Docker**ï¼ˆç”¨äºå®¹å™¨åŒ–éƒ¨ç½²ï¼‰

### **éªŒè¯ç¯å¢ƒ**

```bash
# æ£€æŸ¥ .NET SDK
dotnet --version
# åº”æ˜¾ç¤º: 9.0.x æˆ–æ›´é«˜

# æ£€æŸ¥ .NET runtime
dotnet --list-runtimes

# æ£€æŸ¥ .NET SDK
dotnet --list-sdks
```

---

## ğŸ—ï¸ **NetherGate æ ¸å¿ƒæ„å»º**

### **1. å…‹éš†æºä»£ç **

```bash
git clone https://github.com/your-org/NetherGate.git
cd NetherGate
```

### **2. æ¢å¤ä¾èµ–**

```bash
dotnet restore
```

### **3. æ„å»ºé¡¹ç›®**

#### **Debug æ„å»º**

```bash
# æ„å»ºæ‰€æœ‰é¡¹ç›®
dotnet build

# æ„å»ºç‰¹å®šé¡¹ç›®
dotnet build src/NetherGate.Core/NetherGate.Core.csproj
```

è¾“å‡ºä½ç½®ï¼š
- `src/NetherGate.API/bin/Debug/net9.0/`
- `src/NetherGate.Core/bin/Debug/net9.0/`
- `src/NetherGate.Host/bin/Debug/net9.0/`

#### **Release æ„å»º**

```bash
# æ„å»º Release ç‰ˆæœ¬
dotnet build --configuration Release

# æˆ–ä½¿ç”¨æ„å»ºè„šæœ¬
cd scripts
./build.sh    # Linux/macOS
build.bat     # Windows
```

### **4. è¿è¡Œé¡¹ç›®**

```bash
# ç›´æ¥è¿è¡Œ
dotnet run --project src/NetherGate.Host/NetherGate.Host.csproj

# æˆ–è¿è¡Œå·²æ„å»ºçš„ç¨‹åº
cd src/NetherGate.Host/bin/Debug/net9.0/
dotnet NetherGate.Host.dll
```

---

## ğŸ“¦ **å‘å¸ƒï¼ˆPublishï¼‰**

å‘å¸ƒä¼šåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ã€å¯åˆ†å‘çš„åº”ç”¨ç¨‹åºåŒ…ã€‚

### **1. ä½¿ç”¨å‘å¸ƒè„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
cd scripts

# Windows
publish.bat

# Linux/macOS
chmod +x publish.sh
./publish.sh
```

å‘å¸ƒè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ¸…ç†æ—§çš„è¾“å‡º
- æ„å»º Release ç‰ˆæœ¬
- å‘å¸ƒåˆ° `bin/Release/` ç›®å½•
- åŒ…å«æ‰€æœ‰å¿…éœ€çš„ runtime

### **2. æ‰‹åŠ¨å‘å¸ƒ**

#### **å•æ–‡ä»¶å‘å¸ƒï¼ˆæ¨èï¼‰**

```bash
dotnet publish src/NetherGate.Host/NetherGate.Host.csproj \
  --configuration Release \
  --output bin/Release \
  --runtime win-x64 \
  --self-contained false
```

#### **è‡ªåŒ…å«å‘å¸ƒ**

```bash
# Windows x64
dotnet publish src/NetherGate.Host/NetherGate.Host.csproj \
  --configuration Release \
  --output bin/Release/win-x64 \
  --runtime win-x64 \
  --self-contained true

# Linux x64
dotnet publish src/NetherGate.Host/NetherGate.Host.csproj \
  --configuration Release \
  --output bin/Release/linux-x64 \
  --runtime linux-x64 \
  --self-contained true

# macOS ARM64
dotnet publish src/NetherGate.Host/NetherGate.Host.csproj \
  --configuration Release \
  --output bin/Release/osx-arm64 \
  --runtime osx-arm64 \
  --self-contained true
```

### **3. å‘å¸ƒé€‰é¡¹è¯´æ˜**

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `--configuration Release` | ä½¿ç”¨ Release é…ç½®ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰ |
| `--output <path>` | è¾“å‡ºç›®å½• |
| `--runtime <RID>` | ç›®æ ‡è¿è¡Œæ—¶æ ‡è¯†ç¬¦ï¼ˆè§ä¸‹è¡¨ï¼‰ |
| `--self-contained true` | åŒ…å« .NET runtimeï¼ˆä½“ç§¯å¤§ä½†ç‹¬ç«‹ï¼‰ |
| `--self-contained false` | ä¸åŒ…å« runtimeï¼ˆéœ€è¦ç›®æ ‡æœºå™¨å®‰è£… .NETï¼‰ |

### **4. Runtime Identifiers (RID)**

| å¹³å° | RID |
|------|-----|
| Windows 64-bit | `win-x64` |
| Windows 32-bit | `win-x86` |
| Windows ARM64 | `win-arm64` |
| Linux 64-bit | `linux-x64` |
| Linux ARM64 | `linux-arm64` |
| macOS Intel | `osx-x64` |
| macOS Apple Silicon | `osx-arm64` |

æ›´å¤š RIDï¼šhttps://docs.microsoft.com/en-us/dotnet/core/rid-catalog

---

## ğŸ”Œ **æ’ä»¶æ„å»º**

### **1. åˆ›å»ºæ’ä»¶é¡¹ç›®**

```bash
dotnet new classlib -n MyPlugin
cd MyPlugin

# æ·»åŠ  NetherGate.API å¼•ç”¨
dotnet add reference path/to/NetherGate.API/NetherGate.API.csproj

# æˆ–ä½¿ç”¨ NuGet åŒ…ï¼ˆå¦‚æœå·²å‘å¸ƒï¼‰
dotnet add package NetherGate.API
```

### **2. é…ç½®é¡¹ç›®æ–‡ä»¶**

ç¼–è¾‘ `MyPlugin.csproj`ï¼š

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <EnableDynamicLoading>true</EnableDynamicLoading>
  </PropertyGroup>

  <ItemGroup>
    <!-- å¼•ç”¨ NetherGate.API -->
    <PackageReference Include="NetherGate.API" Version="1.0.0" PrivateAssets="all" />
    
    <!-- å…¶ä»–ä¾èµ–ï¼ˆä¼šè¢«å¤åˆ¶åˆ°æ’ä»¶ç›®å½•ï¼‰ -->
    <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
  </ItemGroup>

  <!-- æ„å»ºåè‡ªåŠ¨å¤åˆ¶åˆ° plugins ç›®å½• -->
  <Target Name="CopyToPlugins" AfterTargets="Build">
    <ItemGroup>
      <PluginFiles Include="$(OutputPath)**\*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(PluginFiles)" 
          DestinationFolder="$(SolutionDir)bin\$(Configuration)\plugins\$(ProjectName)\%(RecursiveDir)" 
          SkipUnchangedFiles="true" />
  </Target>
</Project>
```

### **3. æ„å»ºæ’ä»¶**

```bash
# Debug æ„å»º
dotnet build

# Release æ„å»º
dotnet build --configuration Release
```

### **4. æ’ä»¶è¾“å‡ºç»“æ„**

```
plugins/
â””â”€â”€ MyPlugin/
    â”œâ”€â”€ MyPlugin.dll         # æ’ä»¶ä¸»ç¨‹åºé›†
    â”œâ”€â”€ MyPlugin.pdb         # è°ƒè¯•ç¬¦å·ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ plugin.json          # æ’ä»¶å…ƒæ•°æ®
    â”œâ”€â”€ config.yaml          # é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ dependencies/        # ä¾èµ–åº“
        â””â”€â”€ Newtonsoft.Json.dll
```

---

## ğŸš€ **å‘å¸ƒå’Œéƒ¨ç½²**

### **1. å‡†å¤‡å‘å¸ƒåŒ…**

#### **æ ¸å¿ƒæ¡†æ¶**

```
NetherGate-v1.0.0/
â”œâ”€â”€ NetherGate.Host.exe         # ä¸»ç¨‹åº
â”œâ”€â”€ NetherGate.Core.dll
â”œâ”€â”€ NetherGate.API.dll
â”œâ”€â”€ lib/                        # ä¾èµ–åº“
â”‚   â”œâ”€â”€ fNbt.dll
â”‚   â””â”€â”€ YamlDotNet.dll
â”œâ”€â”€ config/                     # é…ç½®ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ plugins/                    # æ’ä»¶ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ logs/                       # æ—¥å¿—ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ nethergate-config.yaml      # é»˜è®¤é…ç½®
â””â”€â”€ README.txt                  # ä½¿ç”¨è¯´æ˜
```

#### **æ’ä»¶åŒ…**

```
MyPlugin-v1.0.0.zip
â”œâ”€â”€ MyPlugin/
â”‚   â”œâ”€â”€ MyPlugin.dll
â”‚   â”œâ”€â”€ plugin.json
â”‚   â”œâ”€â”€ config.example.yaml     # ç¤ºä¾‹é…ç½®
â”‚   â””â”€â”€ dependencies/
â”‚       â””â”€â”€ ...
â””â”€â”€ README.md                   # å®‰è£…è¯´æ˜
```

### **2. æ‰“åŒ…è„šæœ¬**

åˆ›å»º `scripts/package.sh`ï¼š

```bash
#!/bin/bash

VERSION="1.0.0"
OUTPUT="releases/NetherGate-v${VERSION}"

# æ¸…ç†
rm -rf "$OUTPUT"
mkdir -p "$OUTPUT"/{config,plugins,logs}

# å¤åˆ¶æ–‡ä»¶
cp -r bin/Release/* "$OUTPUT/"

# åˆ›å»ºé»˜è®¤é…ç½®
cp docs/config.example.yaml "$OUTPUT/nethergate-config.yaml"

# æ‰“åŒ…
cd releases
zip -r "NetherGate-v${VERSION}.zip" "NetherGate-v${VERSION}"

echo "âœ… æ‰“åŒ…å®Œæˆ: releases/NetherGate-v${VERSION}.zip"
```

### **3. å®‰è£…éƒ¨ç½²**

#### **Windows**

```batch
REM 1. è§£å‹åˆ°ç›®æ ‡ç›®å½•
unzip NetherGate-v1.0.0.zip -d C:\NetherGate

REM 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
notepad C:\NetherGate\nethergate-config.yaml

REM 3. è¿è¡Œ
cd C:\NetherGate
NetherGate.Host.exe
```

#### **Linux**

```bash
# 1. è§£å‹
unzip NetherGate-v1.0.0.zip -d /opt/nethergate

# 2. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x /opt/nethergate/NetherGate.Host

# 3. ç¼–è¾‘é…ç½®
nano /opt/nethergate/nethergate-config.yaml

# 4. è¿è¡Œ
cd /opt/nethergate
./NetherGate.Host
```

### **4. systemd æœåŠ¡ï¼ˆLinuxï¼‰**

åˆ›å»º `/etc/systemd/system/nethergate.service`ï¼š

```ini
[Unit]
Description=NetherGate Minecraft Server Manager
After=network.target

[Service]
Type=simple
User=minecraft
WorkingDirectory=/opt/nethergate
ExecStart=/opt/nethergate/NetherGate.Host
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯ç”¨å’Œå¯åŠ¨ï¼š

```bash
sudo systemctl enable nethergate
sudo systemctl start nethergate
sudo systemctl status nethergate
```

---

## ğŸ³ **Docker éƒ¨ç½²**

### **1. Dockerfile**

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY ["src/NetherGate.API/NetherGate.API.csproj", "NetherGate.API/"]
COPY ["src/NetherGate.Core/NetherGate.Core.csproj", "NetherGate.Core/"]
COPY ["src/NetherGate.Host/NetherGate.Host.csproj", "NetherGate.Host/"]

# æ¢å¤ä¾èµ–
RUN dotnet restore "NetherGate.Host/NetherGate.Host.csproj"

# å¤åˆ¶æ‰€æœ‰æºä»£ç 
COPY src/ .

# æ„å»º
WORKDIR "/src/NetherGate.Host"
RUN dotnet build "NetherGate.Host.csproj" -c Release -o /app/build

# å‘å¸ƒ
FROM build AS publish
RUN dotnet publish "NetherGate.Host.csproj" -c Release -o /app/publish

# è¿è¡Œæ—¶é˜¶æ®µ
FROM mcr.microsoft.com/dotnet/aspnet:9.0 AS final
WORKDIR /app

# å®‰è£… Javaï¼ˆç”¨äºè¿è¡Œ Minecraft æœåŠ¡å™¨ï¼‰
RUN apt-get update && \
    apt-get install -y openjdk-21-jre-headless && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# å¤åˆ¶åº”ç”¨
COPY --from=publish /app/publish .

# åˆ›å»ºç›®å½•
RUN mkdir -p /app/config /app/plugins /app/logs /app/server

# æ•°æ®å·
VOLUME ["/app/config", "/app/plugins", "/app/server", "/app/logs"]

# ç«¯å£
EXPOSE 25565 25575

# å…¥å£ç‚¹
ENTRYPOINT ["dotnet", "NetherGate.Host.dll"]
```

### **2. docker-compose.yml**

```yaml
version: '3.8'

services:
  nethergate:
    build: .
    container_name: nethergate
    restart: unless-stopped
    ports:
      - "25565:25565"  # Minecraft
      - "25575:25575"  # RCON
    volumes:
      - ./config:/app/config
      - ./plugins:/app/plugins
      - ./server:/app/server
      - ./logs:/app/logs
    environment:
      - DOTNET_ENVIRONMENT=Production
    networks:
      - minecraft

networks:
  minecraft:
    driver: bridge
```

### **3. æ„å»ºå’Œè¿è¡Œ**

```bash
# æ„å»ºé•œåƒ
docker build -t nethergate:latest .

# è¿è¡Œå®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

---

## â“ **å¸¸è§é—®é¢˜**

### **Q: æ„å»ºå¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ° SDKï¼Ÿ**

**A:** ç¡®ä¿å®‰è£…äº† .NET 9.0 SDKï¼š
```bash
dotnet --version
# å¦‚æœç‰ˆæœ¬ä½äº 9.0ï¼Œè¯·æ›´æ–°
```

### **Q: å‘å¸ƒåæ–‡ä»¶å¾ˆå¤§ï¼Ÿ**

**A:** ä½¿ç”¨ `--self-contained false` æ¥å‡å°ä½“ç§¯ï¼ˆéœ€è¦ç›®æ ‡æœºå™¨å®‰è£… .NETï¼‰ï¼š
```bash
dotnet publish --configuration Release --self-contained false
```

### **Q: æ’ä»¶åŠ è½½å¤±è´¥ï¼Ÿ**

**A:** æ£€æŸ¥ï¼š
1. æ’ä»¶æ˜¯å¦åœ¨ `plugins/` ç›®å½•
2. `plugin.json` æ˜¯å¦æ­£ç¡®
3. `EnableDynamicLoading` æ˜¯å¦è®¾ç½®ä¸º `true`
4. æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### **Q: Docker å®¹å™¨æ— æ³•å¯åŠ¨ï¼Ÿ**

**A:** æ£€æŸ¥ï¼š
1. ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -tulpn | grep 25565`
2. æ•°æ®å·æƒé™æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs nethergate`

---

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [é…ç½®æ–‡ä»¶è¯¦è§£](./é…ç½®æ–‡ä»¶è¯¦è§£.md)
- [æ’ä»¶å¼€å‘æŒ‡å—](../03-æ’ä»¶å¼€å‘/æ’ä»¶å¼€å‘æŒ‡å—.md)
- [é¡¹ç›®ç»“æ„è¯´æ˜](../06-æ¶æ„å’Œè®¾è®¡/é¡¹ç›®ç»“æ„.md)

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** NetherGate å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°ï¼š** 2025-10-05
